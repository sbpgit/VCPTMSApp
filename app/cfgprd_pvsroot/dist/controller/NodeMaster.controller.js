sap.ui.define(["cfgapp/pvsroot/cfgprdpvsroot/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,s,r){"use strict";var o,n,a;return e.extend("cfgapp.pvsroot.cfgprdpvsroot.controller.NodeMaster",{onInit:function(){o=this;this.oListModel=new i;this.bus=sap.ui.getCore().getEventBus();this.bus.subscribe("data","refreshMaster",this.refreshMaster,this);this.bus.publish("nav","toBeginPage",{viewName:this.getView().getProperty("viewName")})},onExit:function(){this.bus.unsubscribe("data","refreshMaster",this.refreshMaster,this)},setCurrentSelectedItem:function(){var e=this.byId("viewNodeList").getSelectedItem();if(e){o.getModel("oGModel").setProperty("/currentNode",e)}},onSearch:function(e){o.setCurrentSelectedItem();var t=e.getParameter("newValue")||e.getParameter("query"),i=o.oList.getBinding("items"),n=[];if(t&&t.trim()!==""){t=t.trim();n.push(new s({filters:[new s("CHILD_NODE",r.Contains,t),new s("NODE_DESC",r.Contains,t)],and:false}))}if(i){i.filter(n)}},handlePress:function(e){o.setCurrentSelectedItem();var i=e.getParameter("listItem").getBindingContext();n.setProperty("/CHILD_NODE",i.getProperty("CHILD_NODE"));n.setProperty("/PARENT_NODE",i.getProperty("PARENT_NODE"));n.setProperty("/NODE_DESC",i.getProperty("NODE_DESC"));this.getOwnerComponent().runAsOwner(function(){if(!o.oDetailView){try{o.oDetailView=sap.ui.view({viewName:"cfgapp.pvsroot.cfgprdpvsroot.controller.NodeDetail",type:"XML"});o.bus.publish("flexible","addDetailPage",o.oDetailView);o.bus.publish("nav","toDetailPage",{viewName:o.oDetailView.getViewName()})}catch(e){t.show(o.i18n.getText("getItemDetailErr"))}}else{o.bus.publish("nav","toDetailPage",{viewName:o.oDetailView.getViewName()});o.getData();o.oDetailView.onAfterRendering()}})},refreshMaster:function(){this.onAfterRendering()},onAfterRendering:function(){n=this.getModel("oGModel");this.i18n=this.getResourceBundle();this.oList=this.byId("viewNodeList");this.oList.setModel(o.oListModel);this.oList.removeSelections();this.byId("searchBar").setValue();if(this.oList.getBinding("items")){this.oList.getBinding("items").filter([])}o.getData();this.oList.attachEvent("updateFinished",function(e){o.byId("listTitle").setText(o.i18n.getText("listTitle",[this.getBinding("items").aIndices.length]));if(n.getProperty("/currentNode")){var t=this.getItems(),i=n.getProperty("/currentNode").getTitle();for(var s=0;s<t.length;s++){if(t[s].getTitle()===i){this.setSelectedItem(t[s]);break}}}})},getData:function(){o=this;var e=this.getModel("sModel");a=n.getProperty("/PARENT_NODE");e.callFunction("/fGetNodeDet",{method:"GET",urlParameters:{NODE_TYPE:"VN",CHILD_NODE:"1",PARENT_NODE:a},success:function(e){o.oListModel.setData({results:e.results})},error:function(e){t.show(o.i18n.getText("getListErr"))}})}})});