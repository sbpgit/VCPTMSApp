sap.ui.define(["cfgapp/pvsroot/cfgprdpvsroot/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,s,o){"use strict";var r,n,a;return e.extend("cfgapp.pvsroot.cfgprdpvsroot.controller.NodeMaster",{onInit:function(){r=this;this.oListModel=new i;this.bus=sap.ui.getCore().getEventBus();this.bus.subscribe("data","refreshMaster",this.refreshMaster,this);this.bus.publish("nav","toBeginPage",{viewName:this.getView().getProperty("viewName")})},onExit:function(){this.bus.unsubscribe("data","refreshMaster",this.refreshMaster,this)},setCurrentSelectedItem:function(){var e=this.byId("viewNodeList").getSelectedItem();if(e){r.getModel("oGModel").setProperty("/currentNode",e)}},onSearch:function(e){r.setCurrentSelectedItem();var t=e.getParameter("newValue")||e.getParameter("query"),i=r.oList.getBinding("items"),n=[];if(t&&t.trim()!==""){t=t.trim();n.push(new s({filters:[new s("CHILD_NODE",o.Contains,t),new s("NODE_DESC",o.Contains,t)],and:false}))}if(i){i.filter(n)}},handlePress:function(e){r.setCurrentSelectedItem();var t=e.getParameter("listItem").getBindingContext();n.setProperty("/PARENT_NODE",t.getProperty("CHILD_NODE"));n.setProperty("/NODE_DESC",t.getProperty("NODE_DESC"));this.getOwnerComponent().runAsOwner(function(){if(!r.oDetailView){try{r.oDetailView=sap.ui.view({viewName:"cfgapp.pvsroot.cfgprdpvsroot.view.NodeDetail",type:"XML"});r.bus.publish("flexible","addDetailPage",r.oDetailView);r.bus.publish("nav","toDetailPage",{viewName:r.oDetailView.getViewName()})}catch(e){r.oDetailView.onAfterRendering()}}else{r.bus.publish("nav","toDetailPage",{viewName:r.oDetailView.getViewName()});r.oDetailView.onAfterRendering()}})},refreshMaster:function(){this.onAfterRendering()},onAfterRendering:function(){n=this.getModel("oGModel");this.i18n=this.getResourceBundle();this.oList=this.byId("viewNodeList");this.oList.setModel(r.oListModel);this.oList.removeSelections();if(this.oList.getBinding("items")){this.oList.getBinding("items").filter([])}r.getData();this.oList.attachEvent("updateFinished",function(e){r.byId("listTitle").setText(r.i18n.getText("listTitle",[this.getBinding("items").aIndices.length]));if(n.getProperty("/currentNode")){var t=this.getItems(),i=n.getProperty("/currentNode").getTitle();for(var s=0;s<t.length;s++){if(t[s].getTitle()===i){this.setSelectedItem(t[s]);break}}}})},getData:function(){r=this;var e=this.getModel("sModel");a=n.getProperty("/PARENT_NODE");e.callFunction("/fGetNodeDet",{method:"GET",urlParameters:{NODE_TYPE:"VN",CHILD_NODE:"1",PARENT_NODE:a},success:function(e){r.oListModel.setData({results:e.results})},error:function(e){t.show(r.i18n.getText("getListErr"))}})},onCreate:function(){if(!r._oCreateNode){r._oCreateNode=sap.ui.xmlfragment("cfgapp.pvsroot.cfgprdpvsroot.view.CreateNode",r);r.getView().addDependent(r._oCreateNode)}sap.ui.getCore().byId("idCrDg").setTitle("Create View Node");var e="Access Node : "+a;sap.ui.getCore().byId("idText").setText(e);sap.ui.getCore().byId("idText").setVisible(true);r._oCreateNode.open()},onSave:function(){r._oCreateNode.close();sap.ui.getCore().byId("idText").setVisible(false);sap.ui.getCore().byId("idCrDg").setTitle("");r._oCreateNode.destroy(true)},onCancel:function(){r._oCreateNode.close();sap.ui.getCore().byId("idText").setVisible(false);sap.ui.getCore().byId("idCrDg").setTitle("");r._oCreateNode.destroy(true)}})});