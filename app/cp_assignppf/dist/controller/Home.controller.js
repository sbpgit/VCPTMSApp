sap.ui.define(["cp/appf/cpassignppf/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,s,a,o,i,r,l){"use strict";var d,g;return e.extend("cp.appf.cpassignppf.controller.Home",{onInit:function(){d=this;d.oListModel=new a;d.oParamModel=new a;d.oAlgoListModel=new a},onAfterRendering:function(){d=this;d.oList=this.byId("profList");d.oList.removeSelections();if(d.oList.getBinding("items")){d.oList.getBinding("items").filter([])}this.getData()},getData:function(){this.getModel("BModel").read("/getProfiles",{success:function(e){d.oListModel.setData({results:e.results});d.oList.setModel(d.oListModel)},error:function(){t.show("Failed to get profiles")}})},onSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),s=[];if(t!==""){s.push(new o({filters:[new o("PROFILE",i.Contains,t),new o("PRF_DESC",i.Contains,t)],and:false}))}d.oList.getBinding("items").filter(s)},onParameters:function(e){var s=e.getSource().getParent().getCells()[0].getTitle();var a=e.getSource().getParent().getCells()[1].getText();var r="Parameters "+" "+" - "+s+" "+" - "+a;if(!d._onParameter){d._onParameter=sap.ui.xmlfragment("cp.appf.cpassignppf.view.Parameter",d);d.getView().addDependent(d._onParameter)}d._onParameter.setTitleAlignment("Center");d._onParameter.setTitle(r);d.paramList=sap.ui.getCore().byId("idParam");this.getModel("BModel").read("/getProfileParameters",{filters:[new o("PROFILE",i.EQ,s),new o("METHOD",i.EQ,a)],success:function(e){d.oParamModel.setData({results:e.results});d.paramList.setModel(d.oParamModel);d._onParameter.open()},error:function(){t.show("Failed to get data")}})},onParaClose:function(){d._onParameter.close()},onCreate:function(e){d.oGModel=d.getModel("oGModel");var s=e.getSource().getTooltip();d.oGModel.setProperty("/sId",s);if(s==="Copy"){var a=this.byId("profList").getSelectedItems();if(a.length){var o=a[0].getBindingContext().getProperty();d.oGModel.setProperty("/sProfile",o.PROFILE);d.oGModel.setProperty("/sProf_desc",o.PRF_DESC);d.oGModel.setProperty("/sMethod",o.METHOD);var i=sap.ui.core.UIComponent.getRouterFor(d);i.navTo("Detail",{},true)}else{t.show("Please select one row")}}else{var i=sap.ui.core.UIComponent.getRouterFor(d);i.navTo("Detail",{},true)}},onPpfAdd:function(e){if(!d._onAddppf){d._onAddppf=sap.ui.xmlfragment("cp.appf.cpassignppf.view.Create",d);d.getView().addDependent(d._onAddppf)}d._onAddppf.setTitleAlignment("Center");var s=e.getSource().getTooltip();if(s==="Add"){sap.ui.getCore().byId("idPn").setValue("");sap.ui.getCore().byId("idPdesc").setValue("");sap.ui.getCore().byId("idCretBy").setValue("");sap.ui.getCore().byId("idAuth").setValue("");sap.ui.getCore().byId("idAlgo").setSelectedKey("N");sap.ui.getCore().byId("idTab").destroyItems();d._onAddppf.open()}else if(s==="Copy"){var a=this.byId("profList").getSelectedItems();if(a.length){var o=a[0].getBindingContext().getProperty();sap.ui.getCore().byId("idPn").setValue(o.PROFILE);sap.ui.getCore().byId("idPdesc").setValue(o.PRF_DESC);sap.ui.getCore().byId("idCretBy").setValue("");sap.ui.getCore().byId("idAuth").setValue("");if(o.METHOD==="MLR"){sap.ui.getCore().byId("idAlgo").setSelectedKey("M")}else if(o.METHOD==="HGBT"){sap.ui.getCore().byId("idAlgo").setSelectedKey("H")}else if(o.METHOD==="VARMA"){sap.ui.getCore().byId("idAlgo").setSelectedKey("V")}else{sap.ui.getCore().byId("idAlgo").setSelectedKey("N")}d.onAlgorChange();d._onAddppf.setTitle("Copy");d._onAddppf.open()}else{t.show("Please Select one row to change")}}},onAddClose:function(){d._onAddppf.close()},onAlgorChange:function(e){var s=sap.ui.getCore().byId("idAlgo")._getSelectedItemText();d.alogoList=sap.ui.getCore().byId("idTab");var a=new o("METHOD",i.EQ,s);this.getModel("PModel").read("/get_palparameters",{filters:[a],success:function(e){e.results.forEach(function(e){e.FLAG=e.DATATYPE},d);d.oAlgoListModel.setData({results:e.results});d.alogoList.setModel(d.oAlgoListModel)},error:function(){t.show("Failed to get data")}})},onLive:function(e){sap.ui.getCore().byId("idSave").setEnabled(true);if(e){var t=e.getParameter("newValue"),s=e.getParameter("id").split("-")[2]}else{var s=d.typeChange;t=sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].getValue()}var a=sap.ui.getCore().byId("idTab").getItems()[s].getCells()[1].getSelectedKey(),o=0;var i=/^[^*|\":<>[\]{}!`\\()';@&$]+$/;if(a==="DOUBLE"){sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setType("Number")}if(a==="INTEGER"){if(t%1===0&&parseInt(t).toString()===t.toString()||t===""){sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("None");o=0}else{sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("Error");o=o+1}}else if(a==="NVARCHAR"){var r=/^[A-Za-z0-9]+$/;if(r.test(t)&&i.test(t)||t===""){sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("None");o=0}else{sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("Error");o=o+1}}else if(a==="DOUBLE"){if(!/^\d+$/.test(t)&&t!==""){if(t.split(".")[1]!==""&&t!=="."){sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("None");o=0}else{sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("Error");o=o+1}}else{if(t===""){sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("None");o=0}else{sap.ui.getCore().byId("idTab").getItems()[s].getCells()[3].setValueState("Error");o=o+1}}}if(o===0){sap.ui.getCore().byId("idSave").setEnabled(true)}else{sap.ui.getCore().byId("idSave").setEnabled(false)}},onSubmit:function(e){sap.ui.core.BusyIndicator.show();var s={};s.PROFILE=sap.ui.getCore().byId("idPn").getValue();s.PRF_DESC=sap.ui.getCore().byId("idPdesc").getValue();s.CREATED_BY=sap.ui.getCore().byId("idCretBy").getValue();s.METHOD=sap.ui.getCore().byId("idAlgo")._getSelectedItemText();s.CREATED_DATE="2022-01-13";if(s.PROFILE!==""&&s.PRF_DESC!==""&&s.METHOD!==""){var a="/v2/catalog/getProfiles";$.ajax({url:a,type:"post",contentType:"application/json",data:JSON.stringify({PROFILE:s.PROFILE,METHOD:s.METHOD,PRF_DESC:s.PRF_DESC,CREATED_BY:s.CREATED_BY}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(JSON.stringify(e))},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Created Prediction Model")}})}else{t.show("Please fill all required fields");sap.ui.core.BusyIndicator.hide()}},tablesendbatch(e){var s=sap.ui.getCore().byId("idTab").getItems();d.getModel("BModel").setUseBatch(true);d.batchReq=true;for(var a=0;a<s.length;a++){var o,i,r,l,g,n,u;o=sap.ui.getCore().byId("idPn").getValue();i=sap.ui.getCore().byId("idAlgo")._getSelectedItemText();r=sap.ui.getCore().byId("idCretBy").getValue();l=s[a].getCells()[0].getText();if(s[a].getCells()[1].getSelectedKey()==="INTEGER"){if(s[a].getCells()[3].getValue()===""){g=s[a].getCells()[2].getText()}else{g=s[a].getCells()[3].getValue()}}else if(s[a].getCells()[1].getSelectedKey()==="DOUBLE"){if(s[a].getCells()[3].getValue()===""){n=s[a].getCells()[2].getText()}else{n=s[a].getCells()[3].getValue()}}else if(s[a].getCells()[1].getSelectedKey()==="DOUBLE"){if(s[a].getCells()[3].getValue()===""){u=s[a].getCells()[2].getText()}else{u=s[a].getCells()[3].getValue()}}d.getModel("BModel").createEntry("/getProfileParameters",{properties:{PROFILE:o,METHOD:i,CREATED_BY:r,PARA_NAME:l,INTVAL:g,DOUBLEVAL:n,STRVAL:u}})}if(d.batchReq){d.batchReq=false;d.getModel("BModel").submitChanges({success:function(e,s){sap.ui.core.BusyIndicator.hide();t.show("success to create entries")},error:function(e){sap.ui.core.BusyIndicator.hide();t.show("Failed to create entries")}})}}})});