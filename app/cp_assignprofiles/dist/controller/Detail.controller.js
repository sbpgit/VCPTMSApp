sap.ui.define(["cp/appf/cpassignprofiles/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,l,s,a,o,i,d){"use strict";var r,g;return e.extend("cp.appf.cpassignprofiles.controller.Detail",{onInit:function(){r=this;r.oListModel=new s;r.oParamModel=new s;r.oAlgoListModel=new s},onBack:function(){var e=[];r.oAlgoListModel.setData({results:e});r.byId("idTab").setModel(r.oAlgoListModel);var t=sap.ui.core.UIComponent.getRouterFor(r);t.navTo("Home",{},true)},onAfterRendering:function(){r=this;this.vDate=(new Date).toISOString().split("T")[0];r.oGModel=r.getModel("oGModel");var e=r.oGModel.getProperty("/sId");if(e==="Copy"||e==="Edit"){if(e==="Edit"){r.byId("idPn").setValue(r.oGModel.getProperty("/sProfile"));r.byId("idPn").setEditable(false);this.byId("idPage").setTitle("Edit Profile")}else{r.byId("idPn").setValue("");r.byId("idPn").setEditable(true);this.byId("idPage").setTitle("Create Profile")}r.byId("idPdesc").setValue(r.oGModel.getProperty("/sProf_desc"));r.byId("idAuth").setValue("");var t=r.oGModel.getProperty("/sMethod");if(t==="MLR"){r.byId("idAlgo").setSelectedKey("M")}else if(t==="HGBT"){r.byId("idAlgo").setSelectedKey("H")}else if(t==="VARMA"){r.byId("idAlgo").setSelectedKey("V")}else if(t==="RDT"){r.byId("idAlgo").setSelectedKey("R")}else{r.byId("idAlgo").setSelectedKey("N")}r.getParameters()}else{r.byId("idPn").setValue("");r.byId("idPdesc").setValue("");r.byId("idAuth").setValue("");r.byId("idAlgo").setSelectedKey("N");r.byId("idPn").setEditable(true);var l=[];r.oAlgoListModel.setData({results:l});r.byId("idTab").setModel(r.oAlgoListModel)}},getParameters:function(){var e=r.oGModel.getProperty("/sProfile"),l=r.oGModel.getProperty("/sMethod");this.getModel("BModel").read("/getProfileParameters",{filters:[new a("PROFILE",o.EQ,e),new a("METHOD",o.EQ,l)],success:function(e){r.alogoList=r.byId("idTab");e.results.forEach(function(e){e.DESCRIPTION=e.PARA_DESC;if(e.INTVAL!==null){e.DATATYPE="INTEGER";e.DEFAULTVAL=e.INTVAL}else if(e.DOUBLEVAL!==null){e.DATATYPE="DOUBLE";e.DEFAULTVAL=e.DOUBLEVAL}else if(e.STRVAL!==null){e.DATATYPE="NVARCHAR";e.DEFAULTVAL=e.STRVAL}},r);r.oAlgoListModel.setData({results:e.results});r.alogoList.setModel(r.oAlgoListModel)},error:function(){t.show("Failed to get data")}})},onAlgorChange:function(e){var l=r.byId("idAlgo")._getSelectedItemText();r.alogoList=r.byId("idTab");var s=new a("METHOD",o.EQ,l);this.getModel("PModel").read("/get_palparameters",{filters:[s],success:function(e){e.results.forEach(function(e){e.FLAG=e.DATATYPE},r);r.oAlgoListModel.setData({results:e.results});r.alogoList.setModel(r.oAlgoListModel)},error:function(){t.show("Failed to get data")}})},onLive:function(e){r.byId("idSave").setEnabled(true);if(e){var t=e.getParameter("newValue"),l=e.getParameter("id").split("-")[6]}else{var l=r.typeChange;t=r.byId("idTab").getItems()[l].getCells()[4].getValue()}var s=r.byId("idTab").getItems()[l].getCells()[2].getSelectedKey(),a=0;var o=/^[^*|\":<>[\]{}!`\\()';@&$]+$/;if(s==="DOUBLE"){r.byId("idTab").getItems()[l].getCells()[4].setType("Number")}if(s==="INTEGER"){if(t%1===0&&parseInt(t).toString()===t.toString()||t===""){r.byId("idTab").getItems()[l].getCells()[4].setValueState("None");a=0}else{r.byId("idTab").getItems()[l].getCells()[4].setValueState("Error");a=a+1}}else if(s==="NVARCHAR"){var i=/^[A-Za-z0-9 ]+$/;if(i.test(t)&&o.test(t)||t===""){r.byId("idTab").getItems()[l].getCells()[4].setValueState("None");a=0}else{r.byId("idTab").getItems()[l].getCells()[4].setValueState("Error");a=a+1}}else if(s==="DOUBLE"){if(!/^\d+$/.test(t)&&t!==""){if(t.split(".")[1]!==""&&t!=="."){r.byId("idTab").getItems()[l].getCells()[4].setValueState("None");a=0}else{r.byId("idTab").getItems()[l].getCells()[4].setValueState("Error");a=a+1}}else{if(t===""){r.byId("idTab").getItems()[l].getCells()[4].setValueState("None");a=0}else{r.byId("idTab").getItems()[l].getCells()[4].setValueState("Error");a=a+1}}}if(a===0){r.byId("idSave").setEnabled(true)}else{r.byId("idSave").setEnabled(false)}},onSubmit:function(e){sap.ui.core.BusyIndicator.show();var l=r.oGModel.getProperty("/sId");var s="";if(l==="Edit"){s="E"}var a={};a.PROFILE=r.byId("idPn").getValue();a.PRF_DESC=r.byId("idPdesc").getValue();a.CREATED_BY=s;a.METHOD=r.byId("idAlgo")._getSelectedItemText();if(a.PROFILE!==""&&a.PRF_DESC!==""&&a.METHOD!==""){r.getModel("BModel").callFunction("/createProfiles",{method:"GET",urlParameters:{PROFILE:a.PROFILE,METHOD:a.METHOD,PRF_DESC:a.PRF_DESC,CREATED_DATE:r.vDate,CREATED_BY:""},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Created Prediction profile");r.tablesendbatch()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("failed to created Prediction profile")}})}else{t.show("Please fill all required fields");sap.ui.core.BusyIndicator.hide()}},tablesendbatch:function(e){var t=r.byId("idTab").getItems(),l={PROFILEPARA:[]},s,a=0;let o=null;r.getModel("BModel").setUseBatch(true);r.batchReq=true;r.count=t.length;r.comp=0;sap.ui.core.BusyIndicator.show();var i=r.oGModel.getProperty("/sId");var d;if(i==="Create"||i==="Copy"){d="I"}else if(i==="Edit"){d="E"}for(var g=0;g<t.length;g++){var n,u,A,I,E,c="",T="",f="";s={};n=r.byId("idPn").getValue();u=r.byId("idAlgo")._getSelectedItemText();I=t[g].getCells()[0].getText();E=t[g].getCells()[1].getText();if(t[g].getCells()[2].getSelectedKey()==="INTEGER"){if(t[g].getCells()[4].getValue()===""){c=parseInt(t[g].getCells()[3].getText())}else{if(t[g].getCells()[4].getValue()=="No default value"){c="0"}else{c=parseInt(t[g].getCells()[4].getValue())}}s={PROFILE:n,METHOD:u,PARA_NAME:I,PARA_DESC:E,INTVAL:c,DOUBLEVAL:"0.0",STRVAL:""}}else if(t[g].getCells()[2].getSelectedKey()==="DOUBLE"){if(t[g].getCells()[4].getValue()===""){T=parseFloat(t[g].getCells()[3].getText())}else{if(t[g].getCells()[4].getValue()=="No default value"){T="0.0"}else{T=parseFloat(t[g].getCells()[4].getValue())}}s={PROFILE:n,METHOD:u,PARA_NAME:I,PARA_DESC:E,INTVAL:"0",DOUBLEVAL:T,STRVAL:""}}else if(t[g].getCells()[2].getSelectedKey()==="NVARCHAR"){if(t[g].getCells()[4].getValue()===""){f=t[g].getCells()[3].getText()}else{f=t[g].getCells()[4].getValue()}s={PROFILE:n,METHOD:u,PARA_NAME:I,PARA_DESC:E,INTVAL:"0",DOUBLEVAL:"0.0",STRVAL:f}}l.PROFILEPARA.push(s);sap.ui.core.BusyIndicator.show();r.getModel("BModel").callFunction("/createProfilePara",{method:"GET",urlParameters:{FLAG:d,PROFILE:n,METHOD:u,PARA_NAME:I,INTVAL:s.INTVAL,DOUBLEVAL:s.DOUBLEVAL,STRVAL:s.STRVAL,PARA_DESC:E,PARA_DEP:"",CREATED_DATE:r.vDate,CREATED_BY:""},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Created profile parameters");r.onBack()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Failed to create profile parameters")}})}}})});