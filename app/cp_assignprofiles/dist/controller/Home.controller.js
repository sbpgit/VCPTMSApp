sap.ui.define(["cp/appf/cpassignprofiles/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,s,a,r,n,i){"use strict";var l,d;return e.extend("cp.appf.cpassignprofiles.controller.Home",{onInit:function(){l=this;l.oListModel=new s;l.oParamModel=new s;l.oAlgoListModel=new s},onAfterRendering:function(){l=this;l.oList=this.byId("profList");this.byId("headSearch").setValue("");l.oList.removeSelections();if(l.oList.getBinding("items")){l.oList.getBinding("items").filter([])}this.getData()},getData:function(){this.getModel("BModel").read("/getProfiles",{success:function(e){l.oListModel.setData({results:e.results});l.oList.setModel(l.oListModel)},error:function(){t.show("Failed to get profiles")}})},onSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=[];if(t!==""){o.push(new a({filters:[new a("PROFILE",r.Contains,t),new a("PRF_DESC",r.Contains,t),new a("METHOD",r.Contains,t)],and:false}))}l.oList.getBinding("items").filter(o)},onParameters:function(e){var o=e.getSource().getParent().getCells()[0].getTitle();var s=e.getSource().getParent().getCells()[1].getText();var n="Parameters "+" "+" - "+o+" "+" - "+s;if(!l._onParameter){l._onParameter=sap.ui.xmlfragment("cp.appf.cpassignprofiles.view.Parameter",l);l.getView().addDependent(l._onParameter)}l._onParameter.setTitleAlignment("Center");l._onParameter.setTitle(n);l.paramList=sap.ui.getCore().byId("idParam");this.getModel("BModel").read("/getProfileParameters",{filters:[new a("PROFILE",r.EQ,o),new a("METHOD",r.EQ,s)],success:function(e){l.oParamModel.setData({results:e.results});l.paramList.setModel(l.oParamModel);l._onParameter.open()},error:function(){t.show("Failed to get data")}})},onParaClose:function(){l._onParameter.close()},onCreate:function(e){l.oGModel=l.getModel("oGModel");var o=e.getSource().getTooltip();l.oGModel.setProperty("/sId",o);if(o==="Copy"||o==="Edit"){var s=this.byId("profList").getSelectedItems();if(s.length){var a=this.byId("profList").getSelectedItem().getBindingContext().getProperty().CREATED_BY;var r=s[0].getBindingContext().getProperty();l.oGModel.setProperty("/sProfile",r.PROFILE);l.oGModel.setProperty("/sProf_desc",r.PRF_DESC);l.oGModel.setProperty("/sMethod",r.METHOD);l.oGModel.setProperty("/sCreatedBy",a);var n=sap.ui.core.UIComponent.getRouterFor(l);n.navTo("Detail",{},true)}else{t.show("Please select one row")}}else if(o==="Create"){var n=sap.ui.core.UIComponent.getRouterFor(l);n.navTo("Detail",{},true)}},onAddClose:function(){l._onAddppf.close()},onDelete:function(e){var t=this.byId("profList").getSelectedItems()[0].getBindingContext().getProperty();sap.ui.core.BusyIndicator.show();var o={};o.PROFILE=t.PROFILE;o.METHOD=t.METHOD;o.PRF_DESC="D";var s="/v2/catalog/getProfiles";$.ajax({url:s,type:"post",contentType:"application/json",data:JSON.stringify({PROFILE:o.PROFILE,METHOD:o.METHOD,PRF_DESC:o.PRF_DESC}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(JSON.stringify(e))},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Profile deleted");l.tablesendbatch()}})},tablesendbatch:function(){var e={PROFILEPARA:[]},t;var o=this.byId("profList").getSelectedItems()[0].getBindingContext().getProperty();t={PROFILE:o.PROFILE,METHOD:o.METHOD,PARA_NAME:"",PARA_DESC:"",INTVAL:null,DOUBLEVAL:null,STRVAL:null};e.PROFILEPARA.push(t);var s="/v2/catalog/genProfileParam";$.ajax({url:s,type:"post",contentType:"application/json",data:JSON.stringify({FLAG:"D",PROFILEPARA:e.PROFILEPARA}),dataType:"json",async:false,timeout:0,error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show(JSON.stringify(e))},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Profile parameters deleted");l.onAfterRendering()}})}})});