sap.ui.define(["cp/appf/cpassignprofiles/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,r,s,a,i,n){"use strict";var l,d;return e.extend("cp.appf.cpassignprofiles.controller.Home",{onInit:function(){l=this;l.oListModel=new r;l.oParamModel=new r;l.oAlgoListModel=new r},onAfterRendering:function(){l=this;this.dDate=(new Date).toISOString().split("T")[0];l.oList=this.byId("profList");this.byId("headSearch").setValue("");l.oList.removeSelections();if(l.oList.getBinding("items")){l.oList.getBinding("items").filter([])}this.getData()},getData:function(){this.getModel("BModel").read("/getProfiles",{success:function(e){l.oListModel.setData({results:e.results});l.oList.setModel(l.oListModel)},error:function(){t.show("Failed to get profiles")}});l.doSomethingUserDetails()},onSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=[];if(t!==""){o.push(new s({filters:[new s("PROFILE",a.Contains,t),new s("PRF_DESC",a.Contains,t),new s("METHOD",a.Contains,t)],and:false}))}l.oList.getBinding("items").filter(o)},onParameters:function(e){var o=e.getSource().getParent().getCells()[0].getTitle();var r=e.getSource().getParent().getCells()[1].getText();var i="Parameters "+" "+" - "+o+" "+" - "+r;if(!l._onParameter){l._onParameter=sap.ui.xmlfragment("cp.appf.cpassignprofiles.view.Parameter",l);l.getView().addDependent(l._onParameter)}l._onParameter.setTitleAlignment("Center");l._onParameter.setTitle(i);l.paramList=sap.ui.getCore().byId("idParam");this.getModel("BModel").read("/getProfileParameters",{filters:[new s("PROFILE",a.EQ,o),new s("METHOD",a.EQ,r)],success:function(e){l.oParamModel.setData({results:e.results});l.paramList.setModel(l.oParamModel);l._onParameter.open()},error:function(){t.show("Failed to get data")}})},onParaClose:function(){l._onParameter.close()},onCreate:function(e){l.oGModel=l.getModel("oGModel");var o=e.getSource().getTooltip();l.oGModel.setProperty("/sId",o);if(o==="Copy"||o==="Edit"){var r=this.byId("profList").getSelectedItems();if(r.length){var s=this.byId("profList").getSelectedItem().getBindingContext().getProperty().CREATED_BY;var a=r[0].getBindingContext().getProperty();l.oGModel.setProperty("/sProfile",a.PROFILE);l.oGModel.setProperty("/sProf_desc",a.PRF_DESC);l.oGModel.setProperty("/sMethod",a.METHOD);l.oGModel.setProperty("/sCreatedBy",s);var i=sap.ui.core.UIComponent.getRouterFor(l);i.navTo("Detail",{},true)}else{t.show("Please select one row")}}else if(o==="Create"){var i=sap.ui.core.UIComponent.getRouterFor(l);i.navTo("Detail",{},true)}},onDelete:function(e){var t=this.byId("profList").getSelectedItems()[0].getBindingContext().getProperty();sap.ui.core.BusyIndicator.show();var o={};o.PROFILE=t.PROFILE;o.METHOD=t.METHOD;o.PRF_DESC="D";sap.ui.core.BusyIndicator.show();l.getModel("BModel").callFunction("/createProfiles",{method:"GET",urlParameters:{PROFILE:o.PROFILE,METHOD:o.METHOD,PRF_DESC:o.PRF_DESC,CREATED_DATE:l.dDate,CREATED_BY:""},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Profile deleted");l.tablesendbatch()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Failed to delete Profile parameters")}})},tablesendbatch:function(){var e=this.byId("profList").getSelectedItems()[0].getBindingContext().getProperty();sap.ui.core.BusyIndicator.show();l.getModel("BModel").callFunction("/createProfilePara",{method:"GET",urlParameters:{FLAG:"D",PROFILE:e.PROFILE,METHOD:e.METHOD,PARA_NAME:"",INTVAL:0,DOUBLEVAL:0,STRVAL:"",PARA_DESC:"",PARA_DEP:"",CREATED_DATE:l.dDate,CREATED_BY:""},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Profile parameters deleted");l.onAfterRendering()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Failed to delete Profile parameters")}})},onNavPress:function(){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var e=sap.ushell.Container.getService("CrossApplicationNavigation");var t=e&&e.hrefForExternal({target:{semanticObject:"vcpdocdisplay",action:"Display"}})||"";var o=window.location.href.split("#")[0]+t;sap.m.URLHelper.redirect(o,true)}},doSomethingUserDetails:async function(){const e=await this.getUserInfoService();const t=e.getId()},getUserInfoService:function(){return new Promise(e=>sap.ui.require(["sap/ushell/library"],t=>{const o=t.Container;const r=o.getServiceAsync("UserInfo");e(r)}))}})});