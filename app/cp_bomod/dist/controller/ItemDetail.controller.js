sap.ui.define(["cp/appf/cpbomod/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,a,d,s,r,n){"use strict";var l,i;return e.extend("cp.appf.cpbomod.controller.ItemDetail",{onInit:function(){l=this;this.bus=sap.ui.getCore().getEventBus();l.oBomModel=new a;l.oBomOnPanelModel=new a;l.oCharModel=new a;this.oBomModel.setSizeLimit(1e3);this.oCharModel.setSizeLimit(1e3);i=l.getOwnerComponent().getModel("oGModel")},onAfterRendering:function(){i=l.getOwnerComponent().getModel("oGModel");sap.ui.core.BusyIndicator.show();var e=i.getProperty("/prdId");var o=i.getProperty("/locId");this.getModel("BModel").read("/getBomOdCond",{filters:[new d("LOCATION_ID",s.EQ,o),new d("PRODUCT_ID",s.EQ,e)],success:function(e){if(e.results.length===0){l.byId("idBomPanel").setExpanded(true);l.byId("idCharPanel").setExpanded(false);l.oBomModel.setData({results:[]});l.byId("idBom").setModel(l.oBomModel);l.oCharModel.setData({charResults:[]});l.byId("idChartab").setModel(l.oCharModel);l.oBomOnPanelModel.setData({BOMPanelresults:[]});l.byId("idBomOnNextPanel").setModel(l.oBomOnPanelModel)}else{l.oBomModel.setData({results:e.results});l.byId("idBom").setModel(l.oBomModel);l.byId("idBom").removeSelections(true);l.byId("idBomPanel").setExpanded(true);l.byId("idCharPanel").setExpanded(false)}l.byId("bomSearch").setValue("");sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},onItemPress:function(){sap.ui.core.BusyIndicator.show();var e=this.byId("idBom").getSelectedItem().getCells()[2].getText();i.setProperty("/objdep",e);this.getModel("BModel").read("/getODcharval",{filters:[new d("OBJ_DEP",s.EQ,e)],success:function(e){l.oCharModel.setData({charResults:e.results});l.byId("idChartab").setModel(l.oCharModel);l.byId("idBomPanel").setExpanded(false);l.byId("idCharPanel").setExpanded(true);l.byId("charSearch").setValue("");l.oncharSearch();l.BomOnPanelNext();sap.ui.core.BusyIndicator.hide()},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})},BomOnPanelNext:function(){var e=this.byId("idBom").getSelectedItem().getCells();var t=[{ITEM_NUM:e[0].getText(),COMPONENT:e[1].getText(),OBJ_DEP:e[2].getText(),OBJDEP_DESC:e[3].getText(),COMP_QTY:e[4].getText(),VALID_FROM:e[5].getText(),VALID_TO:e[6].getText()}];l.oBomOnPanelModel.setData({BOMPanelresults:t});l.byId("idBomOnNextPanel").setModel(l.oBomOnPanelModel);sap.ui.core.BusyIndicator.hide()},onbomSearch:function(e){var o="",a=[];if(e){var o=l.byId("bomSearch").getValue()}o=o.toUpperCase();sap.ui.core.BusyIndicator.show();var r=i.getProperty("/prdId");var n=i.getProperty("/locId");a.push(new d({filters:[new d("LOCATION_ID",s.EQ,n),new d("PRODUCT_ID",s.EQ,r)],and:true}));if(o!==""){a.push(new d({filters:[new d("COMPONENT",s.StartsWith,o),new d("OBJ_DEP",s.StartsWith,o)],and:false}))}this.getModel("BModel").read("/getBomOdCond",{filters:[a],success:function(e){l.oBomModel.setData({results:e.results});l.byId("idBom").setModel(l.oBomModel);l.byId("idBom").removeSelections(true);l.byId("idBomPanel").setExpanded(true);l.byId("idCharPanel").setExpanded(false);sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},oncharSearch:function(e){var t="",o=[];if(e){t=e.getParameter("value")||e.getParameter("newValue")}if(t!==""){o.push(new d({filters:[new d("CLASS_NAME",s.Contains,t),new d("CHAR_NAME",s.Contains,t),new d("CHAR_VALUE",s.Contains,t)],and:false}))}l.byId("idChartab").getBinding("items").filter(o)}})});