sap.ui.define(["cp/appf/cpbomod/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,a,d,s,r,n){"use strict";var i,l;return e.extend("cp.appf.cpbomod.controller.ItemDetail",{onInit:function(){i=this;this.bus=sap.ui.getCore().getEventBus();i.oBomModel=new a;i.oBomOnPanelModel=new a;i.oCharModel=new a;this.oBomModel.setSizeLimit(1e3);this.oCharModel.setSizeLimit(1e3);l=i.getOwnerComponent().getModel("oGModel")},onAfterRendering:function(){l=i.getOwnerComponent().getModel("oGModel");sap.ui.core.BusyIndicator.show();var e=l.getProperty("/prdId");var o=l.getProperty("/locId");this.getModel("BModel").read("/getBomOdCond",{filters:[new d("LOCATION_ID",s.EQ,o),new d("PRODUCT_ID",s.EQ,e)],success:function(e){if(e.results.length===0){i.byId("idBomPanel").setExpanded(true);i.byId("idCharPanel").setExpanded(false)}else{i.oBomModel.setData({results:e.results});i.byId("idBom").setModel(i.oBomModel);i.byId("idBom").removeSelections(true);i.byId("idBomPanel").setExpanded(true);i.byId("idCharPanel").setExpanded(false)}i.byId("bomSearch").setValue("");sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},onItemPress:function(){sap.ui.core.BusyIndicator.show();var e=this.byId("idBom").getSelectedItem().getCells()[2].getText();l.setProperty("/objdep",e);this.getModel("BModel").read("/getODcharval",{filters:[new d("OBJ_DEP",s.EQ,e)],success:function(e){i.oCharModel.setData({charResults:e.results});i.byId("idChartab").setModel(i.oCharModel);i.byId("idBomPanel").setExpanded(false);i.byId("idCharPanel").setExpanded(true);i.byId("charSearch").setValue("");i.oncharSearch();i.BomOnPanelNext();sap.ui.core.BusyIndicator.hide()},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})},BomOnPanelNext:function(){var e=this.byId("idBom").getSelectedItem().getCells();var t=[{ITEM_NUM:e[0].getText(),COMPONENT:e[1].getText(),OBJ_DEP:e[2].getText(),OBJDEP_DESC:e[3].getText(),COMP_QTY:e[4].getText(),VALID_FROM:e[5].getText(),VALID_TO:e[6].getText()}];i.oBomOnPanelModel.setData({BOMPanelresults:t});i.byId("idBomOnNextPanel").setModel(i.oBomOnPanelModel);sap.ui.core.BusyIndicator.hide()},onbomSearch:function(e){var o="",a=[];if(e){var o=e.getParameters().query}o=o.toUpperCase();sap.ui.core.BusyIndicator.show();var r=l.getProperty("/prdId");var n=l.getProperty("/locId");a.push(new d({filters:[new d("LOCATION_ID",s.EQ,n),new d("PRODUCT_ID",s.EQ,r)],and:true}));if(o!==""){a.push(new d({filters:[new d("COMPONENT",s.StartsWith,o),new d("OBJ_DEP",s.StartsWith,o)],and:false}))}this.getModel("BModel").read("/getBomOdCond",{filters:[a],success:function(e){i.oBomModel.setData({results:e.results});i.byId("idBom").setModel(i.oBomModel);i.byId("idBom").removeSelections(true);i.byId("idBomPanel").setExpanded(true);i.byId("idCharPanel").setExpanded(false);sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},oncharSearch:function(e){var t="",o=[];if(e){var t=e.getParameter("value")||e.getParameter("newValue")}if(t!==""){o.push(new d({filters:[new d("CLASS_NAME",s.Contains,t),new d("CHAR_NAME",s.Contains,t),new d("CHAR_VALUE",s.Contains,t)],and:false}))}i.byId("idChartab").getBinding("items").filter(o)}})});