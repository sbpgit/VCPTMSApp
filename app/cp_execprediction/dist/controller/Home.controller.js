sap.ui.define(["sap/ui/core/mvc/Controller","cp/execpred/cpexecprediction/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,o,s,l,n){"use strict";var a,d;return t.extend("cp.execpred.cpexecprediction.controller.Home",{onInit:function(){this.locModel=new i;this.prodModel=new i;this.odModel=new i;this.ppfModel=new i;this.oODPModel=new i;this.otabModel=new i;this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.execpred.cpexecprediction.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.execpred.cpexecprediction.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogOD){this._valueHelpDialogOD=sap.ui.xmlfragment("cp.execpred.cpexecprediction.view.ObjDepDialog",this);this.getView().addDependent(this._valueHelpDialogOD)}if(!this._valueHelpDialogPPF){this._valueHelpDialogPPF=sap.ui.xmlfragment("cp.execpred.cpexecprediction.view.PredProfileDialog",this);this.getView().addDependent(this._valueHelpDialogPPF)}this.getRouter().getRoute("Home").attachPatternMatched(this._onPatternMatched.bind(this))},_onPatternMatched:function(){d=this;this.oPanel=this.byId("idPanel");this.oODTable=this.byId("odlList");this.oTable=this.byId("pmdlList");this.i18n=this.getResourceBundle();this.oGModel=this.getModel("GModel");this.oLoc=this.byId("locInput");this.oProd=this.byId("prodInput");this.oObjDep=this.byId("odInput");this.oPredProfile=this.byId("pmInput");this.aVcRulesList=[];this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oODList=this._oCore.byId(this._valueHelpDialogOD.getId()+"-list");this.oPPFList=this._oCore.byId(this._valueHelpDialogPPF.getId()+"-list");this.getModel("BModel").read("/getLocation",{success:function(e){d.locModel.setData(e);d.oLocList.setModel(d.locModel)},error:function(e,t){l.show("error")}});this.getModel("BModel").read("/getProducts",{success:function(e){d.prodModel.setData(e);d.oProdList.setModel(d.prodModel)},error:function(e,t){l.show("error")}});this.getModel("BModel").read("/getObjDepProfiles",{success:function(e){d.odModel.setData(e);d.oODList.setModel(d.odModel)},error:function(e,t){l.show("error")}});this.getModel("BModel").read("/getProfiles",{success:function(e){d.ppfModel.setData(e);d.oPPFList.setModel(d.ppfModel)},error:function(e,t){l.show("error")}})},handleValueHelp:function(e){var t=e.getParameter("id");if(t.includes("loc")){this._valueHelpDialogLoc.open()}else if(t.includes("prod")){this._valueHelpDialogProd.open()}else if(t.includes("od")||t.includes("__button1")){if(d.oLoc.getValue()&&d.oProd.getTokens()){if(this.oODList.getBinding("items")){this.oODList.getBinding("items").filter([new o("LOCATION_ID",s.Contains,d.oLocList.getSelectedItem().getTitle()),new o("PRODUCT_ID",s.Contains,"KM_M219VBVS_BVS")])}this._valueHelpDialogOD.open()}else{l.show(d.i18n.getText("noLocProd"))}}else{this._valueHelpDialogPPF.open()}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){d._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(d.oLocList.getBinding("items")){d.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){d._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(d.oProdList.getBinding("items")){d.oProdList.getBinding("items").filter([])}}else if(t.includes("od")||t.includes("__button1")){d._oCore.byId(this._valueHelpDialogOD.getId()+"-searchField").setValue("");if(d.oODList.getBinding("items")){d.oODList.getBinding("items").filter([])}}else{d._oCore.byId(this._valueHelpDialogPPF.getId()+"-searchField").setValue("");if(d.oPPFList.getBinding("items")){d.oPPFList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),i=e.getParameter("id"),l=[];t=t?t.trim():"";if(i.includes("loc")){if(t!==""){l.push(new o({filters:[new o("LOCATION_ID",s.Contains,t),new o("LOCATION_DESC",s.Contains,t)],and:false}))}d.oLocList.getBinding("items").filter(l)}else if(i.includes("prod")){if(t!==""){l.push(new o({filters:[new o("PRODUCT_ID",s.Contains,t),new o("PROD_DESC",s.Contains,t)],and:false}))}d.oProdList.getBinding("items").filter(l)}else if(i.includes("od")){if(t!==""){l.push(new o({filters:[new o("LOCATION_ID",s.Contains,t),new o("PRODUCT_ID",s.Contains,t),new o("COMPONENT",s.Contains,t),new o("OBJ_DEP",s.Contains,t)],and:false}))}d.oODList.getBinding("items").filter(l)}else{if(t!==""){l.push(new o({filters:[new o("PROFILE",s.Contains,t),new o("METHOD",s.Contains,t),new o("PRF_DESC",s.Contains,t)],and:false}))}d.oPPFList.getBinding("items").filter(l)}},handleSelection:function(e){var t=e.getParameter("id"),i=e.getParameter("selectedItems"),o,s=[];if(t.includes("Loc")){o=e.getParameter("selectedItems");d.oLoc.setValue(o[0].getTitle())}else if(t.includes("prod")){d.oProdList.getBinding("items").filter([]);o=e.getParameter("selectedItems");if(o&&o.length>0){d.oProd.removeAllTokens();o.forEach(function(e){d.oProd.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}}else if(t.includes("od")){d.oODList.getBinding("items").filter([]);d.oODTable.setModel(d.oODPModel);o=e.getParameter("selectedItems");if(o&&o.length>0){d.oObjDep.removeAllTokens();o.forEach(function(e){s.push({GroupID:e.getTitle()});d.oObjDep.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))});this.oODPModel.setData({results:s})}}else{d.oPPFList.getBinding("items").filter([]);o=e.getParameter("selectedItems");if(o&&o.length>0){o.forEach(function(e){d.oPredProfile.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}}d.handleClose(e)},handleTokenUpdate:function(e){var t=e.getSource().getId(),i=e.getParameter("removedTokens"),o,s,l;if(i){o=i[0].getProperty("key")}else{o=e.getParameter("item").getName()}if(t.includes("prod")){s=d.oProdList.getSelectedItems();for(l=0;l<s.length;l++){if(s[l].getTitle()===o){s[l].setSelected(false)}}}else if(t.includes("od")){s=d.oProdList.getSelectedItems();for(l=0;l<s.length;l++){if(s[l].getTitle()===o){s[l].setSelected(false);d.oODList.removeitem(aItem[l])}}}else if(t.includes("pmInput")){s=d.oProdList.getSelectedItems();for(l=0;l<s.length;l++){if(s[l].getTitle()===o){s[l].setSelected(false)}}}},onRun2:function(){this.oModel=this.getModel("PModel");var e,t,i=[],o;e=this.oODList.getSelectedItems();d.byId("pmdlList").setModel(this.otabModel);if(this.oObjDep.getTokens().length>0&&this.oPredProfile.getTokens().length>0){for(t=0;t<e.length;t++){var s={vcRulesList:[]},n;n={Location:e[t].getInfo(),Product:e[t].getDescription(),GroupID:e[t].getTitle()};s.vcRulesList.push(n);var a="/v2/pal/generatePredictions";$.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify({vcRulesList:s.vcRulesList}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(d.i18n.getText("genPredErr"))},success:function(e){sap.m.MessageToast.show(d.i18n.getText("genPredSuccess"));i.push(e.d.values[0].vcRulesList[0]);d.otabModel.setData({results:i});d.oPanel.setProperty("visible",true);o="X"}})}if(o==="X"){d.resetInputs()}}else{l.show(d.i18n.getText("errInput"))}},resetInputs:function(){this.oLoc.setValue("");this.oObjDep.destroyTokens();this.oLocList.removeSelections();this.oODList.removeSelections();this.oPredProfile.destroyTokens();this.oPPFList.removeSelections();this.oProd.destroyTokens();this.oProdList.removeSelections()},onRun:function(){this.oModel=this.getModel("PModel");var e=[];var t={vcRulesList:[]};var i={Location:"FR10",Product:"KM_M219VBVS_BVS",GroupID:"M219VV00105NN_1"};t.vcRulesList.push(i);var o="/v2/pal/generatePredictions";$.ajax({url:o,type:"post",contentType:"application/json",data:JSON.stringify({vcRulesList:t.vcRulesList}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(JSON.stringify(e))},success:function(e){sap.m.MessageToast.show("Generated Regression Models")}})}})});