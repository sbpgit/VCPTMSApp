sap.ui.define(["sap/ui/core/mvc/Controller","cp/exereg/cpexeregressionmdls/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,o,s,i,l,n){"use strict";var a,r;return t.extend("cp.exereg.cpexeregressionmdls.controller.Home",{onInit:function(){this.locModel=new o;this.prodModel=new o;this.odModel=new o;this.ppfModel=new o;this.otabModel=new o;this.prodModel.setSizeLimit(5e3);this.odModel.setSizeLimit(5e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.exereg.cpexeregressionmdls.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.exereg.cpexeregressionmdls.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogOD){this._valueHelpDialogOD=sap.ui.xmlfragment("cp.exereg.cpexeregressionmdls.view.ObjDepDialog",this);this.getView().addDependent(this._valueHelpDialogOD)}if(!this._valueHelpDialogPPF){this._valueHelpDialogPPF=sap.ui.xmlfragment("cp.exereg.cpexeregressionmdls.view.PredDialog",this);this.getView().addDependent(this._valueHelpDialogPPF)}this.getRouter().getRoute("Home").attachPatternMatched(this._onPatternMatched.bind(this))},_onPatternMatched:function(){r=this;this.oPanel=this.byId("idPanel");this.oTable=this.byId("rmdlList");this.i18n=this.getResourceBundle();this.oGModel=this.getModel("GModel");this.oLoc=this.byId("locInput");this.oProd=this.byId("prodInput");this.oObjDep=this.byId("odInput");this.oPredProfile=this.byId("pmInput");this.aVcRulesList=[];this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oODList=this._oCore.byId(this._valueHelpDialogOD.getId()+"-list");this.oPPFList=this._oCore.byId(this._valueHelpDialogPPF.getId()+"-list");this.getModel("BModel").read("/getLocation",{success:function(e){r.locModel.setData(e);r.oLocList.setModel(r.locModel)},error:function(e,t){l.show("error")}});this.getModel("BModel").read("/getProducts",{success:function(e){e.results.unshift({PRODUCT_ID:"All",PROD_DESC:"All"});r.prodModel.setData(e);r.oProdList.setModel(r.prodModel)},error:function(e,t){l.show("error")}});this.getModel("BModel").callFunction("/get_objdep",{method:"GET",urlParameters:{},success:function(e){r.objDep=e.results;r.odModel.setData(e);r.oODList.setModel(r.odModel)},error:function(e){l.show("error")}});this.getModel("BModel").read("/getProfiles",{success:function(e){r.ppfModel.setData(e);r.oPPFList.setModel(r.ppfModel)},error:function(e,t){l.show("error")}})},onRun2:function(){var e=r.byId("idCheck").getSelected();var t="Do you want to override assignments?";if(e===true){sap.m.MessageBox.show(t,{title:"Confirmation",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){r.onRunSend()}}})}else{r.onRunSend()}},onRunSend:function(){this.oModel=this.getModel("PModel");var e,t,o,s,i,n=[],a;var d={vcRulesList:[]},g;e=this.oODList.getSelectedItems();t=this.oProdList.getSelectedItems(),o=r.oPredProfile.getTokens()[0].getText(),s=r.byId("idCheck").getSelected();if(this.oObjDep.getTokens().length>0&&this.oPredProfile.getTokens().length>0){if(e[0].getTitle()==="All_"&&t[0].getTitle()==="All"){var d={vcRulesList:[]},g;g={profile:o,override:true,Location:e[1].getInfo(),Product:"All",GroupID:"All"};d.vcRulesList.push(g);var c="/v2/pal/generateRegModels";$.ajax({url:c,type:"POST",contentType:"application/json",data:JSON.stringify({vcRulesList:d.vcRulesList}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(r.i18n.getText("genRegErr"))},success:function(e){sap.m.MessageToast.show(r.i18n.getText("genRegSucc"));n.push(e.d.values[0].vcRulesList);r.otabModel.setData({results:n[0]});r.byId("rmdlList").setModel(r.otabModel);r.oPanel.setProperty("visible",true);a="X"}})}else{for(i=0;i<e.length;i++){if(e[i].getTitle()!=="All_"){g={profile:o,override:s,Location:e[i].getInfo(),Product:e[i].getDescription(),GroupID:e[i].getTitle()};d.vcRulesList.push(g)}}var c="/v2/pal/generateRegModels";$.ajax({url:c,type:"POST",contentType:"application/json",data:JSON.stringify({vcRulesList:d.vcRulesList}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(r.i18n.getText("genRegErr"))},success:function(e){sap.m.MessageToast.show(r.i18n.getText("genRegSucc"));n.push(e.d.values[0].vcRulesList);r.otabModel.setData({results:n[0]});r.byId("rmdlList").setModel(r.otabModel);r.oPanel.setProperty("visible",true);a="X"}})}if(a==="X"){r.resetInputs()}}else{l.show(r.i18n.getText("errInput"))}},onRun:function(){this.oModel=this.getModel("PModel");var e=[];var t={vcRulesList:[]};var o={Location:"FR10",Product:"KM_M219VBVS_BVS",GroupID:"M219VV00105NN_1"};t.vcRulesList.push(o);var s="/v2/pal/generateRegModels";$.ajax({url:s,type:"post",contentType:"application/json",data:JSON.stringify({vcRulesList:t.vcRulesList}),dataType:"json",async:false,timeout:0,error:function(e){sap.m.MessageToast.show(JSON.stringify(e))},success:function(e){sap.m.MessageToast.show("Generated Regression Models")}})},handleValueHelp:function(e){var t=e.getParameter("id");if(t.includes("loc")){this._valueHelpDialogLoc.open()}else if(t.includes("prod")){this._valueHelpDialogProd.open()}else if(t.includes("od")){if(r.oLoc.getValue()&&r.oProd.getTokens()){if(this.oODList.getBinding("items")){var o=r.oProdList.getSelectedItems();r.objDepData=[];if(this.oProdList.getSelectedItem().getTitle()==="All"){for(var s=0;s<r.objDep.length;s++){if(r.objDep[s].LOCATION_ID===r.oLocList.getSelectedItem().getTitle()){r.objDepData.push(r.objDep[s])}}}else{for(var i=0;i<o.length;i++){for(var s=0;s<r.objDep.length;s++){if(r.objDep[s].LOCATION_ID===r.oLocList.getSelectedItem().getTitle()&&r.objDep[s].PRODUCT_ID===o[i].getTitle()){r.objDepData.push(r.objDep[s])}}}}if(r.objDepData.length>1){r.objDepData.unshift({OBJ_DEP:"All",LOCATION_ID:"All",PRODUCT_ID:"All"})}r.odModel.setData({results:r.objDepData});r.oODList.setModel(r.odModel)}this._valueHelpDialogOD.open()}else{l.show(r.i18n.getText("noLocProd"))}}else{this._valueHelpDialogPPF.open()}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){r._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(r.oLocList.getBinding("items")){r.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){r._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(r.oProdList.getBinding("items")){r.oProdList.getBinding("items").filter([])}}else if(t.includes("od")){r._oCore.byId(this._valueHelpDialogOD.getId()+"-searchField").setValue("");if(r.oODList.getBinding("items")){r.oODList.getBinding("items").filter([])}}else{r._oCore.byId(this._valueHelpDialogPPF.getId()+"-searchField").setValue("");if(r.oPPFList.getBinding("items")){r.oPPFList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),l=[];t=t?t.trim():"";if(o.includes("loc")){if(t!==""){l.push(new s({filters:[new s("LOCATION_ID",i.Contains,t),new s("LOCATION_DESC",i.Contains,t)],and:false}))}r.oLocList.getBinding("items").filter(l)}else if(o.includes("prod")){if(t!==""){l.push(new s({filters:[new s("PRODUCT_ID",i.Contains,t),new s("PROD_DESC",i.Contains,t)],and:false}))}r.oProdList.getBinding("items").filter(l)}else if(o.includes("od")){if(t!==""){l.push(new s({filters:[new s("LOCATION_ID",i.Contains,t),new s("PRODUCT_ID",i.Contains,t),new s("COMPONENT",i.Contains,t),new s("OBJ_DEP",i.Contains,t)],and:false}))}r.oODList.getBinding("items").filter(l)}else{if(t!==""){l.push(new s({filters:[new s("PROFILE",i.Contains,t),new s("METHOD",i.Contains,t),new s("PRF_DESC",i.Contains,t)],and:false}))}r.oPPFList.getBinding("items").filter(l)}},handleSelection:function(e){var t=e.getParameter("id"),o=e.getParameter("selectedItems"),s;if(t.includes("Loc")){s=e.getParameter("selectedItems");r.oLoc.setValue(s[0].getTitle());r.oProd.removeAllTokens();r.oObjDep.removeAllTokens();this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].removeSelections();this._valueHelpDialogOD.getAggregation("_dialog").getContent()[1].removeSelections();this.getModel("BModel").read("/getLocProd?$filter=contains(LOCATION_ID,aSelectedItems[0].getTitle())",{success:function(e){e.results.unshift({PRODUCT_ID:"All"});r.prodModel.setData(e);r.oProdList.setModel(r.prodModel)},error:function(e,t){l.show("error")}})}else if(t.includes("prod")){r.oProdList.getBinding("items").filter([]);r.oObjDep.removeAllTokens();this._valueHelpDialogOD.getAggregation("_dialog").getContent()[1].removeSelections();s=e.getParameter("selectedItems");if(s&&s.length>0){r.oProd.removeAllTokens();s.forEach(function(e){r.oProd.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}else{r.oProd.removeAllTokens()}}else if(t.includes("od")){r.oODList.getBinding("items").filter([]);s=e.getParameter("selectedItems");if(s&&s.length>0){if(s[0].getTitle()==="All_"){r.byId("idCheck").setSelected(true)}else{r.byId("idCheck").setSelected(false)}r.oObjDep.removeAllTokens();s.forEach(function(e){r.oObjDep.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}else{r.oObjDep.removeAllTokens();r.byId("idCheck").setSelected(false)}}else{r.oPPFList.getBinding("items").filter([]);s=e.getParameter("selectedItems");r.oPredProfile.removeAllTokens();if(s&&s.length>0){s.forEach(function(e){r.oPredProfile.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}}r.handleClose(e)},handleTokenUpdate:function(e){var t=e.getSource().getId(),o=e.getParameter("removedTokens"),s,i,l;if(o){s=o[0].getProperty("key")}else{s=e.getParameter("item").getName()}if(t.includes("prod")){i=r.oProdList.getSelectedItems();for(l=0;l<i.length;l++){if(i[l].getTitle()===s){i[l].setSelected(false)}}}else if(t.includes("od")){i=r.oProdList.getSelectedItems();for(l=0;l<i.length;l++){if(i[l].getTitle()===s){i[l].setSelected(false)}}}else if(t.includes("pmInput")){i=r.oProdList.getSelectedItems();for(l=0;l<i.length;l++){if(i[l].getTitle()===s){i[l].setSelected(false)}}}},getToken:function(){var e;$.ajax({url:"/v2/pal",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,s){e=s.getResponseHeader("X-CSRF-Token")}});return e},resetInputs:function(){this.oLoc.setValue("");this.oObjDep.destroyTokens();this.oLocList.removeSelections();this.oODList.removeSelections();this.oPredProfile.destroyTokens();this.oPPFList.removeSelections();this.oProd.destroyTokens();this.oProdList.removeSelections()},handleProdChange:function(e){var t=e.getParameter("listItem").getTitle();var o=sap.ui.getCore().byId("prodSlctList").getItems();var s=this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].getSelectedItems();if(t==="All"&&e.getParameter("selected")&&o.length!==1){this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].selectAll()}else if(t==="All"&&!e.getParameter("selected")){this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].removeSelections()}else if(t==="All"&&o.length===1){sap.ui.getCore().byId("prodSlctList").getItems()[0].setSelected(false)}},handleObjDepChange:function(e){var t=e.getParameter("listItem").getTitle();var o=sap.ui.getCore().byId("odSlctList").getItems();var s=this._valueHelpDialogOD.getAggregation("_dialog").getContent()[1].getSelectedItems();if(t==="All_"&&e.getParameter("selected")&&o.length!==1){this._valueHelpDialogOD.getAggregation("_dialog").getContent()[1].selectAll()}else if(t==="All_"&&!e.getParameter("selected")){this._valueHelpDialogOD.getAggregation("_dialog").getContent()[1].removeSelections()}else if(t==="All"&&o.length===1){sap.ui.getCore().byId("odSlctList").getItems()[0].setSelected(false)}}})});