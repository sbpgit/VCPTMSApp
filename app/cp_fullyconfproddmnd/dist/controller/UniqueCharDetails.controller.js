sap.ui.define(["sap/ui/core/mvc/Controller","cpapp/cpfullyconfproddmnd/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,a,r,i,l,s,n,o){"use strict";var d=n.EdmType;var u,C;return t.extend("cpapp.cpfullyconfproddmnd.controller.UniqueCharDetails",{onInit:function(){C=this;var e;l.show("Unique Characteristics Details");u=C.getOwnerComponent().getModel("oGModel");C.allCharsModel=new a;C.allCharsModel.setSizeLimit(2e3);C.locProdCharModel=new a;C.locProdCharModel.setSizeLimit(2e3);C.oUniqueCharTable=C.getView().byId("idUniqueIdChars");e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("RouteUniqChar").attachMatched(this._onRouteMatched,this)},onUniqueIdLinkPress:function(e){sap.ui.core.BusyIndicator.show();u=C.getOwnerComponent().getModel("oGModel");C.getModel("CIRModel").callFunction("/getUniqueChars",{method:"GET",urlParameters:{UNIQUE_ID:u.getProperty("/SelectedUniqueId"),PRODUCT_ID:u.getProperty("/SelectedProd"),LOCATION_ID:u.getProperty("/SelectedLoc")},success:function(e){sap.ui.core.BusyIndicator.hide();C.formatUniqueCharsData(e.results)},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error While fetching data")}})},formatUniqueCharsData:function(e){var t=e;var a={},r={},i=[],l=[];var s=[];var n=[];var o=0,d=0;var u;var h=true;var U,c,g;C.oUniqueCharTable=C.getView().byId("idUniqueIdChars");if(t.length>0){for(var I=0;I<t.length;I++){a={};if(I===0){s=t[I].CONFIG;a.UNIQUE_CHAR="Characteristic";a.TOTAL=t[I].TOTAL;i.push(a);a={}}a.UNIQUE_CHAR=t[I].UNIQUE_ID;a.TOTAL=t[I].TOTAL;i.push(a)}for(var f=0;f<s.length;f++){r={};r["Characteristic"]=[{CHAR_NAME:s[f].CHAR_NAME,CHAR_DESC:s[f].CHAR_DESC}];for(var v=1;v<i.length;v++){n=[];n=t.filter(function(e){return e.UNIQUE_ID===i[v].UNIQUE_CHAR});n=n[0].CONFIG;for(var p=0;p<n.length;p++){if(s[f].CHAR_NAME===n[p].CHAR_NAME&&s[f].CHAR_DESC===n[p].CHAR_DESC&&s[f].CHAR_NUM===n[p].CHAR_NUM){r[i[v].UNIQUE_CHAR]=[{CHAR_VALUE:n[p].CHAR_VALUE,CHARVAL_DESC:n[p].CHARVAL_DESC,CHAR_NUM:n[p].CHAR_NUM,CHARVAL_NUM:n[p].CHARVAL_NUM}];break}}}l.push(r);r={}}var b=new sap.ui.model.json.JSONModel;b.setData({rows:l,columns:i});C.oUniqueCharTable.setModel(b);C.oUniqueCharTable.bindColumns("/columns",function(e,t){d=0;o=o+1;u=t.getObject().UNIQUE_CHAR;d=t.getObject().TOTAL;U=u.toString()+" ("+d+")";if(u==="Characteristic"){c=u+"/0/CHAR_NAME";g=u+"/0/CHAR_DESC";return new sap.ui.table.Column({label:U,template:new sap.m.ObjectIdentifier({title:"{"+g+"}",text:"{"+c+"}"})})}else{if(o>7){h=false}c=u+"/0/CHAR_VALUE";g=u+"/0/CHARVAL_DESC";return new sap.ui.table.Column({label:U,visible:h,template:new sap.m.ObjectIdentifier({title:"{"+g+"}",text:"{"+c+"}"})})}});C.oUniqueCharTable.bindRows("/rows")}},onFilterSelectionChange:function(e){var t;var a=[];var r;t=e.getParameter("selectedItem").getKey();r=C.getView().byId("idUniqueCharDetailsU");a=r.getSelectedItems();switch(t){case"NE":C.getUniqueIdsNESelChars(a);break;case"EQ":C.getUniqueIdsEQSelChars(a);break;default:break}},onCharacteristicSelFinish:function(e){var t=[];var a=[];var r=[];var i="";var l="";var s="";var n=0;var o=[];var d=[];var u=[];var h="";C.oUniqueCharTable=C.getView().byId("idUniqueIdChars");u=C.oUniqueCharTable.getColumns();t=C.allCharsModel.getData().charDetails;r=e.getParameter("selectedItems");if(r.length>0){h=C.getView().byId("_IDGenUSelect").getSelectedKey();switch(h){case"NE":C.getUniqueIdsNESelChars(r);break;case"EQ":C.getUniqueIdsEQSelChars(r);break;default:break}}else{for(var U=0;U<u.length;U++){if(U<7){if(!u[U].getProperty("visible")){u[U].setVisible(true)}}else{u[U].setVisible(false)}}}},getUniqueIdsNESelChars:function(e){var t=[];var a=[];var r="";var i="";var l="";var s=0;var n=[];var o=[];var d=[];var u="";var h="";var U=0;C.oUniqueCharTable=C.getView().byId("idUniqueIdChars");d=C.oUniqueCharTable.getColumns();t=C.allCharsModel.getData().charDetails;var c=t;for(var g=0;g<e.length;g++){i=e[g].getKey().split(":")[0];r=e[g].getKey().split(":")[1];if(n.length>0){const e=n.map(e=>e.UNIQUE_ID);c=t.filter(t=>e.indexOf(t.UNIQUE_ID)!==-1)}n=[];for(var I=0;I<c.length;I++){if(c[I].CHAR_NUM===i&&c[I].CHARVAL_NUM!==r){l=c[I].UNIQUE_ID;if(n.includes(l)===false){n.push({UNIQUE_ID:l})}}}}if(n.length>0){for(var f=2;f<d.length;f++){h=d[f].getLabel().getText().split(" (")[0];a=n.filter(function(e){return e.UNIQUE_ID===parseInt(h)});if(a.length>0){U=U+1;if(U>=5){d[f].setVisible(false)}else{d[f].setVisible(true)}}else{d[f].setVisible(false)}}}},getUniqueIdsEQSelChars:function(e){var t=[];var a=[];var r="";var i="";var l="";var s=0;var n=[];var o=[];var d=[];var u="";var h=0;var U="";C.oUniqueCharTable=C.getView().byId("idUniqueIdChars");d=C.oUniqueCharTable.getColumns();t=C.allCharsModel.getData().charDetails;var c=t;for(var g=0;g<e.length;g++){i=e[g].getKey().split(":")[0];r=e[g].getKey().split(":")[1];if(n.length>0){const e=n.map(e=>e.UNIQUE_ID);c=t.filter(t=>e.indexOf(t.UNIQUE_ID)!==-1)}n=[];for(var I=0;I<c.length;I++){if(c[I].CHAR_NUM===i&&c[I].CHARVAL_NUM===r){l=c[I].UNIQUE_ID;if(n.includes(l)===false){n.push({UNIQUE_ID:l})}}}}if(n.length>0){for(var f=2;f<d.length;f++){U=d[f].getLabel().getText().split(" (")[0];a=n.filter(function(e){return e.UNIQUE_ID===parseInt(U)});if(a.length>0){h=h+1;if(h>=5){d[f].setVisible(false)}else{d[f].setVisible(true)}}else{d[f].setVisible(false)}}}},onUniqueIdsFilter:function(){var e=C.oUniqueCharTable.getColumns();var t=C.oUniqueCharTable.getBinding().aIndices;var a=C.oUniqueCharTable.getBinding().oList;var r=[];var i=" ";var l=0;var s="";r=a.filter((e,a)=>t.some(e=>a===e));for(var n=2;n<e.length;n++){i=e[n].getLabel().getText().split(" ");l=0;for(var o=0;o<r.length;o++){l=l+r[o][i[0]]}s=i[0]+" ("+l+")";e[n].setLabel(s)}},_onRouteMatched:function(e){u=C.getOwnerComponent().getModel("oGModel");C.LocationId=u.getProperty("/SelectedLoc");C.ProductId=u.getProperty("/SelectedProd");C.UniqueId=u.getProperty("/SelectedUniqueId");C.aFilteredChars=u.getProperty("/aFilteredChar");C.aAllUniqueChars=u.getProperty("/AllUniqueChars");C.getView().byId("idlocU").setValue(C.LocationId);C.getView().byId("idprodListU").setValue(C.ProductId);C.getView().byId("idUniqueId").setValue(C.UniqueId);C.allCharsModel.setData({charDetails:C.aAllUniqueChars});C.locProdCharModel.setData({charDetails:C.aFilteredChars});C.getView().byId("idUniqueCharDetailsU").setModel(C.locProdCharModel);C.onUniqueIdLinkPress()}})});