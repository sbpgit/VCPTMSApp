sap.ui.define(["cpappf/cpgeneratetimeseries/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,i,s,l,d,r){"use strict";var n,a;return e.extend("cpappf.cpgeneratetimeseries.controller.Home",{onInit:function(){n=this;n.locModel=new i;n.prodModel=new i;n.verModel=new i;n.scenModel=new i;n.locModel.setSizeLimit(1e3);n.prodModel.setSizeLimit(1e3);n.verModel.setSizeLimit(1e3);n.scenModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogVer){this._valueHelpDialogVer=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.VersionDialog",this);this.getView().addDependent(this._valueHelpDialogVer)}if(!this._valueHelpDialogScen){this._valueHelpDialogScen=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.ScenarioDialog",this);this.getView().addDependent(this._valueHelpDialogScen)}this.getRouter().getRoute("Home").attachPatternMatched(this._onPatternMatched.bind(this))},_onPatternMatched:function(){n=this;this.oLoc=this.byId("locInput");this.oProd=this.byId("prodInput");n._valueHelpDialogProd.setTitleAlignment("Center");n._valueHelpDialogLoc.setTitleAlignment("Center");n._valueHelpDialogVer.setTitleAlignment("Center");n._valueHelpDialogScen.setTitleAlignment("Center");this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oVerList=this._oCore.byId(this._valueHelpDialogVer.getId()+"-list");this.oScenList=this._oCore.byId(this._valueHelpDialogScen.getId()+"-list");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){n.locModel.setData(e);n.oLocList.setModel(n.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("error")}})},handleValueHelp:function(e){n.oGModel=n.getModel("oGModel");var o=e.getParameter("id");if(o.includes("loc")){n.oGModel.setProperty("/LocInput","TL");n._valueHelpDialogLoc.open()}else if(o.includes("Prod")){if(n.byId("idloc").getValue()){n.oGModel.setProperty("/ProdInput","TP");n._valueHelpDialogProd.open()}else{t.show("Select Location")}}else if(o.includes("loComp")){n.oGModel.setProperty("/LocInput","CL");n._valueHelpDialogLoc.open()}else if(o.includes("ProComp")){if(n.byId("idloComp").getValue()){n.oGModel.setProperty("/ProdInput","CP");n._valueHelpDialogProd.open()}else{t.show("Select Location")}}else if(o.includes("ver")){if(n.byId("idloComp").getValue()&&n.byId("idProComp").getValue()){n._valueHelpDialogVer.open()}else{t.show("Select Location and Product")}}else if(o.includes("scen")){if(n.byId("idloComp").getValue()&&n.byId("idProComp").getValue()){n._valueHelpDialogScen.open()}else{t.show("Select Location and Product")}}if(o.includes("Prod")||o.includes("ProComp")){var i;if(o.includes("Prod")){i=n.byId("idloc").getValue()}else if(o.includes("ProComp")){i=n.byId("idloComp").getValue()}if(i){sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocProdDet",{filters:[new s("LOCATION_ID",l.EQ,i)],success:function(e){n.prodModel.setData(e);n.oProdList.setModel(n.prodModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){sap.ui.core.BusyIndicator.hide();t.show("Failed to get product data")}})}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){n._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(n.oLocList.getBinding("items")){n.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){n._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(n.oProdList.getBinding("items")){n.oProdList.getBinding("items").filter([])}}else if(t.includes("Ver")){n._oCore.byId(this._valueHelpDialogVer.getId()+"-searchField").setValue("");if(n.oVerList.getBinding("items")){n.oVerList.getBinding("items").filter([])}}else if(t.includes("scen")){n._oCore.byId(this._valueHelpDialogScen.getId()+"-searchField").setValue("");if(n.oScenList.getBinding("items")){n.oScenList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),i=[];t=t?t.trim():"";if(o.includes("Loc")){if(t!==""){i.push(new s({filters:[new s("LOCATION_ID",l.Contains,t),new s("LOCATION_DESC",l.Contains,t)],and:false}))}n.oLocList.getBinding("items").filter(i)}else if(o.includes("prod")){if(t!==""){i.push(new s({filters:[new s("PRODUCT_ID",l.Contains,t),new s("PROD_DESC",l.Contains,t)],and:false}))}n.oProdList.getBinding("items").filter(i)}else if(o.includes("ver")){if(t!==""){i.push(new s({filters:[new s("VERSION",l.Contains,t)],and:false}))}n.oVerList.getBinding("items").filter(i)}else if(o.includes("scen")){if(t!==""){i.push(new s({filters:[new s("SCENARIO",l.Contains,t)],and:false}))}n.oScenList.getBinding("items").filter(i)}},handleSelection:function(e){n.oGModel=n.getModel("oGModel");var o=e.getParameter("id"),i=e.getParameter("selectedItems"),d,r=[];if(o.includes("Loc")){var a=n.oGModel.getProperty("/LocInput");if(a==="TL"){this.oProd=n.byId("idProd");this.oLoc=n.byId("idloc");d=e.getParameter("selectedItems");n.oLoc.setValue(d[0].getTitle());n.oGModel.setProperty("/SelectedLoc",d[0].getTitle());n.oProd.setValue("");n.byId("idTimeSeries").setEnabled(false);n.byId("idFTimeSeries").setEnabled(false);n.oGModel.setProperty("/SelectedProd","")}else if(a==="CL"){this.oProd=n.byId("idProComp");this.oLoc=n.byId("idloComp");n.oVer=n.byId("idver");n.oScen=n.byId("idscen");d=e.getParameter("selectedItems");n.oLoc.setValue(d[0].getTitle());n.oProd.setValue("");n.oVer.setValue("");n.oScen.setValue("");n.byId("buttonCompReq").setEnabled(false)}}else if(o.includes("prod")){var c=n.oGModel.getProperty("/ProdInput");if(c==="TP"){this.oProd=n.byId("idProd");d=e.getParameter("selectedItems");n.oProd.setValue(d[0].getTitle());n.oGModel.setProperty("/SelectedProd",d[0].getTitle());if(n.oGModel.getProperty("/SelectedLoc")!==""&&n.oGModel.getProperty("/SelectedProd")!==""){n.byId("idTimeSeries").setEnabled(true);n.byId("idFTimeSeries").setEnabled(true)}else{n.byId("idTimeSeries").setEnabled(false);n.byId("idFTimeSeries").setEnabled(false)}}else if(c==="CP"){this.oLoc=n.byId("idloComp");this.oProd=n.byId("idProComp");n.oVer=n.byId("idver");n.oScen=n.byId("idscen");d=e.getParameter("selectedItems");n.oProd.setValue(d[0].getTitle());n.byId("buttonCompReq").setEnabled(false);n.oVer.setValue("");n.oScen.setValue("");this.getModel("BModel").read("/getIbpVerScn",{filters:[new s("LOCATION_ID",l.EQ,n.byId("idloComp").getValue()),new s("PRODUCT_ID",l.EQ,n.byId("idProComp").getValue())],success:function(e){n.verModel.setData(e);n.oVerList.setModel(n.verModel)},error:function(e,o){t.show("error")}})}}else if(o.includes("Ver")){this.oVer=n.byId("idver");n.oScen=n.byId("idscen");d=e.getParameter("selectedItems");n.oVer.setValue(d[0].getTitle());n.oScen.setValue("");n.byId("buttonCompReq").setEnabled(false);this.getModel("BModel").read("/getIbpVerScn",{filters:[new s("LOCATION_ID",l.EQ,n.byId("idloComp").getValue()),new s("PRODUCT_ID",l.EQ,n.byId("idProComp").getValue()),new s("VERSION",l.EQ,d[0].getTitle())],success:function(e){n.scenModel.setData(e);n.oScenList.setModel(n.scenModel)},error:function(e,o){t.show("error")}})}else if(o.includes("scen")){this.oScen=n.byId("idscen");d=e.getParameter("selectedItems");n.oScen.setValue(d[0].getTitle());n.byId("buttonCompReq").setEnabled(true)}},onTimeS:function(){var e=n.oGModel.getProperty("/SelectedLoc"),o=n.oGModel.getProperty("/SelectedProd");sap.ui.core.BusyIndicator.show();this.getModel("BModel").callFunction("/generate_timeseries",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o},success:function(e){t.show("Timeseries generated successfully");sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("Failed to generate Timeseries");sap.ui.core.BusyIndicator.hide()}})},onTimeF:function(){var e=n.oGModel.getProperty("/SelectedLoc"),o=n.oGModel.getProperty("/SelectedProd");sap.ui.core.BusyIndicator.show();this.getModel("BModel").callFunction("/generate_timeseriesF",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o},success:function(e){t.show("Future Timeseries generated successfully");sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("Failed to generate future Timeseries");sap.ui.core.BusyIndicator.hide()}})},onCompReq:function(){var e=n.byId("idloComp").getValue(),o=n.byId("idProComp").getValue(),i=n.byId("idver").getValue(),s=n.byId("idscen").getValue();t.show("Generated components requirements");this.getModel("BModel").callFunction("/getCompreqQty",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o,VERSION:i,SCENARIO:s},success:function(e){t.show("Generated components requirements")},error:function(e,o){t.show("Failed to generate Components Requirments")}})}})});