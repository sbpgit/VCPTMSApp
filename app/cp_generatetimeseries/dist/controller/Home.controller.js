sap.ui.define(["cpappf/cpgeneratetimeseries/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,i,s,l,d,r){"use strict";var a,n;return e.extend("cpappf.cpgeneratetimeseries.controller.Home",{onInit:function(){a=this;a.locModel=new i;a.prodModel=new i;a.verModel=new i;a.scenModel=new i;a.locModel.setSizeLimit(1e3);a.prodModel.setSizeLimit(1e3);a.verModel.setSizeLimit(1e3);a.scenModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogVer){this._valueHelpDialogVer=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.VersionDialog",this);this.getView().addDependent(this._valueHelpDialogVer)}if(!this._valueHelpDialogScen){this._valueHelpDialogScen=sap.ui.xmlfragment("cpappf.cpgeneratetimeseries.view.ScenarioDialog",this);this.getView().addDependent(this._valueHelpDialogScen)}this.getRouter().getRoute("Home").attachPatternMatched(this._onPatternMatched.bind(this))},_onPatternMatched:function(){a=this;this.oLoc=this.byId("locInput");this.oProd=this.byId("prodInput");this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oVerList=this._oCore.byId(this._valueHelpDialogVer.getId()+"-list");this.oScenList=this._oCore.byId(this._valueHelpDialogScen.getId()+"-list");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){a.locModel.setData(e);a.oLocList.setModel(a.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("error")}})},handleValueHelp:function(e){a.oGModel=a.getModel("oGModel");var o=e.getParameter("id");if(o.includes("loc")){a.oGModel.setProperty("/LocInput","TL");a._valueHelpDialogLoc.open()}else if(o.includes("Prod")){if(a.byId("idloc").getValue()){a.oGModel.setProperty("/ProdInput","TP");a._valueHelpDialogProd.open()}else{t.show("Select Location")}}else if(o.includes("loComp")){a.oGModel.setProperty("/LocInput","CL");a._valueHelpDialogLoc.open()}else if(o.includes("ProComp")){if(a.byId("idloComp").getValue()){a.oGModel.setProperty("/ProdInput","CP");a._valueHelpDialogProd.open()}else{t.show("Select Location")}}else if(o.includes("ver")){if(a.byId("idloComp").getValue()&&a.byId("idProComp").getValue()){a._valueHelpDialogVer.open()}else{t.show("Select Location and Product")}}else if(o.includes("scen")){if(a.byId("idloComp").getValue()&&a.byId("idProComp").getValue()){a._valueHelpDialogScen.open()}else{t.show("Select Location and Product")}}if(o.includes("Prod")||o.includes("ProComp")){var i;if(o.includes("Prod")){i=a.byId("idloc").getValue()}else if(o.includes("ProComp")){i=a.byId("idloComp").getValue()}if(i){sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocProdDet",{filters:[new s("LOCATION_ID",l.EQ,i)],success:function(e){a.prodModel.setData(e);a.oProdList.setModel(a.prodModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){sap.ui.core.BusyIndicator.hide();t.show("Failed to get product data")}})}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){a._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(a.oLocList.getBinding("items")){a.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){a._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(a.oProdList.getBinding("items")){a.oProdList.getBinding("items").filter([])}}else if(t.includes("Ver")){a._oCore.byId(this._valueHelpDialogVer.getId()+"-searchField").setValue("");if(a.oVerList.getBinding("items")){a.oVerList.getBinding("items").filter([])}}else if(t.includes("scen")){a._oCore.byId(this._valueHelpDialogScen.getId()+"-searchField").setValue("");if(a.oScenList.getBinding("items")){a.oScenList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),i=[];t=t?t.trim():"";if(o.includes("Loc")){if(t!==""){i.push(new s({filters:[new s("LOCATION_ID",l.Contains,t),new s("LOCATION_DESC",l.Contains,t)],and:false}))}a.oLocList.getBinding("items").filter(i)}else if(o.includes("prod")){if(t!==""){i.push(new s({filters:[new s("PRODUCT_ID",l.Contains,t),new s("PROD_DESC",l.Contains,t)],and:false}))}a.oProdList.getBinding("items").filter(i)}else if(o.includes("ver")){if(t!==""){i.push(new s({filters:[new s("VERSION",l.Contains,t)],and:false}))}a.oVerList.getBinding("items").filter(i)}else if(o.includes("scen")){if(t!==""){i.push(new s({filters:[new s("SCENARIO",l.Contains,t)],and:false}))}a.oScenList.getBinding("items").filter(i)}},handleSelection:function(e){a.oGModel=a.getModel("oGModel");var o=e.getParameter("id"),i=e.getParameter("selectedItems"),d,r=[];if(o.includes("Loc")){var n=a.oGModel.getProperty("/LocInput");if(n==="TL"){this.oProd=a.byId("idProd");this.oLoc=a.byId("idloc");d=e.getParameter("selectedItems");a.oLoc.setValue(d[0].getTitle());a.oGModel.setProperty("/SelectedLoc",d[0].getTitle());a.oProd.setValue("");a.byId("idTimeSeries").setEnabled(false);a.byId("idFTimeSeries").setEnabled(false);a.oGModel.setProperty("/SelectedProd","")}else if(n==="CL"){this.oProd=a.byId("idProComp");this.oLoc=a.byId("idloComp");a.oVer=a.byId("idver");a.oScen=a.byId("idscen");d=e.getParameter("selectedItems");a.oLoc.setValue(d[0].getTitle());a.oProd.setValue("");a.oVer.setValue("");a.oScen.setValue("");a.byId("buttonCompReq").setEnabled(false)}}else if(o.includes("prod")){var c=a.oGModel.getProperty("/ProdInput");if(c==="TP"){this.oProd=a.byId("idProd");d=e.getParameter("selectedItems");a.oProd.setValue(d[0].getTitle());a.oGModel.setProperty("/SelectedProd",d[0].getTitle());if(a.oGModel.getProperty("/SelectedLoc")!==""&&a.oGModel.getProperty("/SelectedProd")!==""){a.byId("idTimeSeries").setEnabled(true);a.byId("idFTimeSeries").setEnabled(true)}else{a.byId("idTimeSeries").setEnabled(false);a.byId("idFTimeSeries").setEnabled(false)}}else if(c==="CP"){this.oLoc=a.byId("idloComp");this.oProd=a.byId("idProComp");a.oVer=a.byId("idver");a.oScen=a.byId("idscen");d=e.getParameter("selectedItems");a.oProd.setValue(d[0].getTitle());a.byId("buttonCompReq").setEnabled(false);a.oVer.setValue("");a.oScen.setValue("");this.getModel("BModel").read("/getIbpVerScn",{filters:[new s("LOCATION_ID",l.EQ,a.byId("idloComp").getValue()),new s("PRODUCT_ID",l.EQ,a.byId("idProComp").getValue())],success:function(e){a.verModel.setData(e);a.oVerList.setModel(a.verModel);a.scenModel.setData(e);a.oScenList.setModel(a.scenModel)},error:function(e,o){t.show("error")}})}}else if(o.includes("Ver")){this.oVer=a.byId("idver");d=e.getParameter("selectedItems");a.oVer.setValue(d[0].getTitle());a.byId("buttonCompReq").setEnabled(false)}else if(o.includes("scen")){this.oScen=a.byId("idscen");d=e.getParameter("selectedItems");a.oScen.setValue(d[0].getTitle());a.byId("buttonCompReq").setEnabled(true)}},onTimeS:function(){var e=a.oGModel.getProperty("/SelectedLoc"),o=a.oGModel.getProperty("/SelectedProd");this.getModel("BModel").callFunction("/generate_timeseries",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o},success:function(e){t.show("Timeseries generated successfully")},error:function(e,o){t.show("Failed to generate Timeseries")}})},onTimeF:function(){var e=a.oGModel.getProperty("/SelectedLoc"),o=a.oGModel.getProperty("/SelectedProd");this.getModel("BModel").callFunction("/generate_timeseriesF",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o},success:function(e){t.show("Future Timeseries generated successfully")},error:function(e,o){t.show("Failed to generate future Timeseries")}})},onCompReq:function(){var e=a.byId("idloComp").getValue(),o=a.byId("idProComp").getValue(),i=a.byId("idver").getValue(),s=a.byId("idscen").getValue();this.getModel("BModel").callFunction("/getCompreqQty",{method:"GET",urlParameters:{LOCATION_ID:e,PRODUCT_ID:o,VERSION:i,SCENARIO:s},success:function(e){t.show("Generated components requirements")},error:function(e,o){t.show("Failed to generate Components Requirments")}})}})});