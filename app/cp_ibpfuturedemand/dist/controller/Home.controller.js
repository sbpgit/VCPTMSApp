sap.ui.define(["sap/ui/core/mvc/Controller","cp/appf/cpibpfuturedemand/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,o,i,l,a,s){"use strict";var r,d;return t.extend("cp.appf.cpibpfuturedemand.controller.Home",{onInit:function(){d=this;d.TableModel=new o;d.locModel=new o;d.prodModel=new o;d.verModel=new o;d.scenModel=new o;d.TableModel.setSizeLimit(1e3);d.locModel.setSizeLimit(1e3);d.prodModel.setSizeLimit(1e3);d.verModel.setSizeLimit(1e3);d.scenModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogVer){this._valueHelpDialogVer=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.VersionDialog",this);this.getView().addDependent(this._valueHelpDialogVer)}if(!this._valueHelpDialogScen){this._valueHelpDialogScen=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.ScenarioDialog",this);this.getView().addDependent(this._valueHelpDialogScen)}},onAfterRendering:function(){d.oList=this.byId("idTab");this.oLoc=this.byId("idloc");this.oProd=this.byId("idprod");this.oVer=this.byId("idver");this.oScen=this.byId("idscen");d._valueHelpDialogProd.setTitleAlignment("Center");d._valueHelpDialogLoc.setTitleAlignment("Center");d._valueHelpDialogVer.setTitleAlignment("Center");d._valueHelpDialogScen.setTitleAlignment("Center");d.byId("headSearch").setValue("");d.byId("IBPfdemList").removeSelections();if(d.byId("IBPfdemList").getItems().length){d.onSearch()}this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oVerList=this._oCore.byId(this._valueHelpDialogVer.getId()+"-list");this.oScenList=this._oCore.byId(this._valueHelpDialogScen.getId()+"-list");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){d.locModel.setData(e);d.oLocList.setModel(d.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,t){a.show("error")}})},onResetDate:function(){d.oLoc.setValue("");d.oProd.setValue("");d.oVer.setValue("");d.oScen.setValue("");d.onAfterRendering()},onGetData:function(e){var t=d.byId("idloc").getValue(),o=d.byId("idprod").getValue(),i=d.byId("idver").getValue(),l=d.byId("idscen").getValue();d.oGModel=d.getModel("oGModel");var a=[];if(t!==""&&o!==""){var s=new sap.ui.model.Filter({path:"LOCATION_ID",operator:sap.ui.model.FilterOperator.EQ,value1:t});a.push(s);var s=new sap.ui.model.Filter({path:"PRODUCT_ID",operator:sap.ui.model.FilterOperator.EQ,value1:o});a.push(s);if(i){var s=new sap.ui.model.Filter({path:"VERSION",operator:sap.ui.model.FilterOperator.EQ,value1:i});a.push(s)}if(l){var s=new sap.ui.model.Filter({path:"SCENARIO",operator:sap.ui.model.FilterOperator.EQ,value1:l});a.push(s)}sap.ui.core.BusyIndicator.show();d.getModel("BModel").read("/getIBPFdem",{filters:a,success:function(e){sap.ui.core.BusyIndicator.hide();e.results.forEach(function(e){e.WEEK_DATE=d.getInMMddyyyyFormat(e.WEEK_DATE)},d);d.oGModel.setProperty("/tableData",e.results);d.onNonZero()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error While fetching data")}})}else{sap.m.MessageToast.show("Please select a Location/Product")}},getInMMddyyyyFormat:function(e){if(!e){e=new Date}var t=e.getMonth()+1;var o=e.getDate();if(t<10){t="0"+t}if(o<10){o="0"+o}return t+"/"+o+"/"+e.getFullYear()},onNonZero:function(e){d.oTable=d.byId("IBPfdemList");d.oGModel=d.getModel("oGModel");var t=d.byId("idCheck1").getSelected(),o,i;d.aData=d.oGModel.getProperty("/tableData");d.FinalData=[];if(t){for(var l=0;l<d.aData.length;l++){if(d.aData[l].QUANTITY!=="0"){d.FinalData.push(d.aData[l])}}}else{d.FinalData=d.aData}d.TableModel.setData({results:d.FinalData});d.byId("IBPfdemList").setModel(d.TableModel)},handleValueHelp:function(e){var t=e.getParameter("id");if(t.includes("loc")){d._valueHelpDialogLoc.open()}else if(t.includes("prod")){if(d.byId("idloc").getValue()){d._valueHelpDialogProd.open()}else{a.show("Select Location")}}else if(t.includes("ver")){if(d.byId("idloc").getValue()&&d.byId("idprod").getValue()){d._valueHelpDialogVer.open()}else{a.show("Select Location and Product")}}else if(t.includes("scen")){if(d.byId("idloc").getValue()&&d.byId("idprod").getValue()){d._valueHelpDialogScen.open()}else{a.show("Select Location and Product")}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("Loc")){d._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(d.oLocList.getBinding("items")){d.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){d._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(d.oProdList.getBinding("items")){d.oProdList.getBinding("items").filter([])}}else if(t.includes("Ver")){d._oCore.byId(this._valueHelpDialogVer.getId()+"-searchField").setValue("");if(d.oVerList.getBinding("items")){d.oVerList.getBinding("items").filter([])}}else if(t.includes("scen")){d._oCore.byId(this._valueHelpDialogScen.getId()+"-searchField").setValue("");if(d.oScenList.getBinding("items")){d.oScenList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),a=[];t=t?t.trim():"";if(o.includes("Loc")){if(t!==""){a.push(new i({filters:[new i("LOCATION_ID",l.Contains,t),new i("LOCATION_DESC",l.Contains,t)],and:false}))}d.oLocList.getBinding("items").filter(a)}else if(o.includes("prod")){if(t!==""){a.push(new i({filters:[new i("PRODUCT_ID",l.Contains,t),new i("PROD_DESC",l.Contains,t)],and:false}))}d.oProdList.getBinding("items").filter(a)}else if(o.includes("Ver")){if(t!==""){a.push(new i({filters:[new i("VERSION",l.Contains,t)],and:false}))}d.oVerList.getBinding("items").filter(a)}else if(o.includes("scen")){if(t!==""){a.push(new i({filters:[new i("SCENARIO",l.Contains,t)],and:false}))}d.oScenList.getBinding("items").filter(a)}},handleSelection:function(e){d.oGModel=d.getModel("oGModel");var t=e.getParameter("id"),o=e.getParameter("selectedItems"),s,r=[];if(t.includes("Loc")){d.oLoc=d.byId("idloc");d.oProd=d.byId("idprod");s=e.getParameter("selectedItems");d.oLoc.setValue(s[0].getTitle());d.oGModel.setProperty("/SelectedLoc",s[0].getTitle());d.oProd.setValue("");d.oVer.setValue("");d.oScen.setValue("");d.oGModel.setProperty("/SelectedProd","");this.getModel("BModel").read("/getLocProdDet",{filters:[new i("LOCATION_ID",l.EQ,s[0].getTitle())],success:function(e){d.prodModel.setData(e);d.oProdList.setModel(d.prodModel)},error:function(e,t){a.show("error")}})}else if(t.includes("prod")){d.oProd=d.byId("idprod");s=e.getParameter("selectedItems");d.oProd.setValue(s[0].getTitle());d.oGModel.setProperty("/SelectedProd",s[0].getTitle());d.oVer.setValue("");d.oScen.setValue("");this.getModel("BModel").read("/getIbpVerScn",{filters:[new i("LOCATION_ID",l.EQ,d.oGModel.getProperty("/SelectedLoc")),new i("PRODUCT_ID",l.EQ,s[0].getTitle())],success:function(e){d.verModel.setData(e);d.oVerList.setModel(d.verModel)},error:function(e,t){a.show("error")}})}else if(t.includes("Ver")){this.oVer=d.byId("idver");s=e.getParameter("selectedItems");d.oVer.setValue(s[0].getTitle());d.oScen.setValue("");d.oGModel.setProperty("/SelectedVer",s[0].getTitle());this.getModel("BModel").read("/getIbpVerScn",{filters:[new i("LOCATION_ID",l.EQ,d.oGModel.getProperty("/SelectedLoc")),new i("PRODUCT_ID",l.EQ,d.oGModel.getProperty("/SelectedProd")),new i("VERSION",l.EQ,s[0].getTitle())],success:function(e){d.scenModel.setData(e);d.oScenList.setModel(d.scenModel)},error:function(e,t){a.show("error")}})}else if(t.includes("scen")){this.oScen=d.byId("idscen");s=e.getParameter("selectedItems");d.oScen.setValue(s[0].getTitle());d.oGModel.setProperty("/SelectedScen",s[0].getTitle())}d.handleClose(e)},onhandlePress:function(e){var t=this.byId("IBPfdemList").getSelectedItems();d.oGModel=d.getModel("oGModel");var o=t[0].getBindingContext().getProperty();d.oGModel.setProperty("/sLoc",o.LOCATION_ID);d.oGModel.setProperty("/sProd",o.PRODUCT_ID);d.oGModel.setProperty("/sVer",o.VERSION);d.oGModel.setProperty("/sScen",o.SCENARIO);var i=new Date(o.WEEK_DATE),l=i.getMonth()+1,a=i.getDate(),s;if(l<10){l="0"+l}if(i.getDate()<10){a="0"+i.getDate()}s=i.getFullYear()+"-"+l+"-"+a;d.oGModel.setProperty("/sWeek",s);var r=sap.ui.core.UIComponent.getRouterFor(d);r.navTo("Detail",{},true)},onSearch:function(e){if(e){var t=e.getParameter("value")||e.getParameter("newValue")}else{var t=d.byId("headSearch").getValue()}var o=[];t=t?t.trim():"";if(t!==""){o.push(new i({filters:[new i("WEEK_DATE",l.Contains,t),new i("QUANTITY",l.Contains,t),new i("VERSION",l.Contains,t),new i("SCENARIO",l.Contains,t)],and:false}))}d.byId("IBPfdemList").getBinding("items").filter(o)}})});