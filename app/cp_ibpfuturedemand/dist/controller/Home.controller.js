sap.ui.define(["sap/ui/core/mvc/Controller","cp/appf/cpibpfuturedemand/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,i,o,l,s,r){"use strict";var a,d;return t.extend("cp.appf.cpibpfuturedemand.controller.Home",{onInit:function(){d=this;d.TableModel=new i;d.locModel=new i;d.prodModel=new i;d.verModel=new i;d.scenModel=new i;d.TableModel.setSizeLimit(1e3);d.locModel.setSizeLimit(1e3);d.prodModel.setSizeLimit(1e3);d.verModel.setSizeLimit(1e3);d.scenModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogVer){this._valueHelpDialogVer=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.VersionDialog",this);this.getView().addDependent(this._valueHelpDialogVer)}if(!this._valueHelpDialogScen){this._valueHelpDialogScen=sap.ui.xmlfragment("cp.appf.cpibpfuturedemand.view.ScenarioDialog",this);this.getView().addDependent(this._valueHelpDialogScen)}},onAfterRendering:function(){d.oList=this.byId("idTab");this.oLoc=this.byId("idloc");this.oProd=this.byId("idprod");this.oVer=this.byId("idver");this.oScen=this.byId("idscen");d._valueHelpDialogProd.setTitleAlignment("Center");d._valueHelpDialogLoc.setTitleAlignment("Center");d._valueHelpDialogVer.setTitleAlignment("Center");d._valueHelpDialogScen.setTitleAlignment("Center");d.byId("headSearch").setValue("");d.byId("IBPfdemList").removeSelections();if(d.byId("IBPfdemList").getItems().length){d.onSearch()}this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oVerList=this._oCore.byId(this._valueHelpDialogVer.getId()+"-list");this.oScenList=this._oCore.byId(this._valueHelpDialogScen.getId()+"-list");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){d.locModel.setData(e);d.oLocList.setModel(d.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,t){s.show("error")}})},onResetDate:function(){d.oLoc.setValue("");d.oProd.setValue("");d.oVer.setValue("");d.oScen.setValue("");d.onAfterRendering()},onGetData:function(e){var t=d.byId("idloc").getValue(),i=d.byId("idprod").getValue(),o=d.byId("idver").getValue(),l=d.byId("idscen").getValue();var s=[];var r=new sap.ui.model.Filter({path:"LOCATION_ID",operator:sap.ui.model.FilterOperator.EQ,value1:t});s.push(r);var r=new sap.ui.model.Filter({path:"PRODUCT_ID",operator:sap.ui.model.FilterOperator.EQ,value1:i});s.push(r);if(o){var r=new sap.ui.model.Filter({path:"VERSION",operator:sap.ui.model.FilterOperator.EQ,value1:o});s.push(r)}if(l){var r=new sap.ui.model.Filter({path:"SCENARIO",operator:sap.ui.model.FilterOperator.EQ,value1:l});s.push(r)}if(t!==""&&i!==""){sap.ui.core.BusyIndicator.show();d.getModel("BModel").read("/getIBPFdem",{filters:s,success:function(e){e.results.forEach(function(e){e.WEEK_DATE=d.getInMMddyyyyFormat(e.WEEK_DATE)},d);sap.ui.core.BusyIndicator.hide();d.TableModel.setData({results:e.results});d.byId("IBPfdemList").setModel(d.TableModel)},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error While fetching data")}})}else{sap.m.MessageToast.show("Please select a Location/Product/Version/Scenario")}},getInMMddyyyyFormat:function(e){if(!e){e=new Date}var t=e.getMonth()+1;var i=e.getDate();if(t<10){t="0"+t}if(i<10){i="0"+i}return t+"/"+i+"/"+e.getFullYear()},handleValueHelp:function(e){var t=e.getParameter("id");if(t.includes("loc")){d._valueHelpDialogLoc.open()}else if(t.includes("prod")){if(d.byId("idloc").getValue()){d._valueHelpDialogProd.open()}else{s.show("Select Location")}}else if(t.includes("ver")){if(d.byId("idloc").getValue()&&d.byId("idprod").getValue()){d._valueHelpDialogVer.open()}else{s.show("Select Location and Product")}}else if(t.includes("scen")){if(d.byId("idloc").getValue()&&d.byId("idprod").getValue()){d._valueHelpDialogScen.open()}else{s.show("Select Location and Product")}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("Loc")){d._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(d.oLocList.getBinding("items")){d.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){d._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(d.oProdList.getBinding("items")){d.oProdList.getBinding("items").filter([])}}else if(t.includes("Ver")){d._oCore.byId(this._valueHelpDialogVer.getId()+"-searchField").setValue("");if(d.oVerList.getBinding("items")){d.oVerList.getBinding("items").filter([])}}else if(t.includes("scen")){d._oCore.byId(this._valueHelpDialogScen.getId()+"-searchField").setValue("");if(d.oScenList.getBinding("items")){d.oScenList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),i=e.getParameter("id"),s=[];t=t?t.trim():"";if(i.includes("Loc")){if(t!==""){s.push(new o({filters:[new o("LOCATION_ID",l.Contains,t),new o("LOCATION_DESC",l.Contains,t)],and:false}))}d.oLocList.getBinding("items").filter(s)}else if(i.includes("prod")){if(t!==""){s.push(new o({filters:[new o("PRODUCT_ID",l.Contains,t),new o("PROD_DESC",l.Contains,t)],and:false}))}d.oProdList.getBinding("items").filter(s)}else if(i.includes("Ver")){if(t!==""){s.push(new o({filters:[new o("VERSION",l.Contains,t)],and:false}))}d.oVerList.getBinding("items").filter(s)}else if(i.includes("scen")){if(t!==""){s.push(new o({filters:[new o("SCENARIO",l.Contains,t)],and:false}))}d.oScenList.getBinding("items").filter(s)}},handleSelection:function(e){d.oGModel=d.getModel("oGModel");var t=e.getParameter("id"),i=e.getParameter("selectedItems"),r,a=[];if(t.includes("Loc")){d.oLoc=d.byId("idloc");d.oProd=d.byId("idprod");r=e.getParameter("selectedItems");d.oLoc.setValue(r[0].getTitle());d.oGModel.setProperty("/SelectedLoc",r[0].getTitle());d.oProd.setValue("");d.oVer.setValue("");d.oScen.setValue("");d.oGModel.setProperty("/SelectedProd","");this.getModel("BModel").read("/getLocProdDet",{filters:[new o("LOCATION_ID",l.EQ,r[0].getTitle())],success:function(e){d.prodModel.setData(e);d.oProdList.setModel(d.prodModel)},error:function(e,t){s.show("error")}})}else if(t.includes("prod")){d.oProd=d.byId("idprod");r=e.getParameter("selectedItems");d.oProd.setValue(r[0].getTitle());d.oGModel.setProperty("/SelectedProd",r[0].getTitle());d.oVer.setValue("");d.oScen.setValue("");this.getModel("BModel").read("/getIbpVerScn",{filters:[new o("LOCATION_ID",l.EQ,d.oGModel.getProperty("/SelectedLoc")),new o("PRODUCT_ID",l.EQ,r[0].getTitle())],success:function(e){d.verModel.setData(e);d.oVerList.setModel(d.verModel)},error:function(e,t){s.show("error")}})}else if(t.includes("Ver")){this.oVer=d.byId("idver");r=e.getParameter("selectedItems");d.oVer.setValue(r[0].getTitle());d.oScen.setValue("");d.oGModel.setProperty("/SelectedVer",r[0].getTitle());this.getModel("BModel").read("/getIbpVerScn",{filters:[new o("LOCATION_ID",l.EQ,d.oGModel.getProperty("/SelectedLoc")),new o("PRODUCT_ID",l.EQ,d.oGModel.getProperty("/SelectedProd")),new o("VERSION",l.EQ,r[0].getTitle())],success:function(e){d.scenModel.setData(e);d.oScenList.setModel(d.scenModel)},error:function(e,t){s.show("error")}})}else if(t.includes("scen")){this.oScen=d.byId("idscen");r=e.getParameter("selectedItems");d.oScen.setValue(r[0].getTitle());d.oGModel.setProperty("/SelectedScen",r[0].getTitle())}d.handleClose(e)},onhandlePress:function(e){var t=this.byId("IBPfdemList").getSelectedItems();d.oGModel=d.getModel("oGModel");var i=t[0].getBindingContext().getProperty();d.oGModel.setProperty("/sLoc",i.LOCATION_ID);d.oGModel.setProperty("/sProd",i.PRODUCT_ID);d.oGModel.setProperty("/sVer",i.VERSION);d.oGModel.setProperty("/sScen",i.SCENARIO);var o=new Date(i.WEEK_DATE),l=o.getMonth()+1,s=o.getDate(),r;if(l<10){l="0"+l}if(o.getDate()<10){s="0"+o.getDate()}r=o.getFullYear()+"-"+l+"-"+s;d.oGModel.setProperty("/sWeek",r);var a=sap.ui.core.UIComponent.getRouterFor(d);a.navTo("Detail",{},true)},onSearch:function(e){if(e){var t=e.getParameter("value")||e.getParameter("newValue")}else{var t=d.byId("headSearch").getValue()}var i=[];t=t?t.trim():"";if(t!==""){i.push(new o({filters:[new o("WEEK_DATE",l.Contains,t),new o("QUANTITY",l.Contains,t),new o("VERSION",l.Contains,t),new o("SCENARIO",l.Contains,t)],and:false}))}d.byId("IBPfdemList").getBinding("items").filter(i)}})});