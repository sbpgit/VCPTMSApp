sap.ui.define(["cpappf/cpnodesdetails/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/Device"],function(e,s,t,o,i,a,c){"use strict";var d,n;return e.extend("cpappf.cpnodesdetails.controller.ItemMaster",{onInit:function(){d=this;d.oModel=new t;this.bus=sap.ui.getCore().getEventBus();this.bus.subscribe("data","refreshMaster",this.refreshMaster,this);this.bus.publish("nav","toBeginPage",{viewName:this.getView().getProperty("viewName")})},refreshMaster:function(){this.onAfterRendering()},onAfterRendering:function(){d=this;n=this.getModel("oGModel");this.getModel("BModel").read("/getNodes",{success:function(e){d.AccessNodes=[];d.StructureNodes=[];d.ViewNodes=[];for(var s=0;s<e.results.length;s++){if(e.results[s].NODE_TYPE==="AN"){d.AccessNodes.push(e.results[s])}else if(e.results[s].NODE_TYPE==="SN"){d.StructureNodes.push(e.results[s])}else if(e.results[s].NODE_TYPE==="VN"){d.ViewNodes.push(e.results[s])}}d.oModel.setData({results:d.AccessNodes});d.byId("accessList").setModel(d.oModel)},error:function(){s.show("Failed to get data")}})},onhandlePress:function(e){n=this.getModel("oGModel");if(e){var s=e.getSource().getSelectedItem().getBindingContext().getObject();n.setProperty("/SelectedAccessNode",s.CHILD_NODE);n.setProperty("/struNodeData",d.StructureNodes);n.setProperty("/ViewNodeData",d.ViewNodes)}else{}d.getOwnerComponent().runAsOwner(function(){if(!d.oDetailView){try{d.oDetailView=sap.ui.view({viewName:"cpappf.cpnodesdetails.view.ItemDetail",type:"XML"});d.bus.publish("flexible","addDetailPage",d.oDetailView);d.bus.publish("nav","toDetailPage",{viewName:d.oDetailView.getViewName()})}catch(e){d.oDetailView.onAfterRendering()}}else{d.bus.publish("nav","toDetailPage",{viewName:d.oDetailView.getViewName()})}})},onSearch:function(e){var s=e.getParameter("value")||e.getParameter("newValue"),t=[];if(s!==""){t.push(new o({filters:[new o("CHILD_NODE",i.Contains,s)],and:false}))}d.byId("accessList").getBinding("items").filter(t)},onAccNode:function(e){if(!d._oAccesNode){d._oAccesNode=sap.ui.xmlfragment("cpappf.cpnodesdetails.view.AccesNodes",d);d.getView().addDependent(d._oAccesNode)}if(e.getSource().getTooltip().includes("Add")){d._oAccesNode.setTitle("Access Node Creation");sap.ui.getCore().byId("idAccesNode").setValue("");sap.ui.getCore().byId("idDesc").setValue("");d._oAccesNode.open()}else{if(this.byId("accessList").getSelectedItems().length){var t=this.byId("accessList").getSelectedItem().getCells()[0];d._oAccesNode.setTitle("Update Access Node");sap.ui.getCore().byId("idAccesNode").setValue(t.getTitle());sap.ui.getCore().byId("idDesc").setValue(t.getText());sap.ui.getCore().byId("idAccesNode").setEditable(false);d._oAccesNode.open()}else{s.show("Select access node to update")}}},onAccNodeClose:function(){d._oAccesNode.close();d._oAccesNode.destroy(true);d._oAccesNode=""},onAccNodeDel:function(e){var t=this.byId("accessList").getSelectedItem().getCells()[0].getTitle();var o="Please Confirm to Remove access node"+" - "+t;sap.m.MessageBox.show(o,{title:"Confirmation",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){oModel.setUseBatch(false);var o={};o.Project=t;o.Username=d.username;sap.ui.core.BusyIndicator.show();this.getModel("BModel").callFunction("/genpvs",{method:"GET",urlParameters:{CHILD_NODE:"",PARENT_NODE:"",NODE_TYPE:"AN",NODE_DESC:"",FLAG:""},success:function(e){sap.ui.core.BusyIndicator.hide()},error:function(){s.show("Failed to get data")}})}}})},onAccessNodeSave:function(){sap.ui.getCore().byId("idAccesNode");sap.ui.getCore().byId("idDesc")}})});