sap.ui.define(["cp/appf/cpobjdepdetails/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/Device"],function(e,t,s,a,n,o,i){"use strict";var r,d;return e.extend("cp.appf.cpobjdepdetails.controller.ItemMaster",{onInit:function(){r=this;r.oModel=new s;r.oHdrModel=new s;r.oModel.setSizeLimit(2e3);d=r.getOwnerComponent().getModel("oGModel");if(!r._onObjDepChar){r._onObjDepChar=sap.ui.xmlfragment("cp.appf.cpobjdepdetails.view.ObjDepChar",r);r.getView().addDependent(r._onObjDepChar)}},onAfterRendering:function(){r=this;d=this.getModel("oGModel");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getBomOdCond",{success:function(e){sap.ui.core.BusyIndicator.hide();r.oModel.setData({results:e.results});r.byId("objDepList").setModel(r.oModel)},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})},onhandlePress:function(e){d=r.getOwnerComponent().getModel("oGModel");var o=e.getSource().getSelectedItem().getTitle(),i=o.split("_"),l=i[0],u=i[1];d.setProperty("/objDep",l);d.setProperty("/objCounter",u);var f=r.getView().byId("idMyTable");r.oCharModel=new s;f.destroyColumns();var p=new sap.m.ColumnListItem("aaColList",{cells:[]});if(f){f.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({results:[]});f.setModel(m);f.bindItems("/results",p)}this.getModel("BModel").read("/getODcharval",{filters:[new a("OBJ_DEP",n.EQ,o)],success:function(e){r.oCharModel.setData({charResults:e.results});sap.ui.getCore().byId("idChartab").setModel(r.oCharModel)},error:function(){t.show("Failed to get data")}});this.getModel("BModel").callFunction("/genODHistory",{method:"GET",urlParameters:{OBJ_DEP:l,OBJ_COUNTER:u},success:function(e){sap.ui.core.BusyIndicator.hide();if(e.results.length!==0){e.results.forEach(function(e){e.CAL_DATE=new Date(e.CAL_DATE.replace(/[^0-9]+/g,"")*1)});var t=e.results[0];var a;if(!(t.ROW_ID1!==undefined)){a=0}else if(!(t.ROW_ID2!==undefined)){a=1}else if(!(t.ROW_ID3!==undefined)){a=2}else if(!(t.ROW_ID4!==undefined)){a=3}else if(!(t.ROW_ID5!==undefined)){a=4}else if(!(t.ROW_ID6!==undefined)){a=5}else if(!(t.ROW_ID7!==undefined)){a=6}else if(!(t.ROW_ID8!==undefined)){a=7}else if(!(t.ROW_ID9!==undefined)){a=8}else if(!(t.ROW_ID10!==undefined)){a=9}else if(!(t.ROW_ID11!==undefined)){a=10}else if(!(t.ROW_ID12!==undefined)){a=11}var n=r.getView().byId("idMyTable");a=parseInt(a)+1;var o=new sap.m.Column("colweek",{header:new sap.m.Text({text:"WeeK"})});n.addColumn(o);var o=new sap.m.Column("colcounter",{header:new sap.m.Text({text:"ODCount"})});n.addColumn(o);for(var i=1;i<a;i++){var o=new sap.m.Column("col"+i,{hAlign:"Center",header:new sap.m.Text({text:"ROW_ID"+i})});n.addColumn(o)}var d=[];var l=new sap.m.Text({text:"{path: 'CAL_DATE' , type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MM/dd/yyyy' }}"});d.push(l);var l=new sap.m.Text({text:"{ODCOUNT}"});d.push(l);for(var i=1;i<a;i++){var u="{ROW_ID";var f="}";var l=new sap.m.Text({text:u+i+f});d.push(l)}var p=new sap.m.ColumnListItem("aColList",{cells:d});if(n){n.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({results:e.results});n.setModel(m);n.bindItems("/results",p)}r.byId("idhisPanel").setExpanded(true)}r.getODFuture()},error:function(){t.show("Failed to get data")}})},getODFuture:function(){d=r.getOwnerComponent().getModel("oGModel");var e=d.getProperty("/objDep");var a=d.getProperty("/objCounter");var n=r.getView().byId("idFutTable");n.destroyColumns();var o=new sap.m.ColumnListItem("futColList",{cells:[]});if(n){n.setBusy(false);var i=new s;i.setSizeLimit(2e3);i.setData({futresults:[]});n.setModel(i);n.bindItems("/futresults",o)}sap.ui.core.BusyIndicator.show();r.getModel("BModel").callFunction("/genODFuture",{method:"GET",urlParameters:{OBJ_DEP:e,OBJ_COUNTER:a},success:function(e){if(e.results.length!==0){e.results.forEach(function(e){e.CAL_DATE=new Date(e.CAL_DATE.replace(/[^0-9]+/g,"")*1)});var t=e.results[0];var a;if(!(t.ROW_ID1!==undefined)){a=0}else if(!(t.ROW_ID2!==undefined)){a=1}else if(!(t.ROW_ID3!==undefined)){a=2}else if(!(t.ROW_ID4!==undefined)){a=3}else if(!(t.ROW_ID5!==undefined)){a=4}else if(!(t.ROW_ID6!==undefined)){a=5}else if(!(t.ROW_ID7!==undefined)){a=6}else if(!(t.ROW_ID8!==undefined)){a=7}else if(!(t.ROW_ID9!==undefined)){a=8}else if(!(t.ROW_ID10!==undefined)){a=9}else if(!(t.ROW_ID11!==undefined)){a=10}else if(!(t.ROW_ID12!==undefined)){a=11}var n=r.getView().byId("idFutTable");a=parseInt(a)+1;var o=new sap.m.Column("futcolweek",{header:new sap.m.Text({text:"WeeK"})});n.addColumn(o);var o=new sap.m.Column("futcolcounter",{header:new sap.m.Text({text:"ODCount"})});n.addColumn(o);var o=new sap.m.Column("futVersion",{header:new sap.m.Text({text:"Version"})});n.addColumn(o);var o=new sap.m.Column("futScenario",{header:new sap.m.Text({text:"Scenario "})});n.addColumn(o);for(var i=1;i<a;i++){var o=new sap.m.Column("futcol"+i,{hAlign:"Center",header:new sap.m.Text({text:"ROW_ID"+i})});n.addColumn(o)}var d=[];var l=new sap.m.Text({text:"{path: 'CAL_DATE' , type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MM/dd/yyyy' }}"});d.push(l);var l=new sap.m.Text({text:"{path: 'ODCOUNT', type: 'sap.ui.model.type.Float', formatOptions: { maxFractionDigits: 3, roundingMode: 'HALF_AWAY_FROM_ZERO ' }}"});d.push(l);var l=new sap.m.Text({text:"{VERSION}"});d.push(l);var l=new sap.m.Text({text:"{SCENARIO}"});d.push(l);for(var i=1;i<a;i++){var u="{ROW_ID";var f="}";var l=new sap.m.Text({text:u+i+f});d.push(l)}var p=new sap.m.ColumnListItem("afutColList",{cells:d});if(n){n.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({futresults:e.results});n.setModel(m);n.bindItems("/futresults",p)}r.byId("idFutPanel").setExpanded(true)}sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},onSearch:function(e){d.setProperty("/objDep","");r.byId("objDepList").removeSelections();r.byId("idhisPanel").setExpanded(false);r.byId("idFutPanel").setExpanded(false);var o=r.getView().byId("idMyTable");if(o.getItems().length!==0){var i=new sap.m.ColumnListItem("emptyHisColList",{cells:[]});if(o){o.setBusy(false);var l=new s;l.setSizeLimit(2e3);l.setData({results:[]});o.setModel(l);o.bindItems("/results",i)}var u=r.getView().byId("idFutTable");var f=new sap.m.ColumnListItem("emptyfutColList",{cells:[]});if(u){u.setBusy(false);var p=new s;p.setSizeLimit(2e3);p.setData({futresults:[]});u.setModel(p);u.bindItems("/futresults",f)}}var m=e.getParameters("sQuery").sQuery;if(m){m=m+"_1";this.getModel("BModel").read("/getBomOdCond",{filters:[new a("OBJ_DEP",n.EQ,m)],success:function(e){r.oModel.setData({results:e.results});r.byId("objDepList").setModel(r.oModel);sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})}else{r.onAfterRendering()}},onParameters:function(){r._onObjDepChar.open()},handleClose:function(){r._onObjDepChar.close()},oncharSearch:function(e){var t="",s=[];if(e){var t=e.getParameter("value")||e.getParameter("newValue")}if(t!==""){s.push(new a({filters:[new a("CLASS_NAME",n.Contains,t),new a("CHAR_NAME",n.Contains,t),new a("CHAR_VALUE",n.Contains,t)],and:false}))}sap.ui.getCore().byId("idChartab").getBinding("items").filter(s)}})});