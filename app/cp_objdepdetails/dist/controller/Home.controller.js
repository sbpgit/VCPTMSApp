sap.ui.define(["cp/appf/cpobjdepdetails/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/Device"],function(e,t,s,n,a,o,r){"use strict";var i,d;return e.extend("cp.appf.cpobjdepdetails.controller.ItemMaster",{onInit:function(){i=this;i.oModel=new s;i.oHdrModel=new s;i.oModel.setSizeLimit(2e3);d=i.getOwnerComponent().getModel("oGModel");if(!i._onObjDepChar){i._onObjDepChar=sap.ui.xmlfragment("cp.appf.cpobjdepdetails.view.ObjDepChar",i);i.getView().addDependent(i._onObjDepChar)}},onAfterRendering:function(){i=this;d=this.getModel("oGModel");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getBomOdCond",{success:function(e){sap.ui.core.BusyIndicator.hide();i.oModel.setData({results:e.results});i.byId("objDepList").setModel(i.oModel)},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})},onhandlePress:function(e){d=i.getOwnerComponent().getModel("oGModel");var o=e.getSource().getSelectedItem().getTitle(),r=o.split("_"),l=r[0],u=r[1];d.setProperty("/objDep",l);d.setProperty("/objCounter",u);var f=i.getView().byId("idMyTable");i.oCharModel=new s;var p;f.destroyColumns();var p=new sap.m.ColumnListItem({cells:[]});if(f){f.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({results:[]});f.setModel(m);f.bindItems("/results",p)}this.getModel("BModel").read("/getODcharval",{filters:[new n("OBJ_DEP",a.EQ,o)],success:function(e){i.oCharModel.setData({charResults:e.results});sap.ui.getCore().byId("idChartab").setModel(i.oCharModel)},error:function(){t.show("Failed to get data")}});this.getModel("BModel").callFunction("/genODHistory",{method:"GET",urlParameters:{OBJ_DEP:l,OBJ_COUNTER:u},success:function(e){sap.ui.core.BusyIndicator.hide();if(e.results.length!==0){e.results.forEach(function(e){e.CAL_DATE=new Date(e.CAL_DATE.replace(/[^0-9]+/g,"")*1)});var t=e.results[0];var n;if(!(t.ROW_ID1!==undefined)){n=0}else if(!(t.ROW_ID2!==undefined)){n=1}else if(!(t.ROW_ID3!==undefined)){n=2}else if(!(t.ROW_ID4!==undefined)){n=3}else if(!(t.ROW_ID5!==undefined)){n=4}else if(!(t.ROW_ID6!==undefined)){n=5}else if(!(t.ROW_ID7!==undefined)){n=6}else if(!(t.ROW_ID8!==undefined)){n=7}else if(!(t.ROW_ID9!==undefined)){n=8}else if(!(t.ROW_ID10!==undefined)){n=9}else if(!(t.ROW_ID11!==undefined)){n=10}else if(!(t.ROW_ID12!==undefined)){n=11}var a=i.getView().byId("idMyTable");n=parseInt(n)+1;var o=new sap.m.Column("colweek",{header:new sap.m.Text({text:"WeeK"})});a.addColumn(o);var o=new sap.m.Column("colcounter",{header:new sap.m.Text({text:"ODCount"})});a.addColumn(o);for(var r=1;r<n;r++){var o=new sap.m.Column("col"+r,{hAlign:"Center",header:new sap.m.Text({text:"ROW_ID"+r})});a.addColumn(o)}var d=[];var l=new sap.m.Text({text:"{path: 'CAL_DATE' , type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MM/dd/yyyy' }}"});d.push(l);var l=new sap.m.Text({text:"{ODCOUNT}"});d.push(l);for(var r=1;r<n;r++){var u="{ROW_ID";var f="}";var l=new sap.m.Text({text:u+r+f});d.push(l)}var p=new sap.m.ColumnListItem({cells:d});if(a){a.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({results:e.results});a.setModel(m);a.bindItems("/results",p)}i.byId("idhisPanel").setExpanded(true)}i.getODFuture()},error:function(){t.show("Failed to get data")}})},getODFuture:function(){d=i.getOwnerComponent().getModel("oGModel");var e=d.getProperty("/objDep");var n=d.getProperty("/objCounter");var a=i.getView().byId("idFutTable");a.destroyColumns();var o=new sap.m.ColumnListItem({cells:[]});if(a){a.setBusy(false);var r=new s;r.setSizeLimit(2e3);r.setData({futresults:[]});a.setModel(r);a.bindItems("/futresults",o)}sap.ui.core.BusyIndicator.show();i.getModel("BModel").callFunction("/genODFuture",{method:"GET",urlParameters:{OBJ_DEP:e,OBJ_COUNTER:n},success:function(e){if(e.results.length!==0){e.results.forEach(function(e){e.CAL_DATE=new Date(e.CAL_DATE.replace(/[^0-9]+/g,"")*1)});var t=e.results[0];var n;if(!(t.ROW_ID1!==undefined)){n=0}else if(!(t.ROW_ID2!==undefined)){n=1}else if(!(t.ROW_ID3!==undefined)){n=2}else if(!(t.ROW_ID4!==undefined)){n=3}else if(!(t.ROW_ID5!==undefined)){n=4}else if(!(t.ROW_ID6!==undefined)){n=5}else if(!(t.ROW_ID7!==undefined)){n=6}else if(!(t.ROW_ID8!==undefined)){n=7}else if(!(t.ROW_ID9!==undefined)){n=8}else if(!(t.ROW_ID10!==undefined)){n=9}else if(!(t.ROW_ID11!==undefined)){n=10}else if(!(t.ROW_ID12!==undefined)){n=11}var a=i.getView().byId("idFutTable");n=parseInt(n)+1;var o=new sap.m.Column("futcolweek",{header:new sap.m.Text({text:"WeeK"})});a.addColumn(o);var o=new sap.m.Column("futcolcounter",{header:new sap.m.Text({text:"ODCount"})});a.addColumn(o);var o=new sap.m.Column("futVersion",{header:new sap.m.Text({text:"Version"})});a.addColumn(o);var o=new sap.m.Column("futScenario",{header:new sap.m.Text({text:"Scenario "})});a.addColumn(o);for(var r=1;r<n;r++){var o=new sap.m.Column("futcol"+r,{hAlign:"Center",header:new sap.m.Text({text:"ROW_ID"+r})});a.addColumn(o)}var d=[];var l=new sap.m.Text({text:"{path: 'CAL_DATE' , type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'MM/dd/yyyy' }}"});d.push(l);var l=new sap.m.Text({text:"{path: 'ODCOUNT', type: 'sap.ui.model.type.Float', formatOptions: { maxFractionDigits: 3, roundingMode: 'HALF_AWAY_FROM_ZERO ' }}"});d.push(l);var l=new sap.m.Text({text:"{VERSION}"});d.push(l);var l=new sap.m.Text({text:"{SCENARIO}"});d.push(l);for(var r=1;r<n;r++){var u="{ROW_ID";var f="}";var l=new sap.m.Text({text:u+r+f});d.push(l)}var p=new sap.m.ColumnListItem({cells:d});if(a){a.setBusy(false);var m=new s;m.setSizeLimit(2e3);m.setData({futresults:e.results});a.setModel(m);a.bindItems("/futresults",p)}i.byId("idFutPanel").setExpanded(true)}sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})},onSearch:function(e){d.setProperty("/objDep","");i.byId("objDepList").removeSelections();i.byId("idhisPanel").setExpanded(false);i.byId("idFutPanel").setExpanded(false);var o=i.getView().byId("idMyTable");if(o.getItems().length!==0){var r=new sap.m.ColumnListItem({cells:[]});if(o){o.setBusy(false);var l=new s;l.setSizeLimit(2e3);l.setData({results:[]});o.setModel(l);o.bindItems("/results",r)}var u=i.getView().byId("idFutTable");var f=new sap.m.ColumnListItem({cells:[]});if(u){u.setBusy(false);var p=new s;p.setSizeLimit(2e3);p.setData({futresults:[]});u.setModel(p);u.bindItems("/futresults",f)}}var m=e.getParameters("sQuery").sQuery;if(m){m=m+"_1";this.getModel("BModel").read("/getBomOdCond",{filters:[new n("OBJ_DEP",a.EQ,m)],success:function(e){i.oModel.setData({results:e.results});i.byId("objDepList").setModel(i.oModel);sap.ui.core.BusyIndicator.hide()},error:function(){t.show("Failed to get data")}})}else{i.onAfterRendering()}},onParameters:function(){i._onObjDepChar.open()},handleClose:function(){i._onObjDepChar.close()},oncharSearch:function(e){var t="",s=[];if(e){var t=e.getParameter("value")||e.getParameter("newValue")}if(t!==""){s.push(new n({filters:[new n("CLASS_NAME",a.Contains,t),new n("CHAR_NAME",a.Contains,t),new n("CHAR_VALUE",a.Contains,t)],and:false}))}sap.ui.getCore().byId("idChartab").getBinding("items").filter(s)}})});