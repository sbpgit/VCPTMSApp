sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/GroupHeaderListItem","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,o,a){"use strict";var r=this;return e.extend("cpapp.cpplaningconfig.controller.Home",{onInit:function(){var e;r=this;r.oParameterModel=new a;r.oMethodModel=new a;if(!r.oMethodDialog){r.oMethodDialog=sap.ui.xmlfragment("cpapp.cpplaningconfig.view.MethodTyp",r);r.getView().addDependent(r.oMethodDialog)}e=r.getRouter().getRoute("RouteHome");e.attachPatternMatched(r._onPatternMatched,r)},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},grouper:function(e){return{key:e.oModel.oData.Steps[e.sPath.split("/")[2]].GROUP_DESCRIPTION}},getGroupHeader:function(e){var o=e.key.slice(1);return new t({title:o,upperCase:false})},onPressSave:function(){var e=r.getOwnerComponent().getModel("PCModel");var t={PARAMVALS:[]},a;var n="";var s=r.getView().byId("idParameterTable").getItems();for(var l=0;l<s.length;l++){var i=s[l];if(i._bGroupHeader===false){if(i.getCells()[2].getValue()!==""&&i.getCells()[2].getValueState()==="None"){if(i.getCells()[2].getName()!==""&&i.getCells()[2].getName()!==undefined){n=i.getCells()[2].getName()}else{n=i.getCells()[2].getValue()}a={PARAMETER_ID:i.getCells()[0].getText(),VALUE:n};t.PARAMVALS.push(a)}else{o.show(r.i18n.getText("getMandtMsg"),{width:"15%"});return}}}e.callFunction("/postParameterValues",{method:"GET",urlParameters:{FLAG:"C",PARAMVALS:JSON.stringify(t.PARAMVALS)},success:function(e,t){sap.m.MessageToast.show(r.i18n.getText("postSuccess"))},error:function(e){sap.m.MessageToast.show("Error")}})},getParameters:function(e){e.read("/V_Parameters",{success:function(e){r.oParameterModel.setData({parameters:e.results});r.byId("idParameterTable").setModel(r.oParameterModel)},error:function(e){o.show("Failed to fetch Parameters!")}})},getMethods:function(e){e.read("/Method_Types",{success:function(e){r.oMethodModel.setData({methods:e.results})},error:function(e){o.show("Failed to fetch Method Types!")}})},handleValueHelpRequest:function(e){var t=r.getView().byId("idParameterTable").getModel();var o=e.getSource().getBindingContext();var a=t.getProperty("VALUE_HELP_TAB",o);switch(a){case"Method_Types":r.oSelectedInputExe=e.getSource();if(r.oMethodDialog){r.oMethodDialog.setModel(r.oMethodModel);r.oMethodDialog.open()}}},onListItemPress:function(e){var t=e.getParameter("listItem").getTitle();r.sSelMethodTyp=e.getParameter("listItem").getInfo();if(r.oSelectedInputExe){r.oSelectedInputExe.setValue(t);r.oSelectedInputExe.setName(r.sSelMethodTyp)}r.oMethodDialog.close()},onCloseDialog:function(){if(r.oMethodDialog){r.oMethodDialog.close()}},onParamValueChange:function(e){var t;r.oSelectedInput=e.getSource();var o=r.getView().byId("idParameterTable").getModel();var a=e.getSource().getBindingContext();var n=o.getProperty("MIN_VALUE",a);var s=o.getProperty("MAX_VALUE",a);var l=e.getParameter("newValue");if(parseInt(s)>0){if(parseInt(l)<parseInt(n)||parseInt(l)>parseInt(s)){r.oSelectedInput.setValueState("Error");t="Please enter value between "+n+" and "+s;r.oSelectedInput.setValueStateText(t)}else{r.oSelectedInput.setValueState("None");t="";r.oSelectedInput.setValueStateText(t)}}},_onPatternMatched:function(){var e=r.getOwnerComponent().getModel("PCModel");r.i18n=r.getOwnerComponent().getModel("i18n").getResourceBundle();r.getParameters(e);r.getMethods(e)}})});