sap.ui.define(["cpapp/cpplaningconfig/controller/BaseController","sap/m/GroupHeaderListItem","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device"],function(e,t,o,a,r,n,l){"use strict";var s=this,i;return e.extend("cpapp.cpplaningconfig.controller.Home",{onInit:function(){var e;s=this;this.bus=sap.ui.getCore().getEventBus();i=s.getOwnerComponent().getModel("oGModel");s.i18n=s.getResourceBundle();s.oParameterModel=new a;s.oMethodModel=new a;var t=this.getView().byId("idDetailView"),o=t.getShowFooter();t.setShowFooter(o);if(!s.oMethodDialog){s.oMethodDialog=sap.ui.xmlfragment("cpapp.cpplaningconfig.view.MethodTyp",s);s.getView().addDependent(s.oMethodDialog)}},onAfterRendering:function(){var e=s.getOwnerComponent().getModel("PCModel");i=s.getOwnerComponent().getModel("oGModel");var t=i.getProperty("/location");s.getParameters();s.getMethods(e)},grouper:function(e){return{key:e.oModel.oData.Steps[e.sPath.split("/")[2]].GROUP_DESCRIPTION}},getGroupHeader:function(e){var o=e.key.slice(1);return new t({title:o,upperCase:false})},onPressSave:function(){var e=s.getOwnerComponent().getModel("PCModel");var t={PARAMVALS:[]},a;var r="";var n=i.getProperty("/location");var l=s.getView().byId("idParameterTable").getItems();for(var d=0;d<l.length;d++){var g=l[d];if(g._bGroupHeader===false){if(g.getCells()[2].getValue()!==""&&g.getCells()[2].getValueState()==="None"){if(g.getCells()[2].getName()!==""&&g.getCells()[2].getName()!==undefined){r=g.getCells()[2].getName()}else{r=g.getCells()[2].getValue()}a={LOCATION_ID:n,PARAMETER_ID:g.getCells()[0].getText(),VALUE:r};t.PARAMVALS.push(a)}else{o.show(s.i18n.getText("getMandtMsg"),{width:"15%"});return}}}e.callFunction("/postParameterValues",{method:"GET",urlParameters:{FLAG:"C",PARAMVALS:JSON.stringify(t.PARAMVALS)},success:function(e,t){sap.m.MessageToast.show(s.i18n.getText("postSuccess"))},error:function(e){sap.m.MessageToast.show("Error")}})},getPlannedParameters:function(e){var t=[];s.getModel("PCModel").read("/V_Parameters",{filters:[new r("LOCATION_ID",n.EQ,e)],success:function(e){t=e.results;if(t.length>0){t=t.sort((e,t)=>e.SEQUENCE-t.SEQUENCE);s.oParameterModel.setData({parameters:t});s.byId("idParameterTable").setModel(s.oParameterModel)}else{s.getParameters()}},error:function(e){o.show("Failed to fetch Parameters!")}})},getParameters:function(){var e=[];s.getModel("PCModel").read("/V_Parameters",{success:function(t){e=t.results;if(e.length>0){s.getFilteredData(e)}},error:function(e){o.show("Failed to fetch Parameters!")}})},getFilteredData:function(e){var t=i.getProperty("/location");var o=[];var a=e.filter(function(e){return e.LOCATION_ID===t});var o=e.filter(function(e){return e.LOCATION_ID===""||e.LOCATION_ID===null});if(a.length>0){if(o.length>0){for(var r=0;r<o.length;r++){a.push(o[r])}}a=a.sort((e,t)=>e.SEQUENCE-t.SEQUENCE);s.oParameterModel.setData({parameters:a})}else{e=e.sort((e,t)=>e.SEQUENCE-t.SEQUENCE);const t=e.map(e=>e.PARAMETER_ID);const o=e.filter(({PARAMETER_ID:e},o)=>!t.includes(e,o+1));const a=o.map(e=>({...e,VALUE:""}));s.oParameterModel.setData({parameters:a})}s.byId("idParameterTable").setModel(s.oParameterModel)},getMethods:function(e){e.read("/Method_Types",{success:function(e){s.oMethodModel.setData({methods:e.results})},error:function(e){o.show("Failed to fetch Method Types!")}})},handleValueHelpRequest:function(e){var t=s.getView().byId("idParameterTable").getModel();var o=e.getSource().getBindingContext();var a=t.getProperty("VALUE_HELP_TAB",o);switch(a){case"Method_Types":s.oSelectedInputExe=e.getSource();if(s.oMethodDialog){s.oMethodDialog.setModel(s.oMethodModel);s.oMethodDialog.open()}}},onListItemPress:function(e){var t=e.getParameter("listItem").getTitle();s.sSelMethodTyp=e.getParameter("listItem").getInfo();if(s.oSelectedInputExe){s.oSelectedInputExe.setValue(t);s.oSelectedInputExe.setName(s.sSelMethodTyp)}s.oMethodDialog.close()},onCloseDialog:function(){if(s.oMethodDialog){s.oMethodDialog.close()}},onParamValueChange:function(e){var t;s.oSelectedInput=e.getSource();var o=s.getView().byId("idParameterTable").getModel();var a=e.getSource().getBindingContext();var r=o.getProperty("MIN_VALUE",a);var n=o.getProperty("MAX_VALUE",a);var l=e.getParameter("newValue");if(a.getObject().PARAMETER_ID===9){var i=o.getData().parameters[0];r=i.VALUE}if(parseInt(n)>0){if(parseInt(l)<parseInt(r)||parseInt(l)>parseInt(n)){s.oSelectedInput.setValueState("Error");t="Please enter value between "+r+" and "+n;s.oSelectedInput.setValueStateText(t)}else{s.oSelectedInput.setValueState("None");t="";s.oSelectedInput.setValueStateText(t)}}},_onPatternMatched:function(e){var t=s.getOwnerComponent().getModel("PCModel");var o=e.getParameter("arguments");s.location=o.location;s.i18n=s.getOwnerComponent().getModel("i18n").getResourceBundle();s.getMethods(t)}})});