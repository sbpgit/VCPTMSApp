sap.ui.define(["cp/appf/cpsaleshconfig/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,i,s,l,a,r){"use strict";var d,n;return e.extend("cp.appf.cpsaleshconfig.controller.Home",{onInit:function(){d=this;d.oListModel=new i;this.locModel=new i;this.prodModel=new i;this.oListModel.setSizeLimit(5e3);d.locModel.setSizeLimit(1e3);d.prodModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}},onAfterRendering:function(){d=this;d.oList=this.byId("idTab");this.oProd=this.byId("prodInput");this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");d.oList.removeSelections();if(d.oList.getBinding("items")){d.oList.getBinding("items").filter([])}this.getData()},getData:function(){this.getModel("BModel").read("/getLocation",{success:function(e){d.locModel.setData(e);d.oLocList.setModel(d.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("error")}})},handleValueHelp:function(e){var t=e.getParameter("id");if(t.includes("loc")){d._valueHelpDialogLoc.open()}else if(t.includes("prod")){d._valueHelpDialogProd.open()}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){d._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(d.oLocList.getBinding("items")){d.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){d._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(d.oProdList.getBinding("items")){d.oProdList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),i=[];t=t?t.trim():"";if(o.includes("loc")){if(t!==""){i.push(new s({filters:[new s("LOCATION_ID",l.Contains,t),new s("LOCATION_DESC",l.Contains,t)],and:false}))}d.oLocList.getBinding("items").filter(i)}else if(o.includes("prod")){if(t!==""){i.push(new s({filters:[new s("PRODUCT_ID",l.Contains,t),new s("PROD_DESC",l.Contains,t)],and:false}))}d.oProdList.getBinding("items").filter(i)}},handleSelection:function(e){var o=e.getParameter("id"),i=e.getParameter("selectedItems"),a,r=[];if(o.includes("Loc")){this.oLoc=d.byId("idloc");a=e.getParameter("selectedItems");d.oLoc.setValue(a[0].getTitle());d.oProd.removeAllTokens();this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].removeSelections();this.getModel("BModel").read("/getLocProdDet",{filters:[new s("LOCATION_ID",l.EQ,a[0].getTitle())],success:function(e){d.prodModel.setData(e);d.oProdList.setModel(d.prodModel)},error:function(e,o){t.show("error")}})}else if(o.includes("prod")){this.oProd=d.byId("prodInput");a=e.getParameter("selectedItems");if(a&&a.length>0){d.oProd.removeAllTokens();a.forEach(function(e){d.oProd.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}else{d.oProd.removeAllTokens()}}d.handleClose(e)},onGetData:function(e){var o=new Date(d.byId("idDate").getValue()),i,s;if(d.oLoc.getValue()&&d.oProdList.getSelectedItems().length!==0){var l=d.oProdList.getSelectedItems();var a=[];if(d.byId("idDate").getValue()!==""){i=o.getMonth()+1;if(i<10){i="0"+i}else{i=i}if(o.getDate<10){s="0"+o.getDate()}else{s=o.getDate()}var r=o.getFullYear()+"-"+i+"-"+s;var n=new sap.ui.model.Filter({path:"DOC_CREATEDDATE",operator:sap.ui.model.FilterOperator.EQ,value1:r});a.push(n)}var n=new sap.ui.model.Filter({path:"LOCATION_ID",operator:sap.ui.model.FilterOperator.EQ,value1:d.oLoc.getValue()});a.push(n);for(var g=0;g<l.length;g++){if(l[g].getTitle()!=="All"){n=new sap.ui.model.Filter({path:"PRODUCT_ID",operator:sap.ui.model.FilterOperator.EQ,value1:l[g].getTitle()});a.push(n)}}sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getSalesh",{filters:a,success:function(e){d.oListModel.setData({results:e.results});d.oList.setModel(d.oListModel);sap.ui.core.BusyIndicator.hide()},error:function(e){t.show("error");sap.ui.core.BusyIndicator.hide()}})}else{essageToast.show("Please fill all required fields")}},onhandlePress:function(e){d.oGModel=d.getModel("oGModel");var t=d.byId("idTab").getSelectedItem().getBindingContext().getObject();d.oGModel.setProperty("/selItem",t);d.oGModel.setProperty("/sSalOrd",t.SALES_DOC);d.oGModel.setProperty("/sSalOrdItem",t.SALESDOC_ITEM);d.oGModel.setProperty("/sPrdid",t.PRODUCT_ID);d.oGModel.setProperty("/sLocid",t.LOCATION_ID);d.oGModel.setProperty("/date",e.getSource().getSelectedItem().getCells()[2].getText());var o=sap.ui.core.UIComponent.getRouterFor(d);o.navTo("Detail",{},true)},onTableSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=[];if(t!==""){o.push(new s({filters:[new s("SALES_DOC",l.Contains,t),new s("PRODUCT_ID",l.Contains,t),new s("LOCATION_ID",l.Contains,t)],and:false}))}d.oList.getBinding("items").filter(o)}})});