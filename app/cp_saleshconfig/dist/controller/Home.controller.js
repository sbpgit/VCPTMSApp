sap.ui.define(["cp/appf/cpsaleshconfig/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment"],function(e,t,o,s,l,a,d,i){"use strict";var r,c;return e.extend("cp.appf.cpsaleshconfig.controller.Home",{onInit:function(){r=this;r.oListModel=new s;r.oLocModel=new s;r.oProdModel=new s;r.osalDocModel=new s;this.oListModel.setSizeLimit(5e3);r.oLocModel.setSizeLimit(1e3);r.oProdModel.setSizeLimit(1e3);r.osalDocModel.setSizeLimit(1500)},onAfterRendering:function(){r=this;r.oList=this.byId("idTab");r.oMcLoc=this.byId("idLoc");r.oMcProd=this.byId("idProd");r.oMcsalDoc=this.byId("idSalesDoc");r.oList.removeSelections();if(r.oList.getBinding("items")){r.oList.getBinding("items").filter([])}this.getData()},getData:function(){sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getSalesh",{success:function(e){r.aLocation=[];r.aProduct=[];r.aSalDoc=[];r.SelLoc=[];r.SelProd=[];r.SelSalDoc=[];var t=[],o=[],s=[];r.TableData=e.results;for(var l=0;l<e.results.length;l++){if(r.aLocation.indexOf(e.results[l].LOCATION_ID)===-1){r.aLocation.push(e.results[l].LOCATION_ID);if(e.results[l].LOCATION_ID!==""){r.oLocData={LOCATION_ID:e.results[l].LOCATION_ID};r.SelLoc.push(r.oLocData);t[l]=r.oLocData.LOCATION_ID}}if(r.aProduct.indexOf(e.results[l].PRODUCT_ID)===-1){r.aProduct.push(e.results[l].PRODUCT_ID);if(e.results[l].PRODUCT_ID!==""){r.oProdData={PRODUCT_ID:e.results[l].PRODUCT_ID};r.SelProd.push(r.oProdData);o[l]=r.oProdData.PRODUCT_ID}}if(r.aSalDoc.length===0){r.aSalDoc.push("All")}if(r.aSalDoc.indexOf(e.results[l].SALES_DOC)===-1){r.aSalDoc.push(e.results[l].SALES_DOC);if(e.results[l].SALES_DOC!==""){r.oCompData={SALES_DOC:e.results[l].SALES_DOC};r.SelSalDoc.push(r.oCompData);s[l]=r.oCompData.SALES_DOC}}}r.oListModel.setData({results:e.results});r.oList.setModel(r.oListModel);r.SelSalDoc.unshift({SALES_DOC:"All"});r.oLocModel.setData({resultsLoc:r.SelLoc});r.oProdModel.setData({resultsProd:r.SelProd});r.osalDocModel.setData({resultsSalesDoc:r.SelSalDoc});r.oMcLoc.setModel(r.oLocModel);r.oMcProd.setModel(r.oProdModel);r.oMcsalDoc.setModel(r.osalDocModel);r.oMcLoc.setSelectedKeys(r.aLocation);r.oMcProd.setSelectedKeys(r.aProduct);r.oMcsalDoc.setSelectedKeys(r.aSalDoc);sap.ui.core.BusyIndicator.hide()},error:function(e){t.show("error")}})},onhandlePress:function(e){r.oGModel=r.getModel("oGModel");var t=e.getSource().getSelectedItem().getBindingContext().getObject();r.oGModel.setProperty("/selItem",t);r.oGModel.setProperty("/sSalOrd",t.SALES_DOC);r.oGModel.setProperty("/sSalOrdItem",t.SALESDOC_ITEM);r.oGModel.setProperty("/sPrdid",t.PRODUCT_ID);r.oGModel.setProperty("/sLocid",t.LOCATION_ID);r.oGModel.setProperty("/date",e.getSource().getSelectedItem().getCells()[2].getText());var o=sap.ui.core.UIComponent.getRouterFor(r);o.navTo("Detail",{},true)},handleSelection:function(e){r.selLoc=r.byId("idLoc").getSelectedKeys();r.selPrd=r.byId("idProd").getSelectedKeys();if(e.getParameters().id.includes("idSalesDoc")===true){var t=e.getParameters("listItem").changedItem.getText();var o=this.byId("idTab").getItems();var s=r.byId("idSalesDoc").getItems();if(t==="All"&&e.getParameter("selected")){r.byId("idSalesDoc").setSelectedItems(r.byId("idSalesDoc").getItems())}else if(t==="All"&&!e.getParameter("selected")){r.byId("idSalesDoc").removeAllSelectedItems()}else if(t!=="All"&&!e.getParameter("selected")&&o.length-1===s.length){r.byId("idSalesDoc").removeSelectedItem(r.byId("idSalesDoc").getItems()[0])}else if(t!=="All"&&e.getParameter("selected")&&o.length-1===s.length){r.byId("idSalesDoc").setSelectedItems(r.byId("idSalesDoc").getItems()[0])}else if(t==="All"&&o.length===1){r.byId("idSalesDoc").removeSelectedItem(r.byId("idSalesDoc").getItems()[0])}}r.selSalDoc=r.byId("idSalesDoc").getSelectedKeys();var d=[];if(r.selLoc.length>0){for(var i=0;i<r.selLoc.length;i++){d.push(new l("LOCATION_ID",a.EQ,r.selLoc[i]))}}if(r.selPrd.length>0){for(var c=0;c<r.selPrd.length;c++){d.push(new l("PRODUCT_ID",a.EQ,r.selPrd[c]))}}if(r.selSalDoc.length>0){for(var n=0;n<r.selSalDoc.length;n++){d.push(new l("SALES_DOC",a.EQ,r.selSalDoc[n]))}}r.byId("idTab").getBinding("items").filter(d)},onTableSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=[];if(t!==""){o.push(new l({filters:[new l("SALES_DOC",a.Contains,t),new l("PRODUCT_ID",a.Contains,t),new l("LOCATION_ID",a.Contains,t)],and:false}))}r.oList.getBinding("idTab").filter(o)}})});