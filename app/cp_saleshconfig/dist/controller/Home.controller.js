e:null,sap.ui.define(["cp/appf/cpsaleshconfig/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","sap/m/Dialog","sap/m/library","sap/m/Text","sap/m/Button"],function(e,t,o,i,a,r,s,n,l,d,p,g){"use strict";var c,u;var f=d.DialogType;var h=d.ButtonType;return e.extend("cp.appf.cpsaleshconfig.controller.Home",{onInit:function(){var e=this;c=this;c.deletedArray=[];c.oGModel=c.getOwnerComponent().getModel("oGModel");c.oListModel=new i;this.locModel=new i;this.prodModel=new i;this.variantModel=new i;c.variantHeaderModel=new i;this.oListModel.setSizeLimit(5e3);c.locModel.setSizeLimit(1e3);c.prodModel.setSizeLimit(1e3);c.variantModel.setSizeLimit(5e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._nameFragment){this._nameFragment=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.NameVariant",this);this.getView().addDependent(this._nameFragment)}if(!this._popOver){this._popOver=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.PopOver",this);this.getView().addDependent(this._popOver)}if(!this._manageVariant){this._manageVariant=sap.ui.xmlfragment("cp.appf.cpsaleshconfig.view.VariantNames",this);this.getView().addDependent(this._manageVariant)}},onAfterRendering:function(){c=this;c.oList=this.byId("idTab");this.oProd=this.byId("prodInput");c._valueHelpDialogLoc.setTitleAlignment("Center");c._valueHelpDialogProd.setTitleAlignment("Center");this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");c.oList.removeSelections();if(c.oList.getBinding("items")){c.oList.getBinding("items").filter([])}this.getData()},getData:function(){var e=[];var o=[];var i={};var a=[];this.getModel("BModel").read("/getLocation",{success:function(e){c.locModel.setData(e);c.oLocList.setModel(c.locModel);sap.ui.core.BusyIndicator.hide()},error:function(e,o){t.show("error")}})},onDropDownPress:function(e){if(e.getSource().getPressed()){this._popOver.openBy(e.getSource())}else{this._popOver.close()}},handleValueHelp:function(e){var o=e.getParameter("id");if(o.includes("loc")){c._valueHelpDialogLoc.open()}else if(o.includes("prod")){if(c.byId("idloc").getValue()!==""){c._valueHelpDialogProd.open()}else{t.show("Select Location")}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){c._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(c.oLocList.getBinding("items")){c.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){c._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(c.oProdList.getBinding("items")){c.oProdList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=e.getParameter("id"),i=[];t=t?t.trim():"";if(o.includes("loc")){if(t!==""){i.push(new a({filters:[new a("LOCATION_ID",r.Contains,t),new a("LOCATION_DESC",r.Contains,t)],and:false}))}c.oLocList.getBinding("items").filter(i)}else if(o.includes("prod")){if(t!==""){i.push(new a({filters:[new a("PRODUCT_ID",r.Contains,t),new a("PROD_DESC",r.Contains,t)],and:false}))}c.oProdList.getBinding("items").filter(i)}else if(o.includes("var")){if(t!==""){i.push(new a({filters:[new a("VARIANTNAME",r.Contains,t),new a("APPLICATION_NAME",r.Contains,t)],and:false}))}sap.ui.getCore().byId("varSlctList").getBinding("items").filter(i)}},handleSelection:function(e){var o=e.getParameter("id"),i=e.getParameter("selectedItems"),s,n=[];if(o.includes("Loc")){this.oLoc=c.byId("idloc");s=e.getParameter("selectedItems");c.oLoc.setValue(s[0].getTitle());c.oProd.removeAllTokens();this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].removeSelections();this.getModel("BModel").read("/getLocProdDet",{filters:[new a("LOCATION_ID",r.EQ,s[0].getTitle())],success:function(e){c.prodModel.setData(e);c.oProdList.setModel(c.prodModel)},error:function(e,o){t.show("error")}})}else if(o.includes("prod")){this.oProd=c.byId("prodInput");s=e.getParameter("selectedItems");if(s&&s.length>0){c.oProd.removeAllTokens();s.forEach(function(e){c.oProd.addToken(new sap.m.Token({key:e.getTitle(),text:e.getTitle()}))})}else{c.oProd.removeAllTokens()}}c.handleClose(e)},onGetData:function(e){var o=new Date(c.byId("idDate").getValue()),i,a;if(c.byId("idloc").getValue()!==""&&c.oProdList.getSelectedItems().length!==0){var r=c.oProdList.getSelectedItems();var s=[];if(c.byId("idDate").getValue()!==""){i=o.getMonth()+1;if(i<10){i="0"+i}else{i=i}if(o.getDate<10){a="0"+o.getDate()}else{a=o.getDate()}var n=o.getFullYear()+"-"+i+"-"+a;var l=new sap.ui.model.Filter({path:"DOC_CREATEDDATE",operator:sap.ui.model.FilterOperator.EQ,value1:n});s.push(l)}var l=new sap.ui.model.Filter({path:"LOCATION_ID",operator:sap.ui.model.FilterOperator.EQ,value1:c.oLoc.getValue()});s.push(l);for(var d=0;d<r.length;d++){if(r[d].getTitle()!=="All"){l=new sap.ui.model.Filter({path:"PRODUCT_ID",operator:sap.ui.model.FilterOperator.EQ,value1:r[d].getTitle()});s.push(l)}}sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getSalesh",{filters:s,success:function(e){c.oListModel.setData({results:e.results});c.oList.setModel(c.oListModel);sap.ui.core.BusyIndicator.hide()},error:function(e){t.show("error");sap.ui.core.BusyIndicator.hide()}})}else{t.show("Please fill all required inputs")}},onhandlePress:function(e){c.oGModel=c.getModel("oGModel");var t=c.byId("idTab").getSelectedItem().getBindingContext().getObject();c.oGModel.setProperty("/selItem",t);c.oGModel.setProperty("/sSalOrd",t.SALES_DOC);c.oGModel.setProperty("/sSalOrdItem",t.SALESDOC_ITEM);c.oGModel.setProperty("/sPrdid",t.PRODUCT_ID);c.oGModel.setProperty("/sLocid",t.LOCATION_ID);c.oGModel.setProperty("/date",e.getSource().getSelectedItem().getCells()[2].getText());var o=sap.ui.core.UIComponent.getRouterFor(c);o.navTo("Detail",{},true)},onTableSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),o=[];if(t!==""){o.push(new a({filters:[new a("SALES_DOC",r.Contains,t),new a("PRODUCT_ID",r.Contains,t),new a("LOCATION_ID",r.Contains,t)],and:false}))}c.oList.getBinding("items").filter(o)},onNavPress:function(){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var e=sap.ushell.Container.getService("CrossApplicationNavigation");var t=e&&e.hrefForExternal({target:{semanticObject:"vcpdocdisplay",action:"Display"}})||"";var o=window.location.href.split("#")[0]+t;sap.m.URLHelper.redirect(o,true)}},onVariantSave:function(){c.byId("idDropDown").setPressed(false);c._popOver.close();c._nameFragment.open();sap.ui.getCore().byId("idInput").setValue()},onSaveClose:function(){c._nameFragment.close()},onCreate:function(e){c.byId("idDropDown").setPressed(false);var o={RTRCHAR:[]};var i=[];var a={};var r=c.byId("idloc").getValue();var s=c.byId("idloc").getParent().getItems()[0].getText();var n=c.byId("prodInput").getTokens();var l=c.byId("prodInput").getParent().getItems()[0].getText();var d=sap.ui.getCore().byId("idInput").getValue();var p=sap.ui.getCore().byId("_IDGenCheckBox2").getSelected();if(p){var g="Public"}else{var g="Private"}var u=sap.ui.getCore().byId("_IDGenCheckBox1").getSelected();if(u&&c.oGModel.getProperty("/defaultDetails").length>0){var f="Y";c.getModel("BModel").callFunction("/updateVariant",{method:"GET",urlParameters:{VARDATA:JSON.stringify(c.oGModel.getProperty("/defaultDetails"))},success:function(e){t.show(e)},error:function(e){t.show("Failed to create variant")}})}else{var f="N"}a={Field:s,FieldCenter:1..toString(),Value:r,Scope:g,Default:f};i.push(a);for(var h=0;h<n.length;h++){a={Field:l,FieldCenter:(h+1).toString(),Value:n[h].getText(),Scope:g,Default:f};i.push(a)}for(var v=0;v<i.length;v++){var m=c.oGModel.getProperty("/Id");if(m===undefined){m=0}m=m+1;i[v].ID=m;i[v].IDNAME=d;i[v].App_Name="Sales History Configuration"}c.getModel("BModel").callFunction("/createVariant",{method:"GET",urlParameters:{Flag:"X",VARDATA:JSON.stringify(i)},success:function(e){t.show(e.createVariant);sap.ui.getCore().byId("_IDGenCheckBox2").setSelected(false);sap.ui.getCore().byId("_IDGenCheckBox1").setSelected(false);sap.ui.getCore().byId("idInput").setValue();c._nameFragment.close();c.onAfterRendering()},error:function(e){t.show("Failed to create variant")}})},handleSelectPress:function(e){var o,i={},s=[];var n=c.oGModel.getProperty("/variantDetails");if(c.oGModel.getProperty("/fromFunction")==="X"){c.oGModel.setProperty("/fromFunction","");var l=e;c.byId("idVariantName").setText(l);c.oGModel.setProperty("/variantName",l)}else{var l=e.getSource().getTitle();c.byId("idVariantName").setText(l);c.oGModel.setProperty("/variantName",l)}if(l!=="Standard"){for(var d=0;d<n.length;d++){if(l===n[d].VARIANTNAME){if(n[d].FIELD.includes("Loc")){o=n[d].VALUE}else if(n[d].FIELD.includes("Prod")){var p=new sap.m.Token({key:d,text:n[d].VALUE});s.push(p);p={}}}}c.byId("idloc").setValue(o);this.getModel("BModel").read("/getLocProdDet",{filters:[new a("LOCATION_ID",r.EQ,o)],success:function(e){c.prodModel.setData(e);c.oProdList.setModel(c.prodModel);c.oProdList.removeSelections();for(var t=0;t<s.length;t++){for(var o=0;o<c.oProdList.getItems().length;o++){if(c.oProdList.getItems()[o].getTitle()===s[t].getText()){c.oProdList.getItems()[o].setSelected(true)}}}},error:function(e,o){t.show("error")}});c._popOver.close();c.byId("prodInput").setTokens(s);c.byId("idDropDown").setPressed(false)}else{c.byId("idDropDown").setPressed(false);c.byId("prodInput").removeAllTokens();c.oProdList.removeSelections();c.byId("idloc").setValue("");c._popOver.close()}},onManageOpen:function(e){c.byId("idDropDown").setPressed(false);c._manageVariant.open()},handleManageClose:function(){c._manageVariant.close()},onViewDelete:function(e){var o={};var i=[];var a=parseInt(e.getParameters().listItem.getCells()[4].getText());var r=e.getParameters().listItem.getCells()[0].getText();var s=e.getParameters().listItem;var n=e.getSource();o={ID:a,NAME:r};i.push(o);o={};if(!this.oApproveDialog){this.oApproveDialog=new l({type:f.Message,title:r,content:new p({text:"Do you want to delete this View?"}),beginButton:new g({type:h.Emphasized,text:"Submit",press:function(){c.getModel("BModel").callFunction("/createVariant",{method:"GET",urlParameters:{Flag:"D",VARDATA:JSON.stringify(i)},success:function(e){t.show(e.createVariant);n.removeItem(s);c.oApproveDialog.close();c.onAfterRendering()},error:function(e){t.show("Failed to create variant")}})}.bind(this)}),endButton:new g({text:"Cancel",press:function(){this.oApproveDialog.close()}.bind(this)})})}this.oApproveDialog.open()},onManage:function(){var e=c.deletedArray;var t=c.oGModel.getProperty("/variantHeader")}})});