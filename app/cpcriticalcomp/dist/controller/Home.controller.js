sap.ui.define(["cpapp/cpcriticalcomp/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/Device"],function(e,t,i,o,s,a,l){"use strict";var r,n;return e.extend("cpapp.cpcriticalcomp.controller.Home",{onInit:function(){r=this;r.oModel=new i;this.locModel=new i;this.prodModel=new i;r.locModel.setSizeLimit(1e3);r.prodModel.setSizeLimit(1e3);this.oModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cpapp.cpcriticalcomp.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cpapp.cpcriticalcomp.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}},onAfterRendering:function(){r=this;r.oLoc=this.byId("idloc");this.oProd=this.byId("prodInput");r._valueHelpDialogLoc.setTitleAlignment("Center");r._valueHelpDialogProd.setTitleAlignment("Center");this.oProdList=sap.ui.getCore().byId("prodSlctList");this.oLocList=sap.ui.getCore().byId("LocSlctList");this.oLoc=this.byId("idloc");this.oProd=this.byId("prodInput");n=this.getModel("oGModel");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){sap.ui.core.BusyIndicator.hide();r.locModel.setData(e);r.oLocList.setModel(r.locModel)},error:function(e,i){sap.ui.core.BusyIndicator.hide();t.show("error")}})},handleValueHelp:function(e){var i=e.getParameter("id");if(i.includes("loc")){r._valueHelpDialogLoc.open()}else if(i.includes("prod")){if(r.byId("idloc").getValue()!==""){r._valueHelpDialogProd.open()}else{t.show("Select Location")}}},handleClose:function(e){var t=e.getSource().getParent().mAssociations.initialFocus.split("-")[0];if(t.includes("Loc")){sap.ui.getCore().byId("LocSearch").setValue("");if(r.oLocList.getBinding("items")){r.oLocList.getBinding("items").filter([])}sap.ui.getCore().byId("LocSlctList").removeSelections();r._valueHelpDialogLoc.close()}else if(t.includes("Prod")){sap.ui.getCore().byId("ProdSearch").setValue("");if(r.oProdList.getBinding("items")){r.oProdList.getBinding("items").filter([])}sap.ui.getCore().byId("prodSlctList").removeSelections();r._valueHelpDialogProd.close()}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),i=e.getParameter("id"),a=[];t=t?t.trim():"";if(i.includes("Loc")){if(t!==""){a.push(new o({filters:[new o("LOCATION_ID",s.Contains,t),new o("LOCATION_DESC",s.Contains,t)],and:false}))}r.oLocList.getBinding("items").filter(a)}else if(i.includes("Prod")){if(t!==""){a.push(new o({filters:[new o("PRODUCT_ID",s.Contains,t),new o("PROD_DESC",s.Contains,t)],and:false}))}r.oProdList.getBinding("items").filter(a)}},handleSelection:function(e){var i=e.getParameter("id"),a;this.oLoc=r.byId("idloc");this.oProd=r.byId("prodInput");if(i.includes("Loc")){a=e.getParameter("selectedItems");r.oLoc.setValue(e.getParameters().listItem.getCells()[0].getTitle());r.oProd.setValue();sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocProdDet",{filters:[new o("LOCATION_ID",s.EQ,e.getParameters().listItem.getCells()[0].getTitle())],success:function(e){sap.ui.core.BusyIndicator.hide();r.prodModel.setData(e);r.oProdList.setModel(r.prodModel)},error:function(e,i){sap.ui.core.BusyIndicator.hide();t.show("error")}})}else if(i.includes("prod")){a=e.getParameter("selectedItems");r.oProd.setValue(e.getParameters().listItem.getCells()[0].getTitle())}r.handleClose(e)},onGetData:function(e){var a=r.oLoc.getValue(),l=r.oProd.getValue();var n=[];n.push(new o({filters:[new o("LOCATION_ID",s.EQ,a),new o("PRODUCT_ID",s.EQ,l)],and:true}));if(a!==""&&l!==""){this.byId("idCompSearch").setValue("");if(r.byId("idCriticalComp").getItems().length){r.byId("idCriticalComp").getBinding("items").filter(n)}sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getCriticalComp",{filters:[n],success:function(e){sap.ui.core.BusyIndicator.hide();r.oModel=new i;if(e.results.length){r.oModel.setData({results:e.results});r.byId("idCriticalComp").setModel(r.oModel)}else{r.oModel.setData({results:[]});r.byId("idCriticalComp").setModel(r.oModel);t.show("No data for the selected Location Product")}},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})}else{t.show("Please select Location and Product")}},onSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),i=[];if(t!==""){i.push(new o({filters:[new o("ITEM_NUM",s.Contains,t),new o("COMPONENT",s.Contains,t)],and:false}))}r.byId("idCriticalComp").getBinding("items").filter(i)},onChange:function(e){sap.ui.core.BusyIndicator.show();var i=e.getSource().getBindingContext().getObject();var o;var s={criticalComp:[]},a;if(i.CRITICALKEY==="X"){o=""}else{o="X"}a={LOCATION_ID:i.LOCATION_ID,PRODUCT_ID:i.PRODUCT_ID,ITEM_NUM:i.ITEM_NUM,COMPONENT:i.COMPONENT,CRITICALKEY:o};s.criticalComp.push(a);r.getModel("BModel").callFunction("/changeToCritical",{method:"GET",urlParameters:{criticalComp:JSON.stringify(s.criticalComp)},success:function(e){sap.ui.core.BusyIndicator.hide();t.show(e.changeToCritical);r.onGetData()},error:function(e){sap.ui.core.BusyIndicator.hide();t.show("Failed to changes the status")}})},onNavPress:function(){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var e=sap.ushell.Container.getService("CrossApplicationNavigation");var t=e&&e.hrefForExternal({target:{semanticObject:"vcpdocdisplay",action:"Display"}})||"";var i=window.location.href.split("#")[0]+t;sap.m.URLHelper.redirect(i,true)}}})});