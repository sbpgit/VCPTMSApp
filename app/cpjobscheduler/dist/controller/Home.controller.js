sap.ui.define(["cpapp/cpjobscheduler/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger","sap/m/MessageToast","sap/ui/Device"],function(e,t,o,a,s,l){"use strict";var i,d;return e.extend("cpapp.cpjobscheduler.controller.Prediction",{onInit:function(){i=this;this.listModel=new t;this.JobLogsModel=new t;this.JobDataModel=new t;this.listModel.setSizeLimit(2e3);this.JobLogsModel.setSizeLimit(1e3);this.JobDataModel.setSizeLimit(1e3);if(!this._valueHelpDialogJobData){this._valueHelpDialogJobData=sap.ui.xmlfragment("cpapp.cpjobscheduler.view.JobData",this);this.getView().addDependent(this._valueHelpDialogJobData)}},onAfterRendering:function(){d=this.getModel("oGModel");i.oList=i.byId("jobList");var e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-15);this.byId("idDateRange").setDateValue(t);this.byId("idDateRange").setSecondDateValue(e);i.byId("JobPanel").setExpanded(true);i.byId("jobDetailsPanel").setExpanded(false);i.getModel("JModel").callFunction("/lreadJobs",{method:"GET",success:function(e){i.listModel.setData({results:e.lreadJobs.value});i.oList.setModel(i.listModel)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onCreateJob:function(e){var t=sap.ui.core.UIComponent.getRouterFor(i);t.navTo("CreateJob",{},true)},onOpenJob:function(e){var t=sap.ui.core.UIComponent.getRouterFor(i);t.navTo("OpenJob",{},true)},handleDateChange:function(e){var t=e.getParameters().newValue;t=t.split(" To ");var o=t[0],a=t[0];i.getModel("JModel").callFunction("/lreadJobs",{method:"GET",urlParameters:{startTime:o,endTime:a},success:function(e){i.listModel.setData({results:e.results});i.oList.setModel(i.listModel)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onJobLogs:function(e){d=this.getModel("oGModel");var t=e.getSource().getParent().getCells()[0].getTitle();d.setProperty("/SelJob",t);i.getModel("JModel").callFunction("/lreadJobSchedules",{method:"GET",urlParameters:{jobId:t},success:function(e){d.setProperty("/scheduleId",e.lreadJobSchedules.value[0].scheduleId);i.JobDetails()},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onhandlePress:function(e){d=this.getModel("oGModel");var t=e.getParameter("listItem").getCells()[0].getTitle();i.getModel("JModel").callFunction("/lreadJobDetails",{method:"GET",urlParameters:{jobId:t,displaySchedules:true},success:function(e){var t=e.lreadJobDetails.value.schedules;i.JobLogsModel.setData({results:t});i.byId("idJobLogs").setModel(i.JobLogsModel);var o=e.lreadJobDetails.value.schedules[0].data;o=$.parseJSON(o);d.setProperty("/aJobDetails",o);i.byId("JobPanel").setExpanded(false);i.byId("jobDetailsPanel").setExpanded(true)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onScheData:function(){var e=d.getProperty("/aJobDetails").vcRulesList;i.JobDataModel.setData({results:e});sap.ui.getCore().byId("idJobData").setModel(i.JobDataModel);i._valueHelpDialogJobData.open()},onjobClose:function(){i._valueHelpDialogJobData.close()}})});