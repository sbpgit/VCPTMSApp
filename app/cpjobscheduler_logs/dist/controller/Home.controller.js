sap.ui.define(["cpapp/cpjobschedulerlogs/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,l,a,i){"use strict";var r,o;return e.extend("cpapp.cpjobschedulerlogs.controller.Home",{onInit:function(){r=this;this.listModel=new t;this.listModel.setSizeLimit(2e3)},onAfterRendering:function(){o=this.getModel("oGModel");r.oList=r.byId("joblogList");var e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-15);this.byId("idDateRange").setDateValue(t);this.byId("idDateRange").setSecondDateValue(e);r.handleDateChange()},handleDateChange:function(){var e=r.byId("idDateRange").getValue().split("To");var t=e[0].trim()+" "+"00:00:00",l=e[1].trim()+" "+"23:59:59";var a=[];var i=new sap.ui.model.Filter({path:"COMPLETED_TIMESTAMP",operator:sap.ui.model.FilterOperator.BT,value1:t,value2:l});a.push(i);sap.ui.core.BusyIndicator.show();r.getModel("JModel").read("/getJobStatus",{filters:a,success:function(e){sap.ui.core.BusyIndicator.hide();e.results.forEach(function(e){e.JOB_ID=e.JOB_ID.toString();if(e.RUN_STATE==="REQUEST_ERROR"){e.RUN_STATE="ERROR"}},r);r.listModel.setData({results:e.results});r.oList.setModel(r.listModel)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onUpdateFinished:function(){var e=r.getView().byId("joblogList");var t=e.getItems();var s;for(var l=0;l<t.length;l++){s=t[l].getCells();s[6].removeStyleClass("listGreen");s[6].removeStyleClass("listOrange");s[7].removeStyleClass("listGreen");s[7].removeStyleClass("listRed");s[7].removeStyleClass("listGray");if(s[6].getText().includes("COMPL")){s[6].addStyleClass("listGreen")}else if(s[6].getText().includes("RUN")){s[6].addStyleClass("listOrange")}if(s[7].getText().includes("SUCCESS")){s[7].addStyleClass("listGreen")}else if(s[7].getText().includes("ERROR")){s[7].addStyleClass("listRed")}else{s[7].addStyleClass("listGray")}}},onSearch:function(e){var t=r.getView().byId("headSearch").getValue(),s=r.getView().byId("idFilter").getSelectedIndex(),l=[];var o=[];if(t!==""){var l=new a({filters:[new a("JOB_ID",i.Contains,t),new a("JOB_NAME",i.Contains,t)],and:false});o.push(l)}if(s===0){}else if(s===1){l=new a({filters:[new a("RUN_STATE",sap.ui.model.FilterOperator.EQ,"ERROR")],and:true});o.push(l)}else if(s===2){l=new a({filters:[new a("RUN_STATE",sap.ui.model.FilterOperator.EQ,"SUCCESS")],and:false});o.push(l)}r.byId("joblogList").getBinding("items").filter(o)}})});