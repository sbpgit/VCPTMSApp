sap.ui.define(["cpapp/cpjobschedulerlogs/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,a,l,i){"use strict";var o,r;return e.extend("cpapp.cpjobschedulerlogs.controller.Home",{onInit:function(){o=this;this.listModel=new t;this.listModel.setSizeLimit(2e3)},onAfterRendering:function(){r=this.getModel("oGModel");o.oList=o.byId("joblogList");var e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-15);this.byId("idDateRange").setDateValue(t);this.byId("idDateRange").setSecondDateValue(e);o.handleDateChange()},handleDateChange:function(){var e=o.byId("idDateRange").getDateValue(),t=o.byId("idDateRange").getSecondDateValue();e=e.toISOString().split("T")[0]+" "+"00:00:00";t=t.toISOString().split("T")[0]+" "+"23:59:59";var a=[];var l=new sap.ui.model.Filter({path:"COMPLETED_TIMESTAMP",operator:sap.ui.model.FilterOperator.BT,value1:e,value2:t});a.push(l);sap.ui.core.BusyIndicator.show();o.getModel("JModel").read("/getJobStatus",{filters:a,success:function(e){sap.ui.core.BusyIndicator.hide();e.results.forEach(function(e){e.JOB_ID=e.JOB_ID.toString();if(e.RUN_STATE==="REQUEST_ERROR"){e.RUN_STATE="ERROR"}},o);o.listModel.setData({results:e.results});o.oList.setModel(o.listModel)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onUpdateFinished:function(){var e=o.getView().byId("joblogList");var t=e.getItems();var s;for(var a=0;a<t.length;a++){s=t[a].getCells();s[6].removeStyleClass("listGreen");s[6].removeStyleClass("listOrange");s[7].removeStyleClass("listGreen");s[7].removeStyleClass("listRed");s[7].removeStyleClass("listGray");if(s[6].getText().includes("COMPL")){s[6].addStyleClass("listGreen")}else if(s[6].getText().includes("RUN")){s[6].addStyleClass("listOrange")}if(s[7].getText().includes("SUCCESS")){s[7].addStyleClass("listGreen")}else if(s[7].getText().includes("ERROR")){s[7].addStyleClass("listRed")}else{s[7].addStyleClass("listGray")}}},onSearch:function(e){var t=o.getView().byId("headSearch").getValue(),s=o.getView().byId("idFilter").getSelectedIndex(),a=[];var r=[];if(t!==""){var a=new l({filters:[new l("JOB_ID",i.Contains,t),new l("JOB_NAME",i.Contains,t)],and:false});r.push(a)}if(s===0){}else if(s===1){a=new l({filters:[new l("RUN_STATE",sap.ui.model.FilterOperator.EQ,"ERROR")],and:true});r.push(a)}else if(s===2){a=new l({filters:[new l("RUN_STATE",sap.ui.model.FilterOperator.EQ,"SUCCESS")],and:false});r.push(a)}o.byId("joblogList").getBinding("items").filter(r)}})});