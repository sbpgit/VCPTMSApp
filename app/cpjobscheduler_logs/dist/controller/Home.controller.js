sap.ui.define(["cpapp/cpjobschedulerlogs/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,a,i,l){"use strict";var n,o;return e.extend("cpapp.cpjobschedulerlogs.controller.Home",{onInit:function(){n=this;this.listModel=new t;this.listModel.setSizeLimit(2e3)},onAfterRendering:function(){o=this.getModel("oGModel");n.oList=n.byId("joblogList");var e=new Date;var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-15);this.byId("idDateRange").setDateValue(t);this.byId("idDateRange").setSecondDateValue(e);n.handleDateChange()},handleDateChange:function(){var e=n.byId("idDateRange").getDateValue(),t=n.byId("idDateRange").getSecondDateValue(),a=(new Date).getTimezoneOffset();e=new Date(e.setTime(e.getTime()-a*60*1e3));t=new Date(t.setTime(t.getTime()-a*60*1e3));e=e.toISOString().split("T")[0]+" "+"00:00:00";t=t.toISOString().split("T")[0]+" "+"23:59:59";var i=[];var l=new sap.ui.model.Filter({path:"COMPLETED_TIMESTAMP",operator:sap.ui.model.FilterOperator.BT,value1:e,value2:t});i.push(l);sap.ui.core.BusyIndicator.show();n.getModel("JModel").read("/getJobStatus",{filters:i,success:function(e){sap.ui.core.BusyIndicator.hide();e.results.forEach(function(e){e.JOB_ID=e.JOB_ID.toString();if(e.RUN_STATE==="REQUEST_ERROR"){e.RUN_STATE="ERROR"}},n);n.listModel.setData({results:e.results});n.oList.setModel(n.listModel)},error:function(e){sap.ui.core.BusyIndicator.hide();s.show("Failed to get data")}})},onUpdateFinished:function(){var e=n.getView().byId("joblogList");var t=e.getItems();var s;for(var a=0;a<t.length;a++){s=t[a].getCells();s[6].removeStyleClass("listGreen");s[6].removeStyleClass("listOrange");s[7].removeStyleClass("listGreen");s[7].removeStyleClass("listRed");s[7].removeStyleClass("listGray");if(s[6].getText().includes("COMPL")){s[6].addStyleClass("listGreen")}else if(s[6].getText().includes("RUN")){s[6].addStyleClass("listOrange")}if(s[7].getText().includes("SUCCESS")){s[7].addStyleClass("listGreen")}else if(s[7].getText().includes("ERROR")){s[7].addStyleClass("listRed")}else{s[7].addStyleClass("listGray")}}},onSearch:function(e){var t=n.getView().byId("headSearch").getValue(),s=n.getView().byId("idFilter").getSelectedIndex(),a=[];var o=[];if(t!==""){var a=new i({filters:[new i("JOB_ID",l.Contains,t),new i("JOB_NAME",l.Contains,t)],and:false});o.push(a)}if(s===0){}else if(s===1){a=new i({filters:[new i("RUN_STATE",sap.ui.model.FilterOperator.EQ,"ERROR")],and:true});o.push(a)}else if(s===2){a=new i({filters:[new i("RUN_STATE",sap.ui.model.FilterOperator.EQ,"SUCCESS")],and:false});o.push(a)}n.byId("joblogList").getBinding("items").filter(o)}})});