sap.ui.define(["cpapp/cpmatvariant/controller/BaseController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","cpapp/cpmatvariant/model/formatter"],function(e,a,t,s,i,r,l,o,n){"use strict";var d,u;return e.extend("cpapp.cpmatvariant.controller.ItemDetail",{onInit:function(){d=this;this.bus=sap.ui.getCore().getEventBus();d.oCharModel=new s;this.oCharModel.setSizeLimit(1e3);d.charnameModel=new s;d.charvalueModel=new s},onAfterRendering:function(){u=d.getOwnerComponent().getModel("oGModel");sap.ui.core.BusyIndicator.show();var e=u.getProperty("/prdId");var t=u.getProperty("/locId");var s=u.getProperty("/uniqId");var l=u.getProperty("/uid_active");var o=d.byId("idadd");this.getModel("BModel").read("/getUniqueItem",{filters:[new i("LOCATION_ID",r.EQ,t),new i("PRODUCT_ID",r.EQ,e),new i("UNIQUE_ID",r.EQ,s)],success:function(e){sap.ui.core.BusyIndicator.hide();if(e.results.length===0){o.setProperty("visible",true)}else{o.setProperty("visible",false)}u.setProperty("/CharData",e.results);d.oCharModel.setData({results:e.results});d.byId("idMatvarItem").setModel(d.oCharModel)},error:function(){a.show("Failed to get data")}})},onCharSearch:function(e){var a="",t=[];if(e){a=e.getParameter("value")||e.getParameter("newValue")}if(a!==""){t.push(new i({filters:[new i("CHAR_NAME",r.Contains,a),new i("CHAR_VALUE",r.Contains,a)],and:false}))}d.byId("idMatvarItem").getBinding("items").filter(t)},onAddPress:function(){if(!this._addCharacteristic){this._addCharacteristic=sap.ui.xmlfragment("cpapp.cpmatvariant.view.AddCharacterstics",this);this.getView().addDependent(this._addCharacteristic)}this._addCharacteristic.open();sap.ui.getCore().byId("iduinq2").setValue(u.getProperty("/uniqId"))},handleValueHelp:function(e){if(!this._valueHelpDialogcharName){this._valueHelpDialogcharName=sap.ui.xmlfragment("cpapp.cpmatvariant.view.charName",this);this.getView().addDependent(this._valueHelpDialogcharName)}if(!this._valueHelpDialogcharValue){this._valueHelpDialogcharValue=sap.ui.xmlfragment("cpapp.cpmatvariant.view.charValue",this);this.getView().addDependent(this._valueHelpDialogcharValue)}if(!this._valueHelpDialogclassName){this._valueHelpDialogclassName=sap.ui.xmlfragment("cpapp.cpmatvariant.view.className",this);this.getView().addDependent(this._valueHelpDialogclassName)}var t=e.getParameter("id");var l=u.getProperty("/prdId");var o=u.getProperty("/locId");if(t.includes("Classname")){d.getModel("BModel").read("/getProdClass",{filters:[new i("PRODUCT_ID",r.Contains,l),new i("LOCATION_ID",r.Contains,o)],success:function(e){sap.ui.core.BusyIndicator.hide();d.classNameData=e.results;var a=new s;a.setData({results:d.classNameData});sap.ui.getCore().byId("classNameList").setModel(a);d._valueHelpDialogclassName.open()},error:function(){sap.ui.core.BusyIndicator.hide();a.show("Failed to get class name data")}})}else if(t.includes("Charname")){if(sap.ui.getCore().byId("idClassname2").getValue()){d._valueHelpDialogcharName.open()}else{a.show("Select Class Name")}}else if(t.includes("Charval")){if(sap.ui.getCore().byId("idCharname2").getValue()){d._valueHelpDialogcharValue.open()}else{a.show("Select Class Name and Characteristic Name")}}},handleSelection:function(e){d.oGModel=d.getModel("oGModel");var t=e.getParameter("id"),s=e.getParameter("selectedItems"),l,o=[];if(t.includes("className")){d.oClassName=sap.ui.getCore().byId("idClassname2");l=e.getParameter("selectedItems");d.oClassName.setValue(l[0].getTitle());u.setProperty("/UID_Rate",l[0].getBindingContext().getProperty().CLASS_NUM);sap.ui.getCore().byId("idCharname2").setValue("");sap.ui.getCore().byId("idCharval2").setValue("");this.getModel("BModel").read("/getClassChar",{filters:[new i("CLASS_NUM",r.EQ,l[0].getBindingContext().getProperty().CLASS_NUM)],success:function(e){sap.ui.core.BusyIndicator.hide();function a(e,a){var t=new Set;return e.filter(e=>!t.has(e[a])&&t.add(e[a]))}d.charnameModel.setData({results:a(e.results,"CHAR_NAME")});sap.ui.getCore().byId("charNameList").setModel(d.charnameModel)},error:function(e,t){sap.ui.core.BusyIndicator.hide();a.show("error")}})}else if(t.includes("charName")){d.oCharName=sap.ui.getCore().byId("idCharname2");l=e.getParameter("selectedItems");d.oCharName.setValue(l[0].getTitle());u.setProperty("/Char_Num",l[0].getDescription());sap.ui.getCore().byId("idCharval2").setValue("");this.getModel("BModel").read("/getClassChar",{filters:[new i("CLASS_NUM",r.EQ,l[0].getBindingContext().getProperty().CLASS_NUM),new i("CHAR_NAME",r.EQ,sap.ui.getCore().byId("idCharname2").getValue())],success:function(e){sap.ui.core.BusyIndicator.hide();function a(e,a){var t=new Set;return e.filter(e=>!t.has(e[a])&&t.add(e[a]))}d.charvalueModel.setData({results:a(e.results,"CHAR_VALUE")});sap.ui.getCore().byId("charValList").setModel(d.charvalueModel)},error:function(e,t){sap.ui.core.BusyIndicator.hide();a.show("error")}})}else if(t.includes("charVal")){d.oCharVal=sap.ui.getCore().byId("idCharval2");l=e.getParameter("selectedItems");d.oCharVal.setValue(l[0].getTitle());u.setProperty("/CharVal_Num",l[0].getDescription())}},handleSearch:function(e){var a=e.getParameter("value")||e.getParameter("newValue"),t=e.getParameter("id"),s=[];a=a?a.trim():"";if(t.includes("className")){if(a!==""){s.push(new i({filters:[new i("CLASS_NAME",r.Contains,a)],and:false}))}d.oClassnameList=sap.ui.getCore().byId("classNameList");d.oClassnameList.getBinding("items").filter(s)}else if(t.includes("charName")){if(a!==""){s.push(new i({filters:[new i("CHAR_NAME",r.Contains,a)],and:false}))}d.oCharnameList=sap.ui.getCore().byId("charNameList");d.oCharnameList.getBinding("items").filter(s)}else if(t.includes("charVal")){if(a!==""){s.push(new i({filters:[new i("CHAR_VALUE",r.Contains,a)],and:false}))}d.oCharvalueList=sap.ui.getCore().byId("charValList");d.oCharvalueList.getBinding("items").filter(s)}},handleClose:function(e){var a=e.getParameter("id");if(a.includes("className")){d._oCore.byId(this._valueHelpDialogclassName.getId()+"-searchField").setValue("");if(d.oClassnameList.getBinding("items")){d.oClassnameList.getBinding("items").filter([])}}else if(a.includes("charName")){d._oCore.byId(this._valueHelpDialogcharName.getId()+"-searchField").setValue("");if(d.oCharnameList.getBinding("items")){d.oCharnameList.getBinding("items").filter([])}}else if(a.includes("charVal")){d._oCore.byId(this._valueHelpDialogcharValue.getId()+"-searchField").setValue("");if(d.oCharvalueList.getBinding("items")){d.oCharvalueList.getBinding("items").filter([])}}},onCloseRestItem:function(){sap.ui.getCore().byId("idClassname2").setValue("");sap.ui.getCore().byId("idCharname2").setValue("");sap.ui.getCore().byId("idCharval2").setValue("");d._addCharacteristic.close()},onUpdateItem:function(){var e="N",a=u.getProperty("/locId"),t=u.getProperty("/prdId"),s=sap.ui.getCore().byId("iduinq2").getValue(),i=u.getProperty("/uniqId"),r=u.getProperty("/Char_Num"),l=u.getProperty("/CharVal_Num");var o;var n={RTRCHAR:[]};o={LOCATION_ID:a,PRODUCT_ID:t,UNIQUE_ID:s,CHAR_NUM:r,CHARVAL_NUM:l};n.RTRCHAR.push(o);sap.ui.core.BusyIndicator.show();d.getModel("BModel").callFunction("/maintainUniqueChar",{method:"GET",urlParameters:{FLAG:e,UNIQUECHAR:JSON.stringify(n.RTRCHAR)},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show(e.maintainUniqueChar);d.onAfterRendering();d.onCloseRestItem()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error")}})},onAdd:function(){var e=sap.ui.getCore().byId("idCharname2").getValue(),t=u.getProperty("/Char_Num"),i=sap.ui.getCore().byId("idCharval2").getValue(),r=u.getProperty("/CharVal_Num"),l=sap.ui.getCore().byId("idClassname2").getValue();if(e!==""&&i!==""&&l!==""){this.oData={CLASS_NAME:l,CHAR_NAME:e,CHAR_NUM:t,CHAR_VALUE:i,CHARVAL_NUM:r,OFLAG:"X"};var o=this.byId("idMatvarItem").getItems();var n=0;for(var c=0;c<o.length;c++){if(o[c].getCells()[1].getText()===t&&o[c].getCells()[3].getText()===r){n=n+1}}if(n===0){d.oTableData=[];d.oTableData.push(d.oData);d.ListModel=new s;d.ListModel.setData({results:d.oTableData});d.byId("idMatvarItem").setModel(d.ListModel);d._addCharacteristic.close();d.byId("idUpdateSave").setVisible(true)}else{sap.m.MessageToast.show("Characterstic is already maintained")}}else{a.show("Please fill all inputs")}},onDelete:function(e){var a="D",t=u.getProperty("/locId"),s=u.getProperty("/prdId"),i=u.getProperty("/uniqId"),r=e.getParameters().listItem.getCells()[1].getText();var l;var o={RTRCHAR:[]};l={LOCATION_ID:t,PRODUCT_ID:s,UNIQUE_ID:i,CHAR_NUM:r};o.RTRCHAR.push(l);sap.ui.core.BusyIndicator.show();d.getModel("BModel").callFunction("/maintainUniqueChar",{method:"GET",urlParameters:{FLAG:a,UNIQUECHAR:JSON.stringify(o.RTRCHAR)},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show(e.maintainUniqueChar);d.onAfterRendering();d.onCloseRestItem()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error")}})}})});