sap.ui.define(["cpapp/cpmatvariant/controller/BaseController","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/Device"],function(e,t,a,i,s,o,r){"use strict";var l,d;return e.extend("cpapp.cpmatvariant.controller.ItemMaster",{onInit:function(){l=this;l.oModel=new a;this.locModel=new a;this.prodModel=new a;l.oCharModel=new a;l.charnameModel=new a;l.charvalueModel=new a;l.locModel.setSizeLimit(1e3);l.prodModel.setSizeLimit(1e3);this.oModel.setSizeLimit(1e3);this.bus=sap.ui.getCore().getEventBus();this.bus.subscribe("data","refreshMaster",this.refreshMaster,this);this.bus.publish("nav","toBeginPage",{viewName:this.getView().getProperty("viewName")});this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cpapp.cpmatvariant.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cpapp.cpmatvariant.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogDescUpdate){this._valueHelpDialogDescUpdate=sap.ui.xmlfragment("cpapp.cpmatvariant.view.UniqueDescUpdate",this);this.getView().addDependent(this._valueHelpDialogDescUpdate)}if(!this._addCharacteristic){this._addCharacteristic=sap.ui.xmlfragment("cpapp.cpmatvariant.view.AddCharacterstics",this);this.getView().addDependent(this._addCharacteristic)}if(!this._createCharacterstics){this._createCharacterstics=sap.ui.xmlfragment("cpapp.cpmatvariant.view.CreateChar",this);this.getView().addDependent(this._createCharacterstics)}if(!this._copyCharacterstics){this._copyCharacterstics=sap.ui.xmlfragment("cpapp.cpmatvariant.view.CopyChar",this);this.getView().addDependent(this._copyCharacterstics)}if(!this._valueHelpDialogclassName){this._valueHelpDialogclassName=sap.ui.xmlfragment("cpapp.cpmatvariant.view.className",this);this.getView().addDependent(this._valueHelpDialogclassName)}},refreshMaster:function(){this.onAfterRendering()},onAfterRendering:function(){l=this;l.oLoc=this.byId("idloc");this.oProd=this.byId("prodInput");l._valueHelpDialogLoc.setTitleAlignment("Center");l._valueHelpDialogProd.setTitleAlignment("Center");l.oTableData=[];sap.ui.getCore().byId("idUniqDesc1").setValue("");l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");d=this.getModel("oGModel");d.setProperty("/New","");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){sap.ui.core.BusyIndicator.hide();l.locModel.setData(e);l.oLocList.setModel(l.locModel)},error:function(e,a){sap.ui.core.BusyIndicator.hide();t.show("error")}})},handleValueHelp:function(e){var a=e.getParameter("id");d.setProperty("/mainSID",a);if(a.includes("loc")){l._valueHelpDialogLoc.open()}else if(a.includes("prod")){if(l.byId("idloc").getValue()!==""){l._valueHelpDialogProd.open()}else{t.show("Select Location")}}},handleClose:function(e){var t=e.getParameter("id");if(t.includes("loc")){l._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(l.oLocList.getBinding("items")){l.oLocList.getBinding("items").filter([])}}else if(t.includes("prod")){l._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(l.oProdList.getBinding("items")){l.oProdList.getBinding("items").filter([])}}},handleSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),a=e.getParameter("id"),o=[];t=t?t.trim():"";if(a.includes("loc")){if(t!==""){o.push(new i({filters:[new i("LOCATION_ID",s.Contains,t),new i("LOCATION_DESC",s.Contains,t)],and:false}))}l.oLocList.getBinding("items").filter(o)}else if(a.includes("prod")){if(t!==""){o.push(new i({filters:[new i("PRODUCT_ID",s.Contains,t),new i("PROD_DESC",s.Contains,t)],and:false}))}l.oProdList.getBinding("items").filter(o)}},handleSelection:function(e){var a=e.getParameter("id"),o=d.getProperty("/mainSID"),r=e.getParameter("selectedItems"),n,u=[];if(a.includes("Loc")){this.oLoc=l.byId("idloc");n=e.getParameter("selectedItems");if(o==="__xmlview1--idloc"){l.oLoc.setValue(n[0].getTitle())}else if(o==="locId1"){sap.ui.getCore().byId("locId1").setValue(n[0].getTitle())}else if(o==="locIdCC"){sap.ui.getCore().byId("locIdCC").setValue(n[0].getTitle())}l.oProd.setValue();l.oProd.removeAllTokens();this._valueHelpDialogProd.getAggregation("_dialog").getContent()[1].removeSelections();this.getModel("BModel").read("/getLocProdDet",{filters:[new i("LOCATION_ID",s.EQ,n[0].getTitle())],success:function(e){l.prodModel.setData(e);l.oProdList.setModel(l.prodModel)},error:function(e,a){t.show("error")}})}else if(a.includes("prod")){this.oProd=l.byId("prodInput");n=e.getParameter("selectedItems");if(o==="__xmlview1--prodInput"){l.oProd.setValue(n[0].getTitle())}else if(o==="prodId1"){sap.ui.getCore().byId("prodId1").setValue(n[0].getTitle())}else if(o==="prodIdCC"){sap.ui.getCore().byId("prodIdCC").setValue(n[0].getTitle())}}l.handleClose(e)},onGetData:function(e){var a=l.oLoc.getValue(),o=l.oProd.getValue(),r=l.byId("idUnique").getSelectedKey();d.setProperty("/prdId","");d.setProperty("/locId","");d.setProperty("/uniqId","");var n=[];n.push(new i({filters:[new i("LOCATION_ID",s.EQ,a),new i("PRODUCT_ID",s.EQ,o)],and:true}));if(r!=="A"){n.push(new i({filters:[new i("UID_TYPE",s.EQ,r)],and:true}))}if(a!==""&&o!==""){sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getUniqueHeader",{filters:[n],success:function(e){sap.ui.core.BusyIndicator.hide();if(e.results.length){l.oModel.setData({results:e.results});d.setProperty("/uniqueData",e.results);l.byId("idMatVHead").setModel(l.oModel);d.setProperty("/locId",e.results[0].LOCATION_ID);d.setProperty("/prdId",e.results[0].PRODUCT_ID);d.setProperty("/uniqId",e.results[0].UNIQUE_ID);d.setProperty("/uid_rate",e.results[0].UID_RATE);l.byId("idMatVHead").setSelectedItem(l.byId("idMatVHead").getItems()[0],true);l.byId("idCreateBtn").setVisible(true);l.byId("idCopyBtn").setVisible(true)}else{l.oModel.setData({results:[]});d.setProperty("/uniqueData",e.results);l.byId("idMatVHead").setModel(l.oModel);t.show("No data for the selected Location Product")}l.byId("idCreateBtn").setVisible(true);l.byId("idCopyBtn").setVisible(true);l.onhandlePress()},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get data")}})}else{t.show("Please select Location and Product")}},onhandlePress:function(e){d=this.getModel("oGModel");if(e){var t=e.getSource().getSelectedItem().getBindingContext().getObject();d.setProperty("/prdId",t.PRODUCT_ID);d.setProperty("/locId",t.LOCATION_ID);d.setProperty("/uniqId",t.UNIQUE_ID);d.setProperty("/uid_rate",t.UID_RATE);d.setProperty("/uid_active",t.ACTIVE)}l.getOwnerComponent().runAsOwner(function(){if(!l.oDetailView){try{l.oDetailView=sap.ui.view({viewName:"cpapp.cpmatvariant.view.ItemDetail",type:"XML"});l.bus.publish("flexible","addDetailPage",l.oDetailView);l.bus.publish("nav","toDetailPage",{viewName:l.oDetailView.getViewName()})}catch(e){l.oDetailView.onAfterRendering()}}else{l.bus.publish("nav","toDetailPage",{viewName:l.oDetailView.getViewName()})}})},onSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),a=[];if(t!==""){a.push(new i({filters:[new i("UNIQUE_RDESC",s.Contains,t),new i("UNIQUE_ID",s.Contains,t)],and:false}))}l.byId("idMatVHead").getBinding("items").filter(a)},onEditDesc:function(e){var t=e.getSource().getParent().getBindingContext().getObject();d.setProperty("/SelectedData",t);d.setProperty("/SelectedId",t.UNIQUE_ID);d.setProperty("/SelectedDesc",t.UNIQUE_DESC);d.setProperty("/SelectedURate",t.UID_RATE);this._valueHelpDialogDescUpdate.open()},onCloseDesc:function(){this._valueHelpDialogDescUpdate.close()},onUpdateUniqueDesc:function(){var e=d.getProperty("/SelectedData");var a=sap.ui.getCore().byId("idUniqDesc").getValue();var i;if(e.ACTIVE===true){i=""}else{i="X"}l.getModel("BModel").callFunction("/changeUnique",{method:"GET",urlParameters:{LOCATION_ID:e.LOCATION_ID,PRODUCT_ID:e.PRODUCT_ID,UNIQUE_ID:e.UNIQUE_ID,UID_TYPE:e.UID_TYPE,UNIQUE_DESC:a,ACTIVE:i,FLAG:"E"},success:function(e){sap.ui.core.BusyIndicator.hide();t.show(e.changeUnique);l.onCloseDesc();l.onGetData()},error:function(e){sap.ui.core.BusyIndicator.hide();t.show("Failed to changes the status")}})},onChange:function(e){var a=e.getSource().getBindingContext().getObject();var i;if(a.ACTIVE===true){i="X"}else{i=""}l.getModel("BModel").callFunction("/changeUnique",{method:"GET",urlParameters:{LOCATION_ID:a.LOCATION_ID,PRODUCT_ID:a.PRODUCT_ID,UNIQUE_ID:a.UNIQUE_ID,UID_TYPE:a.UID_TYPE,UNIQUE_DESC:a.UNIQUE_DESC,ACTIVE:i,FLAG:"E"},success:function(e){sap.ui.core.BusyIndicator.hide();t.show(e.changeUnique);l.onGetData()},error:function(e){sap.ui.core.BusyIndicator.hide();t.show("Failed to changes the status")}})},onCreateBtn:function(){l.oTableData=[];sap.ui.getCore().byId("idUniqDesc1").setValue("");l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);var e=this.byId("idloc").getValue(),i=this.byId("prodInput").getValue(),s=this.byId("idUnique").getSelectedKey();sap.ui.getCore().byId("locId1").setValue(e);sap.ui.getCore().byId("prodId1").setValue(i);d.setProperty("/New","N");sap.ui.getCore().byId("idUniqDesc1").setValue("");l.oTableData=[];l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);if(i){l._createCharacterstics.open();l.CharData()}else{t.show("Please select product")}},onCopyBtn:function(e){var t=l.byId("idMatVHead").getSelectedItem().getBindingContext().getProperty();var i="Please Confirm to copy characteristics of Unique ID"+" - "+t.UNIQUE_ID;sap.m.MessageBox.show(i,{title:"Conformation",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){sap.ui.getCore().byId("locId1").setValue(t.LOCATION_ID);sap.ui.getCore().byId("prodId1").setValue(t.PRODUCT_ID);sap.ui.getCore().byId("idUniqDesc1").setValue(t.UNIQUE_DESC);d.setProperty("/New","C");l.oTableData=d.getProperty("/CharData");l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);l._createCharacterstics.open();l.CharData()}}})},CharData:function(){var e=this.byId("prodInput").getValue();if(e){this.getModel("BModel").read("/getProdClsChar",{filters:[new i("PRODUCT_ID",s.EQ,e)],success:function(e){sap.ui.core.BusyIndicator.hide();l.classNameData=e.results;var t=new a;t.setData({results:l.classNameData});sap.ui.getCore().byId("classNameList").setModel(t)},error:function(e,a){sap.ui.core.BusyIndicator.hide();t.show("error")}})}else{t.show("Please select product")}},onCloseCreate:function(){this._createCharacterstics.close()},onCloseCopy:function(){this._copyCharacterstics.close()},onAddChar:function(){sap.ui.getCore().byId("idClassname2").setValue("");sap.ui.getCore().byId("idCharname2").setValue("");sap.ui.getCore().byId("idCharval2").setValue("");sap.ui.getCore().byId("idCharno2").setValue("");sap.ui.getCore().byId("idCharvalno2").setValue("");l.oClassnameList=sap.ui.getCore().byId("classNameList");sap.ui.getCore().byId("idCharSearch").setValue("");l.oClassnameList.getBinding("items").filter([]);l._valueHelpDialogclassName.open();jQuery.sap.delayedCall(300,null,function(){sap.ui.getCore().byId("idCharSearch").focus()})},handleCharSelection:function(e){l.oGModel=l.getModel("oGModel");var i=e.getSource().getSelectedItems()[0].getBindingContext().getProperty();var s=i.CLASS_NAME,o=i.CHAR_NAME,r=i.CHAR_NUM,d=i.CHAR_VALUE,n=i.CHARVAL_NUM;if(o!==""&&d!==""&&s!==""){this.oData={CLASS_NAME:s,CHAR_NAME:o,CHAR_NUM:r,CHAR_VALUE:d,CHARVAL_NUM:n,OFLAG:"X"};var u=sap.ui.getCore().byId("idCharItem").getItems();var c=0;for(var g=0;g<u.length;g++){if(u[g].getCells()[1].getText()===r&&u[g].getCells()[3].getText()===n){c=c+1}}if(c===0){l.oTableData.push(l.oData);l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);this._valueHelpDialogclassName.close()}else{sap.m.MessageToast.show("Characterstic is already maintained")}}else{t.show("Please fill all inputs")}},onClassClose:function(){this._valueHelpDialogclassName.close()},handleCharSearch:function(e){var t=e.getParameter("value")||e.getParameter("newValue"),a=[];t=t?t.trim():"";if(t!==""){a.push(new i({filters:[new i("CLASS_NAME",s.Contains,t),new i("CHAR_NAME",s.Contains,t),new i("CHAR_VALUE",s.Contains,t),new i("CHAR_NUM",s.Contains,t),new i("CHARVAL_NUM",s.Contains,t)],and:false}))}l.oClassnameList=sap.ui.getCore().byId("classNameList");l.oClassnameList.getBinding("items").filter(a)},handleCharClose:function(e){var t=e.getParameter("id");if(t.includes("className")){l._oCore.byId(this._valueHelpDialogclassName.getId()+"-searchField").setValue("");if(l.oClassnameList.getBinding("items")){l.oClassnameList.getBinding("items").filter([])}}else if(t.includes("charName")){l._oCore.byId(this._valueHelpDialogcharName.getId()+"-searchField").setValue("");if(l.oCharnameList.getBinding("items")){l.oCharnameList.getBinding("items").filter([])}}else if(t.includes("charVal")){l._oCore.byId(this._valueHelpDialogcharValue.getId()+"-searchField").setValue("");if(l.oCharvalueList.getBinding("items")){l.oCharvalueList.getBinding("items").filter([])}}},onCloseRestItem:function(){sap.ui.getCore().byId("idClassname2").setValue("");sap.ui.getCore().byId("idCharname2").setValue("");sap.ui.getCore().byId("idCharval2").setValue("");l._addCharacteristic.close()},onAdd:function(){var e=sap.ui.getCore().byId("idCharname2").getValue(),i=sap.ui.getCore().byId("idCharno2").getValue(),s=sap.ui.getCore().byId("idCharval2").getValue(),o=sap.ui.getCore().byId("idCharvalno2").getValue(),r=sap.ui.getCore().byId("idClassname2").getValue();if(e!==""&&s!==""&&r!==""){this.oData={CLASS_NAME:r,CHAR_NAME:e,CHAR_NUM:i,CHAR_VALUE:s,CHARVAL_NUM:o,OFLAG:"X"};var d=sap.ui.getCore().byId("idCharItem").getItems();var n=0;for(var u=0;u<d.length;u++){if(d[u].getCells()[1].getText()===i&&d[u].getCells()[3].getText()===o){n=n+1}}if(n===0){l.oTableData.push(l.oData);l.ListModel=new a;l.ListModel.setData({results:l.oTableData});sap.ui.getCore().byId("idCharItem").setModel(l.ListModel);l._addCharacteristic.close()}else{sap.m.MessageToast.show("Characterstic is already maintained")}}else{t.show("Please fill all inputs")}},onTabDel:function(e){var t=e.getSource().getParent().getBindingContext().getObject();var a=e.getParameters("listItem").id.split("idCharItem-")[1];var i=l.ListModel.getData().results;i.splice(a,1);l.ListModel.refresh()},onCreateUniq:function(){var e;var t={RTRCHAR:[]};var a=sap.ui.getCore().byId("locId1").getValue(),i=sap.ui.getCore().byId("prodId1").getValue(),s=1,o=sap.ui.getCore().byId("idUniqDesc1").getValue(),r=sap.ui.getCore().byId("idComboBox1").getValue(),n=sap.ui.getCore().byId("uidRId1").getValue(),u=sap.ui.getCore().byId("idComboBox").getValue(),c="C",g=0;if(u==="True"){u=""}else{u="X"}var C=sap.ui.getCore().byId("idCharItem").getItems();var p=d.getProperty("/New");for(var I=0;I<C.length;I++){var h=C[I].getBindingContext().getObject();e={LOCATION_ID:a,PRODUCT_ID:i,UNIQUE_ID:s,UNIQUE_DESC:o,CHAR_NUM:h.CHAR_NUM,CHARVAL_NUM:h.CHARVAL_NUM};t.RTRCHAR.push(e)}sap.ui.core.BusyIndicator.show();l.getModel("BModel").callFunction("/maintainUniqueChar",{method:"GET",urlParameters:{FLAG:p,UNIQUECHAR:JSON.stringify(t.RTRCHAR)},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show(e.maintainUniqueChar);l.onGetData();l.onCloseCreate()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error")}})},onCopyUniqueDesc:function(){var e=d.getProperty("/uniqueData");var t=sap.ui.getCore().byId("locIdCC").getValue(),a=sap.ui.getCore().byId("prodIdCC").getValue(),i=1,s=sap.ui.getCore().byId("idUniqDescCC").getValue(),o=sap.ui.getCore().byId("idComboBoxCC").getSelectedKey(),r=sap.ui.getCore().byId("uidRIdCC").getValue(),n=sap.ui.getCore().byId("idComboBoxAC").getValue(),u="C",c=0;if(n==="True"){n=""}else{n="X"}if(t===""||a===""){sap.m.MessageToast.show("Please select Location/Product")}else{sap.ui.core.BusyIndicator.show();var g=l.getView().getModel("BModel");g.callFunction("/changeUnique",{method:"GET",urlParameters:{LOCATION_ID:t,PRODUCT_ID:a,UNIQUE_ID:i,UID_TYPE:o,UNIQUE_DESC:s,ACTIVE:n,FLAG:"C"},success:function(e){sap.m.MessageToast.show(e.changeUnique);l.onAfterRendering();l._copyCharacterstics.close();l.onGetData();sap.ui.core.BusyIndicator.hide()},error(e){sap.m.MessageToast.show("Failed to Create");sap.ui.core.BusyIndicator.hide()}})}}})});