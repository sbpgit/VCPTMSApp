sap.ui.define(["cpapp/cpseedordercreation/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/library","sap/ui/model/Sorter"],function(e,i,t,o,s,a,r){"use strict";var d,l;return e.extend("cpapp.cpseedordercreation.controller.Home",{onInit:function(){d=this;d.oModel=new i;d.locModel=new i;d.prodModel=new i;d.uniqModel=new i;this.oModel.setSizeLimit(1e3);d.locModel.setSizeLimit(1e3);d.prodModel.setSizeLimit(1e3);d.uniqModel.setSizeLimit(1e3);this._oCore=sap.ui.getCore();if(!this._valueHelpDialogLoc){this._valueHelpDialogLoc=sap.ui.xmlfragment("cpapp.cpseedordercreation.view.LocDialog",this);this.getView().addDependent(this._valueHelpDialogLoc)}if(!this._valueHelpDialogProd){this._valueHelpDialogProd=sap.ui.xmlfragment("cpapp.cpseedordercreation.view.ProdDialog",this);this.getView().addDependent(this._valueHelpDialogProd)}if(!this._valueHelpDialogUniq){this._valueHelpDialogUniq=sap.ui.xmlfragment("cpapp.cpseedordercreation.view.UniqId",this);this.getView().addDependent(this._valueHelpDialogUniq)}if(!this._valueHelpDialogOrderCreate){this._valueHelpDialogOrderCreate=sap.ui.xmlfragment("cpapp.cpseedordercreation.view.OrderCreate",this);this.getView().addDependent(this._valueHelpDialogOrderCreate)}},onAfterRendering:function(){d=this;d.oGModel=d.getModel("oGModel");d.oGModel.setProperty("/selFlag","");d.oGModel.setProperty("/OrderFlag","");d.oList=this.byId("orderList");this.byId("headSearch").setValue("");if(d.oList.getBinding("items")){d.oList.getBinding("items").filter([])}this.oLoc=this.byId("idloc");this.oProd=this.byId("prodInput");d._valueHelpDialogProd.setTitleAlignment("Center");d._valueHelpDialogLoc.setTitleAlignment("Center");this.oProdList=this._oCore.byId(this._valueHelpDialogProd.getId()+"-list");this.oLocList=this._oCore.byId(this._valueHelpDialogLoc.getId()+"-list");this.oUniqList=this._oCore.byId(this._valueHelpDialogUniq.getId()+"-list");sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getLocation",{success:function(e){sap.ui.core.BusyIndicator.hide();d.locModel.setData(e);d.oLocList.setModel(d.locModel)},error:function(e,i){sap.ui.core.BusyIndicator.hide();t.show("error")}});this.getModel("BModel").read("/getSeedOrder",{success:function(e){sap.ui.core.BusyIndicator.hide();d.TabData=e.results;d.oModel.setData({results:e.results});d.oList.setModel(d.oModel)},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get profiles")}})},handleValueHelp:function(e){var i=e.getParameter("id");if(i.includes("loc")){d._valueHelpDialogLoc.open()}else if(i.includes("prod")){d._valueHelpDialogProd.open()}else if(i.includes("Location")){d._valueHelpDialogLoc.open()}else if(i.includes("Product")){if(sap.ui.getCore().byId("idLocation").getValue()){d._valueHelpDialogProd.open()}else{t.show("Select Location")}}else if(i.includes("Uniq")){d._valueHelpDialogUniq.open()}},handleClose:function(e){var i=e.getParameter("id");if(i.includes("loc")){d._oCore.byId(this._valueHelpDialogLoc.getId()+"-searchField").setValue("");if(d.oLocList.getBinding("items")){d.oLocList.getBinding("items").filter([])}}else if(i.includes("prod")){d._oCore.byId(this._valueHelpDialogProd.getId()+"-searchField").setValue("");if(d.oProdList.getBinding("items")){d.oProdList.getBinding("items").filter([])}}else if(i.includes("Uniq")){d._oCore.byId(this._valueHelpDialogUniq.getId()+"-searchField").setValue("");if(d.oUniqList.getBinding("items")){d.oUniqList.getBinding("items").filter([])}}},handleSearch:function(e){var i=e.getParameter("value")||e.getParameter("newValue"),t=e.getParameter("id"),a=[];i=i?i.trim():"";if(t.includes("Loc")){if(i!==""){a.push(new o({filters:[new o("LOCATION_ID",s.Contains,i),new o("LOCATION_DESC",s.Contains,i)],and:false}))}d.oLocList.getBinding("items").filter(a)}else if(t.includes("prod")){if(i!==""){a.push(new o({filters:[new o("PRODUCT_ID",s.Contains,i),new o("PROD_DESC",s.Contains,i)],and:false}))}d.oProdList.getBinding("items").filter(a)}else if(t.includes("Uniq")){if(i!==""){a.push(new o({filters:[new o("UNIQUE_ID",s.Contains,i),new o("UNIQUE_DESC",s.Contains,i)],and:false}))}d.oUniqList.getBinding("items").filter(a)}else if(t.includes("head")){if(i!==""){a.push(new o({filters:[new o("PRODUCT_ID",s.Contains,i),new o("PROD_DESC",s.Contains,i),new o("SEED_ORDER",s.Contains,i)],and:false}))}d.oList.getBinding("items").filter(a)}},handleSelection:function(e){var i=e.getParameter("id"),a=e.getParameter("selectedItems"),r,l=d.oGModel.getProperty("/selFlag");if(i.includes("Loc")){var n=e.getParameter("selectedItems");if(l===""){this.oLoc=d.byId("idloc")}else if(l==="X"){this.oLoc=sap.ui.getCore().byId("idLocation")}d.oLoc.setValue(n[0].getTitle());this.getModel("BModel").read("/getLocProdDet",{filters:[new o("LOCATION_ID",s.EQ,n[0].getTitle())],success:function(e){d.prodModel.setData(e);d.oProdList.setModel(d.prodModel)},error:function(e,i){t.show("error")}})}else if(i.includes("prod")){var u=e.getParameter("selectedItems");if(l===""){this.oProd=d.byId("prodInput")}else if(l==="X"){this.oProd=sap.ui.getCore().byId("idProduct")}d.oProd.setValue(u[0].getTitle());sap.ui.core.BusyIndicator.show();this.getModel("BModel").read("/getUniqueHeader",{filters:[new o("LOCATION_ID",s.EQ,sap.ui.getCore().byId("idLocation").getValue()),new o("PRODUCT_ID",s.EQ,sap.ui.getCore().byId("idProduct").getValue())],success:function(e){sap.ui.core.BusyIndicator.hide();e.results.forEach(function(e){e.UNIQUE_ID=e.UNIQUE_ID.toString()},d);d.uniqModel.setData(e);d.oUniqList.setModel(d.uniqModel)},error:function(e,i){sap.ui.core.BusyIndicator.hide();t.show("error")}})}else if(i.includes("Uniq")){var u=e.getParameter("selectedItems");this.oUniq=sap.ui.getCore().byId("idUniq");d.oUniq.setValue(u[0].getTitle())}d.handleClose(e)},onGetData:function(e){var i=d.byId("idloc").getValue(),a=d.byId("prodInput").getValue();this.getModel("BModel").read("/getSeedOrder",{filters:[new o("LOCATION_ID",s.EQ,i),new o("PRODUCT_ID",s.EQ,a)],success:function(e){sap.ui.core.BusyIndicator.hide();d.oModel.setData({results:e.results});d.oList.setModel(d.oModel)},error:function(){sap.ui.core.BusyIndicator.hide();t.show("Failed to get profiles")}})},onResetDate:function(){d.byId("idloc").setValue("");d.byId("prodInput").setValue("");d.oModel.setData({results:d.TabData});d.oList.setModel(d.oModel)},onOrderCreate:function(){d._valueHelpDialogOrderCreate.open();d.oGModel.setProperty("/selFlag","X");d.oGModel.setProperty("/OrderFlag","C");d._valueHelpDialogOrderCreate.setTitle("Create Order")},onEdit:function(e){d._valueHelpDialogOrderCreate.setTitle("Update Order");var i=e.getSource().getParent().getBindingContext().getObject();var t=i.MAT_AVAILDATE.toISOString().split("T")[0];d.oGModel.setProperty("/OrderFlag","E");sap.ui.getCore().byId("idLabelSeed").setVisible(true);sap.ui.getCore().byId("idseedord").setVisible(true);sap.ui.getCore().byId("idseedord").setEditable(false);sap.ui.getCore().byId("idLocation").setEditable(false);sap.ui.getCore().byId("idProduct").setEditable(false);sap.ui.getCore().byId("idUniq").setEditable(false);sap.ui.getCore().byId("idseedord").setValue(i.SEED_ORDER);sap.ui.getCore().byId("idLocation").setValue(i.LOCATION_ID);sap.ui.getCore().byId("idProduct").setValue(i.PRODUCT_ID);sap.ui.getCore().byId("idUniq").setValue(i.UNIQUE_ID);sap.ui.getCore().byId("idQuantity").setValue(i.ORD_QTY);sap.ui.getCore().byId("idDate").setValue(t);d._valueHelpDialogOrderCreate.open()},onCancelOrder:function(){sap.ui.getCore().byId("idLocation").setValue("");sap.ui.getCore().byId("idProduct").setValue("");sap.ui.getCore().byId("idUniq").setValue("");sap.ui.getCore().byId("idQuantity").setValue("");sap.ui.getCore().byId("idDate").setValue("");d.oGModel.setProperty("/selFlag","");d.oGModel.setProperty("/OrderFlag","");sap.ui.getCore().byId("idLabelSeed").setVisible(false);sap.ui.getCore().byId("idseedord").setVisible(false);sap.ui.getCore().byId("idLocation").setEditable(true);sap.ui.getCore().byId("idProduct").setEditable(true);sap.ui.getCore().byId("idUniq").setEditable(true);d._valueHelpDialogOrderCreate.close()},onSaveOrder:function(){var e=sap.ui.getCore().byId("idLocation").getValue(),i=sap.ui.getCore().byId("idProduct").getValue(),t=parseInt(sap.ui.getCore().byId("idUniq").getValue()),o=sap.ui.getCore().byId("idQuantity").getValue(),s=sap.ui.getCore().byId("idDate").getValue(),a=sap.ui.getCore().byId("idseedord").getValue();var r={SEEDDATA:[]},l,n;var u=d.oGModel.getProperty("/OrderFlag");if(u==="C"){n="0"}else if(u==="E"){n=a}l={SEED_ORDER:n,LOCATION_ID:e,PRODUCT_ID:i,UNIQUE_ID:t,ORD_QTY:o,MAT_AVAILDATE:s};r.SEEDDATA.push(l);if(o!==""&&s!==""&&e!==""&&i!==""&&t!==""){d.getModel("BModel").callFunction("/maintainSeedOrder",{method:"GET",urlParameters:{FLAG:u,SEEDDATA:JSON.stringify(r.SEEDDATA)},success:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("success");d.onCancelOrder();d.onAfterRendering()},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("Error")}})}else{sap.m.MessageToast.show("Please fill all fields")}}})});