VIEW CP_V_PRIMARY_HISTORY AS
SELECT  ADD_DAYS(ADD_DAYS(TO_DATE('01/01/'||substr("PERIOD_NUM",1,4),'DD/MM/YYYY'),
-WEEKDAY (TO_DATE ('01/01/'||substr("PERIOD_NUM",1,4),'DD/MM/YYYY'))),
substr("PERIOD_NUM",5,2)*7) AS CAL_DATE,
LOCATION_ID, PRODUCT_ID, GROUP_ID AS PRIMARY_ID, GROUP_COUNT AS PRIMARY_QTY
FROM CP_VC_HISTORY_TS
ORDER BY LOCATION_ID, PRODUCT_ID, CAL_DATE, PRIMARY_ID ASC;