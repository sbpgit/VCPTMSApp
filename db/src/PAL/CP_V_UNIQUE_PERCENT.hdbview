VIEW CP_V_UNIQUE_PERCENT AS
SELECT UQ.CAL_DATE, UQ.LOCATION_ID, UQ.PRODUCT_ID, UQ.PRIMARY_ID, UQ.UNIQUE_ID, UQ.UNIQUE_QTY,
CASE WHEN UNIQUE_AGG > 0 THEN 100.0*(UQ.UNIQUE_QTY/UNIQUE_AGG) ELSE '0' END AS UNIQUE_PERCENT,
UQ.TYPE
FROM CP_V_UNIQUE AS UQ
INNER JOIN CP_V_UNIQUE_AGG AS UAGG ON
UQ.CAL_DATE = UAGG.CAL_DATE 
AND UQ.LOCATION_ID = UAGG.LOCATION_ID 
AND UQ.PRODUCT_ID = UAGG.PRODUCT_ID
ORDER BY CAL_DATE, LOCATION_ID, PRODUCT_ID, PRIMARY_ID,UNIQUE_ID;