    ----------------------------------------------------------------------------------------
-- Name:            V_ORD_COUNT
-- Description:     Get order count for location product on a weekly basis
-- Join Details:    CP_SALESH -  Master table for sales history 
-----------------------------------------------------------------------------------------

VIEW "V_ORD_COUNT" AS
SELECT 
	"LOCATION_ID",
	"PRODUCT_ID",
	CASE
		WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
	END AS "WEEK_DATE",
	CASE
		WHEN WEEK(CASE
			WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
		END) < 10 THEN CONCAT(YEAR(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END), CONCAT('0', WEEK(CASE
					WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
				END)
		)
	)
		ELSE CONCAT(YEAR(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END), WEEK(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END)
	)
	END AS "WEEK_NO",
	SUM("ORD_QTY") AS ORD_QTY
FROM V_SALES_H
GROUP BY 
	"LOCATION_ID",
	"PRODUCT_ID",
	CASE
		WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
		WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
	END,
	CASE
		WHEN WEEK(CASE
			WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
			WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
		END) < 10 THEN CONCAT(YEAR(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END), CONCAT('0', WEEK(CASE
					WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
					WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
				END)
		)
	)
		ELSE CONCAT(YEAR(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END), WEEK(CASE
				WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS( "MAT_AVAILDATE", 6 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS( "MAT_AVAILDATE", 5 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS( "MAT_AVAILDATE", 4 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS( "MAT_AVAILDATE", 3 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS( "MAT_AVAILDATE", 2 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS( "MAT_AVAILDATE", 1 )
				WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS( "MAT_AVAILDATE", 0 )
			END)
	)
	END;