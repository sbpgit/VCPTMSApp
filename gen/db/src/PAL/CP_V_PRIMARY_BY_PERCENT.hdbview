VIEW CP_V_PRIMARY_BY_PERCENT AS
SELECT PRIM.CAL_DATE, PRIM.LOCATION_ID, PRIM.PRODUCT_ID, PRIM.PRIMARY_ID, PRIM.PRIMARY_QTY, 
CASE WHEN PRIMARY_AGG > 0 THEN 100.0*(PRIM.PRIMARY_QTY/PRIMARY_AGG) ELSE '0' END AS PRIMARY_PERCENT,
PRIM.TYPE
FROM CP_V_PRIMARY AS PRIM
INNER JOIN CP_V_PRIMARY_AGG AS PAGG ON
PRIM.CAL_DATE = PAGG.CAL_DATE 
AND PRIM.LOCATION_ID = PAGG.LOCATION_ID 
AND PRIM.PRODUCT_ID = PAGG.PRODUCT_ID
AND PRIM.TYPE = PAGG.TYPE
ORDER BY CAL_DATE, LOCATION_ID, PRODUCT_ID, PRIMARY_ID;