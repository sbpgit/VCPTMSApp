
VIEW V_PLSTR_PRIMARYID_TS AS
SELECT DISTINCT PTS.WEEKDATE, PTS.PRODUCT_ID, PTS.LOCATION_ID, PIDS.PRIMARY_ID,
ALLIDS.PRIMARY_ID_CHARVALS,
PTS.ORDER_QTY
FROM V_PLSTR_PRIMARY_TS AS PTS
INNER JOIN PLSTR_PRIMARY_IDS AS PIDS ON 
PTS.PRODUCT_ID = PIDS.PRODUCT_ID AND
PTS.LOCATION_ID = PIDS.LOCATION_ID AND
PTS.PRIMARY_CHARVALS_STR = PIDS.PRIMARY_CHARVALS_STR 
INNER JOIN V_PLSTR_ALL_IDS_BY_SALESDOC AS ALLIDS ON
PTS.PRODUCT_ID =  ALLIDS.PRODUCT_ID AND
PTS.WEEKDATE = ALLIDS.WEEKDATE AND
PTS.PRIMARY_CHARVALS_STR = CONCAT(ALLIDS.PARTIAL_ID_CHARVALS, CONCAT(',', ALLIDS.PRIMARY_ID_CHARVALS))
ORDER BY  PTS.WEEKDATE, PTS.PRODUCT_ID, PTS.LOCATION_ID, PIDS.PRIMARY_ID, ALLIDS.PRIMARY_ID_CHARVALS;