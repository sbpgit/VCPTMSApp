VIEW V_CIRQTY_UNIQUECHAR as 
SELECT
    CP_CIR_GENERATED."LOCATION_ID",
    CP_CIR_GENERATED."PRODUCT_ID",
    CP_CIR_GENERATED."WEEK_DATE",
    CP_CIR_GENERATED."MODEL_VERSION",
    CP_CIR_GENERATED."VERSION",
    CP_CIR_GENERATED."SCENARIO",
    CP_PARTIALPROD_INTRO."REF_PRODID",
    V_UNIQUE_ID."CHAR_NUM",
    V_UNIQUE_ID."CHARVAL_NUM",
    CP_IBP_FCHARPLAN."OPT_QTY",
    SUM("CIR_QTY") AS CIR_QTY,
    CP_IBP_FCHARPLAN.OPT_QTY - SUM("CIR_QTY") AS DIFF_QTY
FROM
    CP_CIR_GENERATED
    INNER JOIN
    CP_PARTIALPROD_INTRO
    ON CP_PARTIALPROD_INTRO.PRODUCT_ID = CP_CIR_GENERATED.PRODUCT_ID
        AND CP_PARTIALPROD_INTRO.LOCATION_ID = CP_CIR_GENERATED.LOCATION_ID
    INNER JOIN
    V_UNIQUE_ID
    ON V_UNIQUE_ID.LOCATION_ID = CP_CIR_GENERATED.LOCATION_ID
        AND V_UNIQUE_ID.PRODUCT_ID = CP_PARTIALPROD_INTRO.REF_PRODID
        AND V_UNIQUE_ID.UNIQUE_ID = CP_CIR_GENERATED.UNIQUE_ID
    INNER JOIN
    CP_IBP_FCHARPLAN
    ON CP_IBP_FCHARPLAN.LOCATION_ID = CP_CIR_GENERATED.LOCATION_ID
        AND CP_IBP_FCHARPLAN.PRODUCT_ID = CP_CIR_GENERATED.PRODUCT_ID
        AND CP_IBP_FCHARPLAN.CHAR_NUM = V_UNIQUE_ID.CHAR_NUM
        AND CP_IBP_FCHARPLAN.CHARVAL_NUM = V_UNIQUE_ID.CHARVAL_NUM
        AND CP_IBP_FCHARPLAN.VERSION = CP_CIR_GENERATED.VERSION
        AND CP_IBP_FCHARPLAN.SCENARIO = CP_CIR_GENERATED.SCENARIO
        AND CP_IBP_FCHARPLAN.WEEK_DATE = CP_CIR_GENERATED.WEEK_DATE
GROUP BY
    CP_CIR_GENERATED."LOCATION_ID",
    CP_CIR_GENERATED."PRODUCT_ID",
    CP_CIR_GENERATED."WEEK_DATE",
    CP_CIR_GENERATED."MODEL_VERSION",
    CP_CIR_GENERATED."VERSION",
    CP_CIR_GENERATED."SCENARIO",
    CP_PARTIALPROD_INTRO."REF_PRODID",
    V_UNIQUE_ID."CHAR_NUM",
    V_UNIQUE_ID."CHARVAL_NUM",
    CP_IBP_FCHARPLAN."OPT_QTY"
ORDER BY
    CP_CIR_GENERATED."LOCATION_ID" ASC,
    CP_CIR_GENERATED."PRODUCT_ID" ASC,
    CP_CIR_GENERATED."WEEK_DATE" ASC,
    CP_CIR_GENERATED."MODEL_VERSION" ASC,
    CP_CIR_GENERATED."VERSION" ASC,
    CP_CIR_GENERATED."SCENARIO" ASC,
    V_UNIQUE_ID."CHAR_NUM" ASC,
    V_UNIQUE_ID."CHARVAL_NUM" ASC;