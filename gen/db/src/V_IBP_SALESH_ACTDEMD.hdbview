    ----------------------------------------------------------------------------------------
-- Name:            V_IBP_SALESH_ACTDEMD
-- Description:     Get SUM OF order quantity for location product on a weekly basis
-- Join Details:    CP_SALESH -  Master table for sales history 
-----------------------------------------------------------------------------------------

VIEW "V_IBP_SALESH_ACTDEMD" AS
SELECT "LOCATION_ID",
-- "PLAN_LOC",
-- "FACTORY_LOC",
"PRODUCT_ID",
"REF_PRODID",
"CUSTOMER_GROUP",
CASE
WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS("MAT_AVAILDATE", 0)
WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS("MAT_AVAILDATE", -1)
WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS("MAT_AVAILDATE", -2)
WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS("MAT_AVAILDATE", -3)
WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS("MAT_AVAILDATE", -4)
WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS("MAT_AVAILDATE", -5)
WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS("MAT_AVAILDATE", -6)
END AS "WEEK_DATE",
-- SUM("ORD_QTY") AS ORD_QTY
SUM (CASE WHEN SEEDORD_CHK is NULL THEN "ORD_QTY" else 0 END) AS ORD_QTY,
SUM (CASE WHEN SEEDORD_CHK = 'X' THEN "ORD_QTY" else 0  END) AS ADJ_QTY
FROM V_SALES_H 
-- CP_SALESH
GROUP BY "LOCATION_ID",
"PLAN_LOC",
"FACTORY_LOC",
"REF_PRODID",
"PRODUCT_ID",
"CUSTOMER_GROUP",
CASE
WHEN WEEKDAY("MAT_AVAILDATE") = 0 THEN ADD_DAYS("MAT_AVAILDATE", 0)
WHEN WEEKDAY("MAT_AVAILDATE") = 1 THEN ADD_DAYS("MAT_AVAILDATE", -1)
WHEN WEEKDAY("MAT_AVAILDATE") = 2 THEN ADD_DAYS("MAT_AVAILDATE", -2)
WHEN WEEKDAY("MAT_AVAILDATE") = 3 THEN ADD_DAYS("MAT_AVAILDATE", -3)
WHEN WEEKDAY("MAT_AVAILDATE") = 4 THEN ADD_DAYS("MAT_AVAILDATE", -4)
WHEN WEEKDAY("MAT_AVAILDATE") = 5 THEN ADD_DAYS("MAT_AVAILDATE", -5)
WHEN WEEKDAY("MAT_AVAILDATE") = 6 THEN ADD_DAYS("MAT_AVAILDATE", -6)
END