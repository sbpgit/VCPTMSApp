const FileSystemHelper = require('../../helper/file_system_helper');
const path = require('path');
const fs = require('fs');

class Basemodel {

    static async getInstance() {
        if (!Basemodel._instance) {
            Basemodel._instance = new Basemodel();
            await Basemodel._instance.update();
        }
        return Basemodel._instance;
    }

    static async _getBasemodelPath() {
        return [
            path.join(process.cwd(), 'gen', 'sdc'),
            path.join(process.cwd(), 'sdc'),
            path.join(process.cwd(), 'gen', 'srv', 'sdc'), // needed only for local test scenario
        ].find(fs.existsSync);
    }

    async update(basemodelPath) {
        this._basemodelPath = FileSystemHelper.unixPath(basemodelPath || await Basemodel._getBasemodelPath() || '');
        this._basemodel = await FileSystemHelper.readAllFilesInDirectory(this._basemodelPath, { unixPath: true })
    }

    get sourceFiles() {
        return this._basemodel;
    }

    get rootPath() {
        return this._basemodelPath;
    }
}

module.exports = Basemodel;
