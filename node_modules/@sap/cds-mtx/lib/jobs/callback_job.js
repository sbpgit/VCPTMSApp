const Job = require('./job');
const cds = require('@sap/cds');

class CallbackJob extends Job {
    constructor(id, tenantId, context, jobFunction, args, callback) {
        super(id, tenantId, context, jobFunction, args);
        this.callback = callback;
    }

    async run() {
        try {
            cds.context = this.context;
            const result = await super.run();
            await this.callback.call(this, this, result);
            return result;
        } catch (error) {
            await this.callback.call(this, this, error);
            throw error;
        }
    }
}

module.exports = CallbackJob;
